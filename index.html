<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- PWA primary tags -->
    <meta name="theme-color" content="#ec4899">
    <meta name="description" content="GK Store - Exclusive Video Marketplace. Buy & book premium video accounts.">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="GK Store">
    <meta name="application-name" content="GK Store">
    
    <!-- Web Manifest -->
    <link rel="manifest" href="https://shamsahmadzai06-source.github.io/GKStore/manifest.json">
    
    <!-- iOS icons -->
    <link rel="apple-touch-icon" href="https://shamsahmadzai06-source.github.io/GKStore/android-launchericon-192-192.png">
    <link rel="apple-touch-icon" sizes="72x72" href="https://shamsahmadzai06-source.github.io/GKStore/android-launchericon-72-72.png">
    <link rel="apple-touch-icon" sizes="96x96" href="https://shamsahmadzai06-source.github.io/GKStore/android-launchericon-96-96.png">
    <link rel="apple-touch-icon" sizes="144x144" href="https://shamsahmadzai06-source.github.io/GKStore/android-launchericon-144-144.png">
    <link rel="apple-touch-icon" sizes="192x192" href="https://shamsahmadzai06-source.github.io/GKStore/android-launchericon-192-192.png">
    <link rel="apple-touch-icon" sizes="512x512" href="https://shamsahmadzai06-source.github.io/GKStore/android-launchericon-512-512.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="72x72" href="https://shamsahmadzai06-source.github.io/GKStore/android-launchericon-72-72.png">
    <link rel="icon" type="image/png" sizes="96x96" href="https://shamsahmadzai06-source.github.io/GKStore/android-launchericon-96-96.png">
    <link rel="icon" type="image/png" sizes="144x144" href="https://shamsahmadzai06-source.github.io/GKStore/android-launchericon-144-144.png">
    <link rel="icon" type="image/png" sizes="192x192" href="https://shamsahmadzai06-source.github.io/GKStore/android-launchericon-192-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="https://shamsahmadzai06-source.github.io/GKStore/android-launchericon-512-512.png">
    
    <title>GK Store - Video & Image Marketplace</title>
    
    <!-- Supabase & Font Awesome -->
    <script src="https://unpkg.com/@supabase/supabase-js@2.39.7/dist/umd/supabase.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #ec4899;
            --primary-dark: #db2777;
            --secondary: #8b5cf6;
            --secondary-dark: #7c3aed;
            --accent: #f59e0b;
            --background: #000000;
            --surface: #18181b;
            --surface-light: #27272a;
            --text: #ffffff;
            --text-secondary: #a1a1aa;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --border: #3f3f46;
            --gradient: linear-gradient(135deg, var(--primary), var(--secondary));
            --liked-color: #ef4444;
        }

        [data-theme="light"] {
            --background: #f8fafc;
            --surface: #ffffff;
            --surface-light: #f1f5f9;
            --text: #020617;
            --text-secondary: #475569;
            --border: #e2e8f0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html { 
            font-size: 16px; 
            scroll-behavior: smooth;
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--background);
            color: var(--text);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            height: 100%;
            overflow: hidden;
            position: fixed;
            width: 100%;
        }

        ::-webkit-scrollbar { width: 0px; background: transparent; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        @keyframes slideDown { from { transform: translateY(-100%); } to { transform: translateY(0); } }

        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        .gradient-text { background: var(--gradient); -webkit-background-clip: text; background-clip: text; color: transparent; }
        .gradient-bg { background: var(--gradient); }
        .hidden { display: none !important; }

        .reels-container { 
            height: 100%; 
            overflow-y: scroll; 
            scroll-snap-type: y mandatory; 
            -webkit-overflow-scrolling: touch; 
            background: #000; 
        }
        
        .reel-item { 
            height: 100%; 
            scroll-snap-align: start; 
            position: relative; 
            background: #000; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
        }
        
        .reel-video-container { 
            width: 100%; 
            height: 100%; 
            position: relative; 
            background: #000; 
        }
        
        .reel-video { 
            width: 100%; 
            height: 100%; 
            object-fit: contain; 
            background: #000; 
        }
        
        .reel-overlay { 
            position: absolute; 
            inset: 0; 
            background: linear-gradient(to bottom, rgba(0,0,0,0.3) 0%, transparent 30%, transparent 70%, rgba(0,0,0,0.5) 100%); 
            pointer-events: none; 
            z-index: 5; 
        }
        
        .reel-info { 
            position: absolute; 
            bottom: 100px; 
            left: 16px; 
            right: 80px; 
            color: white; 
            text-shadow: 0 2px 4px rgba(0,0,0,0.5); 
            pointer-events: none; 
            z-index: 10; 
        }
        
        .reel-title { 
            font-size: 1.2rem; 
            font-weight: 700; 
            margin-bottom: 4px; 
            display: flex; 
            align-items: center; 
            gap: 8px; 
        }
        
        .reel-description { 
            font-size: 0.9rem; 
            color: rgba(255,255,255,0.9); 
            margin-bottom: 8px; 
            display: -webkit-box; 
            -webkit-line-clamp: 2; 
            -webkit-box-orient: vertical; 
            overflow: hidden; 
        }
        
        .reel-stats { 
            display: flex; 
            gap: 16px; 
            font-size: 0.85rem; 
            color: rgba(255,255,255,0.8); 
        }
        
        .reel-actions { 
            position: absolute; 
            right: 12px; 
            bottom: 120px; 
            display: flex; 
            flex-direction: column; 
            gap: 20px; 
            z-index: 30; 
            pointer-events: none;
        }
        
        .reel-action-btn { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 4px; 
            color: white; 
            text-shadow: 0 2px 4px rgba(0,0,0,0.3); 
            pointer-events: auto; 
            cursor: pointer; 
            transition: transform 0.2s;
        }
        
        .reel-action-btn:hover { transform: scale(1.1); }
        
        .reel-action-btn .icon-circle { 
            width: 48px; 
            height: 48px; 
            background: rgba(0,0,0,0.6); 
            backdrop-filter: blur(10px); 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 1.4rem; 
            border: 1px solid rgba(255,255,255,0.2); 
        }
        
        .reel-action-btn span { font-size: 0.7rem; font-weight: 600; }
        .reel-action-btn.liked .icon-circle i { color: var(--liked-color) !important; }

        .video-info-btn {
            position: absolute;
            top: 60px;
            left: 16px;
            width: 44px;
            height: 44px;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(10px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            z-index: 40;
            cursor: pointer;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .video-info-btn:hover { background: var(--primary); }

        .video-info-drawer-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            display: flex;
            align-items: flex-end;
            justify-content: center;
        }
        
        .video-info-drawer {
            background: var(--surface);
            width: 100%;
            max-width: 500px;
            max-height: 85vh;
            border-top-left-radius: 24px;
            border-top-right-radius: 24px;
            animation: slideUp 0.3s ease-out;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .video-info-drawer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
        }
        
        .video-info-drawer-header h3 {
            font-size: 1.25rem;
            font-weight: 700;
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .video-info-drawer-close {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--surface-light);
            border: none;
            color: var(--text);
            font-size: 1.2rem;
            cursor: pointer;
        }
        
        .video-info-drawer-content {
            padding: 20px;
            overflow-y: auto;
            max-height: calc(85vh - 80px);
        }

        .video-info-price-tag {
            display: inline-block;
            background: var(--gradient);
            padding: 8px 16px;
            border-radius: 30px;
            font-weight: 700;
            font-size: 1.5rem;
            color: white;
            margin-top: 8px;
        }
        
        .video-info-tier-badge {
            display: inline-block;
            background: var(--surface-light);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }
        
        .video-info-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }
        
        .video-info-action-btn {
            flex: 1;
            padding: 14px;
            border-radius: 40px;
            font-weight: 600;
            font-size: 1rem;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .video-info-action-btn.book {
            background: var(--surface-light);
            color: var(--text);
            border: 1px solid var(--border);
        }
        
        .video-info-action-btn.book:hover {
            background: var(--primary);
            color: white;
        }
        
        .video-info-action-btn.buy {
            background: var(--gradient);
            color: white;
        }

        .play-pause-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.6);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 25;
        }
        
        .play-pause-indicator.show {
            opacity: 1;
            animation: fadeOut 0.5s forwards;
        }
        
        @keyframes fadeOut {
            0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1.5); }
        }

        .top-nav { 
            position: fixed; 
            top: 0; 
            left: 0; 
            right: 0; 
            z-index: 1000; 
            padding: 1rem; 
            background: rgba(0,0,0,0.9); 
            backdrop-filter: blur(20px); 
            border-bottom: 1px solid var(--border); 
        }
        
        .nav-content { 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
        }
        
        .logo { 
            display: flex; 
            align-items: center; 
            gap: 0.75rem; 
            font-weight: 700; 
            text-decoration: none; 
            color: var(--text); 
        }
        
        .logo-icon { 
            width: 2rem; 
            height: 2rem; 
            background: var(--gradient); 
            border-radius: 0.5rem; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            color: white; 
        }
        
        .nav-actions { 
            display: flex; 
            align-items: center; 
            gap: 0.5rem; 
        }
        
        .bottom-nav { 
            position: fixed; 
            bottom: 0; 
            left: 0; 
            right: 0; 
            z-index: 1000; 
            padding: 0.75rem 1rem; 
            background: rgba(0,0,0,0.9); 
            backdrop-filter: blur(20px); 
            border-top: 1px solid var(--border); 
        }
        
        .nav-items { 
            display: flex; 
            justify-content: space-around; 
            align-items: center; 
            max-width: 400px; 
            margin: 0 auto; 
        }
        
        .nav-item { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            text-decoration: none; 
            color: var(--text-secondary); 
            padding: 0.5rem; 
            border-radius: 0.75rem; 
            min-width: 4rem; 
            transition: all 0.2s; 
        }
        
        .nav-item:hover { 
            color: var(--text); 
            background: rgba(255,255,255,0.05); 
        }
        
        .nav-item.active { 
            color: var(--primary); 
            background: rgba(236,72,153,0.1); 
        }
        
        .nav-item i { 
            font-size: 1.25rem; 
            margin-bottom: 0.25rem; 
        }
        
        .nav-item span { 
            font-size: 0.75rem; 
            font-weight: 500; 
        }

        .btn {
            display: inline-flex; 
            align-items: center; 
            justify-content: center; 
            gap: 0.5rem; 
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem; 
            font-weight: 600; 
            font-size: 0.875rem; 
            cursor: pointer; 
            border: none;
            transition: all 0.2s ease; 
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.3);
        }
        
        .btn-primary { 
            background: var(--gradient); 
            color: white; 
        }
        
        .btn-primary:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 6px 12px -2px rgba(236,72,153,0.4); 
        }
        
        .btn-secondary { 
            background: var(--surface-light); 
            color: var(--text); 
            border: 1px solid var(--border); 
        }
        
        .btn-secondary:hover { 
            background: #3f3f46; 
        }
        
        .btn-icon { 
            width: 2.5rem; 
            height: 2.5rem; 
            padding: 0; 
            border-radius: 50%; 
        }
        
        .btn-sm { 
            padding: 0.4rem 1rem; 
            font-size: 0.75rem; 
            border-radius: 0.5rem; 
        }
        
        .btn-danger { 
            background: var(--danger); 
            color: white; 
        }
        
        .btn-success { 
            background: var(--success); 
            color: white; 
        }

        .card { 
            background: var(--surface); 
            border-radius: 1rem; 
            border: 1px solid var(--border); 
            overflow: hidden; 
            transition: transform 0.2s, box-shadow 0.2s; 
        }
        
        .card:hover { 
            transform: translateY(-4px); 
            box-shadow: 0 12px 20px -8px rgba(236,72,153,0.2); 
            border-color: var(--primary); 
        }
        
        .content { 
            padding-top: 60px; 
            padding-bottom: 70px; 
            height: 100%; 
            overflow-y: auto !important;
            -webkit-overflow-scrolling: touch;
            position: relative;
        }

        .page {
            overflow-y: auto !important;
            -webkit-overflow-scrolling: touch;
            height: 100%;
        }

        .input-group { margin-bottom: 1.5rem; }
        .input-label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--text-secondary); }
        .input { width: 100%; padding: 0.75rem 1rem; background: var(--surface-light); border: 1px solid var(--border); border-radius: 0.75rem; color: var(--text); font-size: 0.875rem; }
        .input:focus { outline: none; border-color: var(--primary); }
        .textarea { min-height: 80px; resize: vertical; }

        .modal-overlay { 
            position: fixed; 
            inset: 0; 
            background: rgba(0,0,0,0.8); 
            backdrop-filter: blur(10px); 
            z-index: 2000; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            padding: 1rem; 
        }
        
        .modal { 
            background: var(--surface); 
            border-radius: 1.5rem; 
            border: 1px solid var(--border); 
            width: 100%; 
            max-width: 400px; 
            max-height: 90vh; 
            overflow-y: auto; 
        }
        
        .modal-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 1.5rem; 
            border-bottom: 1px solid var(--border); 
        }
        
        .modal-title { 
            font-size: 1.25rem; 
            font-weight: 700; 
            background: var(--gradient); 
            -webkit-background-clip: text; 
            background-clip: text; 
            color: transparent; 
        }
        
        .modal-close { 
            background: none; 
            border: none; 
            color: var(--text-secondary); 
            font-size: 1.25rem; 
            cursor: pointer; 
            width: 2rem; 
            height: 2rem; 
            border-radius: 50%; 
        }
        
        .modal-body { padding: 1.5rem; }
        .modal-footer { display: flex; gap: 1rem; padding: 1rem 1.5rem 1.5rem; border-top: 1px solid var(--border); }

        .tab-bar { 
            display: flex; 
            gap: 0.5rem; 
            background: var(--surface-light); 
            padding: 0.5rem; 
            border-radius: 2rem; 
        }
        
        .tab-item { 
            flex: 1; 
            text-align: center; 
            padding: 0.5rem; 
            border-radius: 2rem; 
            font-size: 0.875rem; 
            font-weight: 600; 
            color: var(--text-secondary); 
            cursor: pointer; 
        }
        
        .tab-item.active { 
            background: var(--gradient); 
            color: white; 
        }

        .accounts-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); 
            gap: 1.5rem; 
        }
        
        .account-card { 
            background: var(--surface); 
            border-radius: 1.5rem; 
            border: 1px solid var(--border); 
            padding: 1.5rem; 
        }
        
        .account-card:hover { 
            border-color: var(--primary); 
        }
        
        .account-icon { 
            width: 3rem; 
            height: 3rem; 
            border-radius: 1rem; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 1.5rem; 
            margin-bottom: 1rem; 
        }
        
        .account-icon.small { background: linear-gradient(135deg, #3b82f6, #8b5cf6); }
        .account-icon.medium { background: linear-gradient(135deg, #f59e0b, #ef4444); }
        .account-icon.big { background: linear-gradient(135deg, #10b981, #3b82f6); }
        
        .badge { 
            padding: 0.25rem 0.75rem; 
            border-radius: 1rem; 
            font-size: 0.7rem; 
            font-weight: 600; 
        }
        
        .badge-primary { background: var(--primary); color: white; }
        .badge-secondary { background: var(--secondary); color: white; }
        .badge-warning { background: var(--warning); color: black; }
        
        .account-actions { 
            display: flex; 
            gap: 0.5rem; 
            margin-top: 1rem; 
        }
        
        .account-action-btn { 
            flex: 1; 
            padding: 0.6rem; 
            border-radius: 2rem; 
            font-size: 0.8rem; 
            font-weight: 600; 
            border: none; 
            cursor: pointer; 
            transition: 0.2s; 
        }
        
        .account-action-btn.book { 
            background: var(--surface-light); 
            color: var(--text); 
            border: 1px solid var(--border); 
        }
        
        .account-action-btn.book:hover { 
            background: var(--primary); 
            color: white; 
        }
        
        .account-action-btn.buy { 
            background: var(--gradient); 
            color: white; 
        }
        
        .account-action-btn.share { 
            background: var(--surface-light); 
            color: var(--text); 
            border: 1px solid var(--border); 
        }

        .file-upload-area { 
            border: 2px dashed var(--border); 
            border-radius: 1rem; 
            padding: 2rem; 
            text-align: center; 
            cursor: pointer; 
            transition: 0.2s; 
        }
        
        .file-upload-area:hover { 
            border-color: var(--primary); 
            background: rgba(236,72,153,0.05); 
        }
        
        .file-upload-area.has-file { 
            border-color: var(--success); 
            background: rgba(16,185,129,0.05); 
        }

        .image-upload-area {
            border: 2px dashed var(--border);
            border-radius: 1rem;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: 0.2s;
            background: var(--surface-light);
        }
        
        .image-upload-area:hover {
            border-color: var(--primary);
            background: rgba(236,72,153,0.05);
        }
        
        .image-upload-area.has-file {
            border-color: var(--success);
            background: rgba(16,185,129,0.05);
        }

        .images-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .image-card {
            background: var(--surface);
            border-radius: 1.5rem;
            border: 1px solid var(--border);
            overflow: hidden;
            transition: 0.2s;
        }
        
        .image-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 20px -8px rgba(236,72,153,0.2);
            border-color: var(--primary);
        }
        
        .image-card-media {
            width: 100%;
            height: 250px;
            object-fit: cover;
            background: var(--surface-light);
            cursor: pointer;
        }
        
        .image-card-info {
            padding: 1rem;
        }
        
        .image-card-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .image-card-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .image-card-stats {
            display: flex;
            gap: 1rem;
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
        }
        
        .image-card-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .image-action-btn {
            flex: 1;
            padding: 0.6rem;
            border-radius: 2rem;
            font-size: 0.8rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .image-action-btn.like {
            background: var(--surface-light);
            color: var(--text);
            border: 1px solid var(--border);
        }
        
        .image-action-btn.like:hover {
            background: var(--danger);
            color: white;
        }
        
        .image-action-btn.like.liked {
            background: var(--danger);
            color: white;
        }
        
        .image-action-btn.book {
            background: var(--surface-light);
            color: var(--text);
            border: 1px solid var(--border);
        }
        
        .image-action-btn.book:hover {
            background: var(--primary);
            color: white;
        }
        
        .image-action-btn.buy {
            background: var(--gradient);
            color: white;
        }

        .image-preview-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.95);
            z-index: 3000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        
        .image-preview-content {
            max-width: 90vw;
            max-height: 90vh;
            position: relative;
        }
        
        .image-preview-content img {
            max-width: 100%;
            max-height: 90vh;
            object-fit: contain;
            border-radius: 1rem;
        }
        
        .image-preview-close {
            position: absolute;
            top: -40px;
            right: 0;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
        }

        .image-upload-preview {
            width: 100%;
            max-height: 200px;
            object-fit: contain;
            border-radius: 0.75rem;
            margin-top: 1rem;
            background: var(--surface-light);
        }

        .progress-bar { 
            background: var(--surface-light); 
            height: 0.5rem; 
            border-radius: 1rem; 
            overflow: hidden; 
        }
        
        .progress-fill { 
            background: var(--gradient); 
            height: 100%; 
            transition: width 0.3s; 
        }

        .image-upload-status {
            margin-top: 1rem;
            padding: 1rem;
            background: var(--surface-light);
            border-radius: 0.75rem;
        }

        #toast { 
            position: fixed; 
            bottom: 80px; 
            left: 16px; 
            right: 16px; 
            z-index: 3000; 
            display: flex; 
            justify-content: center; 
            pointer-events: none; 
        }
        
        #toast > div { 
            max-width: 400px; 
            width: 100%; 
            background: var(--surface); 
            border: 1px solid var(--border); 
            border-radius: 1rem; 
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.5); 
            padding: 1rem; 
        }

        .offline-indicator { 
            position: fixed; 
            top: 60px; 
            left: 16px; 
            right: 16px; 
            background: var(--danger); 
            color: white; 
            padding: 0.75rem; 
            border-radius: 0.75rem; 
            text-align: center; 
            font-size: 0.875rem; 
            z-index: 2000; 
            transform: translateY(-100px); 
            transition: transform 0.3s; 
            display: none;
        }
        
        .offline-indicator.show { 
            transform: translateY(0); 
            display: block;
        }

        .notification-bell { 
            position: fixed; 
            bottom: 90px; 
            right: 16px; 
            width: 48px; 
            height: 48px; 
            background: var(--gradient); 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            color: white; 
            font-size: 1.25rem; 
            cursor: pointer; 
            z-index: 1500; 
            box-shadow: 0 4px 12px rgba(236,72,153,0.4); 
        }
        
        .notification-badge { 
            position: absolute; 
            top: -4px; 
            right: -4px; 
            background: var(--danger); 
            color: white; 
            font-size: 0.7rem; 
            min-width: 20px; 
            height: 20px; 
            border-radius: 10px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            padding: 0 4px; 
        }

        .pwa-install-btn { 
            position: fixed; 
            bottom: 90px; 
            left: 16px; 
            background: var(--gradient); 
            color: white; 
            border: none; 
            border-radius: 2rem; 
            padding: 0.75rem 1.25rem; 
            font-weight: 600; 
            z-index: 1500; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            gap: 0.5rem; 
            box-shadow: 0 4px 12px rgba(236,72,153,0.4);
        }
        
        .pwa-install-btn.hidden { display: none !important; }

        .phone-input-container { display: flex; gap: 8px; }
        .country-code-select { width: 100px; padding: 0.75rem; background: var(--surface-light); border: 1px solid var(--border); border-radius: 0.75rem; color: var(--text); }
        .phone-number-input { flex: 1; }

        .install-instructions {
            position: fixed;
            bottom: 150px;
            left: 16px;
            right: 16px;
            background: var(--surface);
            border: 2px solid var(--primary);
            border-radius: 1rem;
            padding: 1rem;
            z-index: 1600;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            animation: slideUp 0.3s ease-out;
        }
        
        .install-instructions.hidden { display: none; }
        .install-instructions h4 { color: var(--primary); margin-bottom: 0.5rem; }
        .install-instructions ol { margin-left: 1.5rem; font-size: 0.9rem; color: var(--text-secondary); }
        .close-instructions {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.2rem;
            cursor: pointer;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .stat-card {
            background: var(--surface-light);
            padding: 1rem;
            border-radius: 1rem;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <!-- Offline Indicator -->
    <div id="offline-indicator" class="offline-indicator">
        <i class="fas fa-wifi-slash"></i> You are currently offline. Some features may be limited.
    </div>

    <!-- PWA Install Button -->
    <button id="pwa-install-btn" class="pwa-install-btn hidden">
        <i class="fas fa-download"></i> Install App
    </button>

    <!-- Manual Install Instructions -->
    <div id="install-instructions" class="install-instructions hidden">
        <button class="close-instructions" onclick="closeInstallInstructions()"><i class="fas fa-times"></i></button>
        <h4><i class="fas fa-mobile-alt"></i> Install GK Store</h4>
        <p>To install this app on your device:</p>
        <div id="ios-instructions" class="hidden">
            <p><strong>iPhone/iPad:</strong></p>
            <ol>
                <li>Tap the <i class="fas fa-share-alt"></i> Share button</li>
                <li>Scroll down and tap "Add to Home Screen"</li>
                <li>Tap "Add" in the top right corner</li>
            </ol>
        </div>
        <div id="android-instructions" class="hidden">
            <p><strong>Android:</strong></p>
            <ol>
                <li>Tap the menu <i class="fas fa-ellipsis-vertical"></i> (3 dots)</li>
                <li>Tap "Install app" or "Add to Home screen"</li>
                <li>Tap "Install" to confirm</li>
            </ol>
        </div>
    </div>

    <!-- Top Navigation -->
    <nav class="top-nav">
        <div class="nav-content">
            <a href="#home" class="logo" onclick="showPage('home')">
                <div class="logo-icon">
                    <span style="font-size: 1rem; color: white;">GK</span>
                </div>
                <span class="gradient-text">GK Store</span>
            </a>
            
            <div class="nav-actions">
                <button class="btn btn-icon btn-secondary" onclick="toggleLanguage()">
                    <i class="fas fa-globe"></i>
                </button>
                <button class="btn btn-icon btn-secondary" onclick="showPage('admin')">
                    <i class="fas fa-user-shield"></i>
                </button>
                <button class="btn btn-icon btn-secondary" onclick="toggleTheme()">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div id="content-container" class="content">
        <!-- Home Page -->
        <div id="home-page" class="page">
            <div class="reels-container" id="reels-container"></div>
        </div>

        <!-- Accounts Page -->
        <div id="accounts-page" class="page hidden">
            <div class="px-4">
                <h2 class="text-2xl font-bold mb-6">Premium Accounts</h2>
                <div class="tab-bar mb-6">
                    <div class="tab-item active" onclick="filterAccounts('all')">All</div>
                    <div class="tab-item" onclick="filterAccounts('small')">Small</div>
                    <div class="tab-item" onclick="filterAccounts('medium')">Medium</div>
                    <div class="tab-item" onclick="filterAccounts('big')">Big</div>
                </div>
                <div id="accounts-grid" class="accounts-grid"></div>
            </div>
        </div>

        <!-- Images Page -->
        <div id="images-page" class="page hidden">
            <div class="px-4">
                <h2 class="text-2xl font-bold mb-6">Image Gallery</h2>
                <div id="admin-image-upload-section" class="hidden mb-6">
                    <button class="btn btn-primary w-full" onclick="showUploadImageModal()">
                        <i class="fas fa-cloud-upload-alt"></i> Upload New Image
                    </button>
                </div>
                <div id="images-grid" class="images-grid"></div>
                <div id="images-empty" class="hidden text-center py-12">
                    <i class="fas fa-images text-5xl text-zinc-600 mb-4"></i>
                    <h3 class="text-xl font-semibold mb-2">No Images Yet</h3>
                    <p class="text-zinc-400">Check back later for new images</p>
                </div>
            </div>
        </div>

        <!-- Contact Page -->
        <div id="contact-page" class="page hidden">
            <div class="px-4">
                <h2 class="text-2xl font-bold mb-6">Contact Us</h2>
                <div class="grid gap-6">
                    <div class="card p-4">
                        <div class="flex items-center gap-4 mb-4">
                            <div class="w-12 h-12 rounded-full gradient-bg flex items-center justify-center">
                                <i class="fab fa-whatsapp text-white text-xl"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold">WhatsApp Support 1</h3>
                                <p class="text-zinc-400">+93 793066322</p>
                            </div>
                        </div>
                        <button class="btn btn-primary w-full" onclick="openWhatsApp('93793066322')">
                            <i class="fab fa-whatsapp"></i> Chat with Support 1
                        </button>
                    </div>
                    
                    <div class="card p-4">
                        <div class="flex items-center gap-4 mb-4">
                            <div class="w-12 h-12 rounded-full gradient-bg flex items-center justify-center">
                                <i class="fab fa-whatsapp text-white text-xl"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold">WhatsApp Support 2</h3>
                                <p class="text-zinc-400">+93 749949041</p>
                            </div>
                        </div>
                        <button class="btn btn-primary w-full" onclick="openWhatsApp('93749949041')">
                            <i class="fab fa-whatsapp"></i> Chat with Support 2
                        </button>
                    </div>
                    
                    <div class="card p-4">
                        <div class="flex items-center gap-4 mb-4">
                            <div class="w-12 h-12 rounded-full bg-amber-500 flex items-center justify-center">
                                <i class="fas fa-wallet text-white"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold">USDT Address (TRC20)</h3>
                                <p class="text-zinc-400 text-sm">Send payment to this address</p>
                            </div>
                        </div>
                        <div class="bg-surface-light p-3 rounded-lg mb-4">
                            <code id="usdt-address" class="text-sm break-all">TYpeauzqbVusejMAhJPnXuSb7wY6p69ZoY</code>
                        </div>
                        <button class="btn btn-secondary w-full" onclick="copyUSDTAddress()">
                            <i class="far fa-copy"></i> Copy Address
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Page -->
        <div id="admin-page" class="page hidden">
            <div class="px-4">
                <h2 class="text-2xl font-bold mb-6">Admin Panel</h2>
                
                <div class="grid gap-6">
                    <div class="card p-4">
                        <h3 class="font-semibold mb-4">Admin Login</h3>
                        <form id="admin-login-form" onsubmit="return false;">
                            <div class="input-group">
                                <label class="input-label">Admin Email</label>
                                <input type="email" id="admin-email" class="input" required>
                            </div>
                            <div class="input-group">
                                <label class="input-label">Admin Password</label>
                                <input type="password" id="admin-password" class="input" required>
                            </div>
                            <button type="button" class="btn btn-primary w-full" onclick="adminLogin()">
                                <i class="fas fa-lock"></i> Login as Admin
                            </button>
                        </form>
                    </div>
                    
                    <div id="admin-dashboard" class="hidden">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" id="admin-video-count">0</div>
                                <div class="stat-label">Total Videos</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="admin-image-count">0</div>
                                <div class="stat-label">Total Images</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="admin-registered-users">0</div>
                                <div class="stat-label">Total Users</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="admin-online-users">0</div>
                                <div class="stat-label">Online Now</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="admin-installed-users">0</div>
                                <div class="stat-label">Installed</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="admin-total-views">0</div>
                                <div class="stat-label">Unique Views</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="admin-total-likes">0</div>
                                <div class="stat-label">Total Likes</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="admin-image-likes">0</div>
                                <div class="stat-label">Image Likes</div>
                            </div>
                        </div>
                        
                        <div class="card p-4 mb-6">
                            <h3 class="font-semibold mb-4">Quick Actions</h3>
                            <div class="grid grid-cols-1 gap-3">
                                <button class="btn btn-secondary" onclick="showUploadVideo()"><i class="fas fa-upload"></i> Upload Video</button>
                                <button class="btn btn-secondary" onclick="showUploadImageModal()"><i class="fas fa-image"></i> Upload Image</button>
                                <button class="btn btn-secondary" onclick="showManageVideos()"><i class="fas fa-video"></i> Manage Videos</button>
                                <button class="btn btn-secondary" onclick="showManageImages()"><i class="fas fa-images"></i> Manage Images</button>
                                <button class="btn btn-secondary" onclick="showBookRequests()"><i class="fas fa-bookmark"></i> Book Requests</button>
                                <button class="btn btn-danger" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout Admin</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notifications Page -->
        <div id="notifications-page" class="page hidden">
            <div class="px-4">
                <h2 class="text-2xl font-bold mb-6">New Content</h2>
                <div id="notifications-list" class="space-y-3"></div>
                <div id="notifications-empty" class="hidden text-center py-12">
                    <i class="far fa-bell text-4xl text-zinc-600 mb-4"></i>
                    <h3 class="text-xl font-semibold mb-2">No New Content</h3>
                    <p class="text-zinc-400">Check back later for new videos and images</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <div class="nav-items">
            <a href="#accounts" class="nav-item" onclick="showPage('accounts')">
                <i class="fas fa-shopping-bag"></i>
                <span>Accounts</span>
            </a>
            <a href="#images" class="nav-item" onclick="showPage('images')">
                <i class="fas fa-images"></i>
                <span>Images</span>
            </a>
            <a href="#home" class="nav-item active" onclick="showPage('home')">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </a>
            <a href="#contact" class="nav-item" onclick="showPage('contact')">
                <i class="fab fa-whatsapp"></i>
                <span>Contact</span>
            </a>
            <a href="#admin" class="nav-item" onclick="showPage('admin')">
                <i class="fas fa-user-shield"></i>
                <span>Admin</span>
            </a>
        </div>
    </nav>

    <!-- Notification Bell -->
    <div class="notification-bell" onclick="showPage('notifications')">
        <i class="far fa-bell"></i>
        <div id="notification-count" class="notification-badge hidden">0</div>
    </div>

    <!-- Rotate Screen Indicator -->
    <div id="rotate-indicator" class="rotate-indicator hidden">
        <i class="fas fa-undo-alt"></i> Rotate device for fullscreen
    </div>

    <!-- Modals -->
    <div id="book-modal" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Book Item</h3>
                <button class="modal-close" onclick="closeModal('book-modal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div class="card glass-effect p-4 mb-4">
                    <h4 id="book-account-name" class="font-semibold mb-1"></h4>
                    <p id="book-account-tier" class="badge badge-secondary text-xs"></p>
                    <p id="book-account-price" class="text-lg font-bold mt-2"></p>
                </div>
                <form id="book-form" onsubmit="return false;">
                    <div class="input-group">
                        <label class="input-label">Your Name</label>
                        <input type="text" class="input" id="book-name" required>
                    </div>
                    <div class="input-group">
                        <label class="input-label">WhatsApp Number</label>
                        <div class="phone-input-container">
                            <select id="book-country-code" class="country-code-select">
                                <option value="93">+93</option>
                                <option value="91">+91</option>
                                <option value="92">+92</option>
                                <option value="1">+1</option>
                                <option value="44">+44</option>
                                <option value="971">+971</option>
                            </select>
                            <input type="tel" class="input phone-number-input" id="book-whatsapp" required placeholder="Phone number">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary flex-1" onclick="closeModal('book-modal')">Cancel</button>
                <button class="btn btn-primary flex-1" onclick="submitBookRequest()">Submit</button>
            </div>
        </div>
    </div>

    <div id="buy-modal" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Buy with USDT</h3>
                <button class="modal-close" onclick="closeModal('buy-modal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div class="card glass-effect p-4 mb-4">
                    <h4 id="buy-account-name" class="font-semibold mb-1"></h4>
                    <p id="buy-account-tier" class="badge badge-secondary text-xs"></p>
                    <p id="buy-account-price" class="text-2xl font-bold mt-2"></p>
                </div>
                <div class="bg-surface-light p-4 rounded-lg mb-4">
                    <div class="flex justify-between mb-2">
                        <span class="text-sm text-zinc-400">USDT Address (TRC20)</span>
                        <button class="btn btn-sm btn-secondary" onclick="copyAddress()">Copy</button>
                    </div>
                    <code id="payment-address" class="text-sm break-all">TYpeauzqbVusejMAhJPnXuSb7wY6p69ZoY</code>
                </div>
                <button class="btn btn-primary w-full" onclick="openPaymentChat()">
                    <i class="fab fa-whatsapp"></i> Confirm on WhatsApp
                </button>
            </div>
        </div>
    </div>

    <div id="share-modal" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Share App</h3>
                <button class="modal-close" onclick="closeModal('share-modal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <h4 class="font-semibold text-center mb-4">GK Store App</h4>
                <div class="grid grid-cols-4 gap-3 mb-6">
                    <button class="flex flex-col items-center p-3 bg-surface-light rounded-lg" onclick="shareAppViaWhatsApp()"><i class="fab fa-whatsapp text-green-500 text-2xl mb-2"></i><span class="text-xs">WhatsApp</span></button>
                    <button class="flex flex-col items-center p-3 bg-surface-light rounded-lg" onclick="shareAppViaTelegram()"><i class="fab fa-telegram text-blue-500 text-2xl mb-2"></i><span class="text-xs">Telegram</span></button>
                    <button class="flex flex-col items-center p-3 bg-surface-light rounded-lg" onclick="copyAppLink()"><i class="fas fa-link text-purple-500 text-2xl mb-2"></i><span class="text-xs">Copy</span></button>
                    <button class="flex flex-col items-center p-3 bg-surface-light rounded-lg" onclick="shareAppViaSystem()"><i class="fas fa-share-alt text-pink-500 text-2xl mb-2"></i><span class="text-xs">More</span></button>
                </div>
            </div>
        </div>
    </div>

    <div id="upload-video-modal" class="modal-overlay hidden">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title">Upload Video</h3>
                <button class="modal-close" onclick="closeModal('upload-video-modal'); resetUploadForm()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label class="input-label">Video Title</label>
                    <input type="text" class="input" id="video-title-input" placeholder="Enter video title" required>
                </div>
                <div class="input-group">
                    <label class="input-label">Description</label>
                    <textarea class="input textarea" id="video-description-input" placeholder="Write video information" rows="4"></textarea>
                </div>
                <div class="input-group">
                    <label class="input-label">Price ($)</label>
                    <input type="number" class="input" id="video-price" step="0.01" placeholder="0.00" required>
                </div>
                <div class="input-group">
                    <label class="input-label">Tier</label>
                    <select class="input" id="video-tier" required>
                        <option value="">Select Tier</option>
                        <option value="small">Small (up to 100MB)</option>
                        <option value="medium">Medium (up to 200MB)</option>
                        <option value="big">Big (up to 500MB)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label class="input-label">Video File</label>
                    <div class="file-upload-area" id="file-upload-area" onclick="document.getElementById('video-file').click()">
                        <i class="fas fa-cloud-upload-alt text-3xl text-primary mb-2"></i>
                        <p id="file-upload-text">Click to select video file</p>
                        <p class="text-xs text-zinc-500 mt-1">MP4, WebM, OGG (max 500MB)</p>
                        <input type="file" id="video-file" accept="video/mp4,video/webm,video/ogg" class="hidden" onchange="handleFileSelect(event)">
                    </div>
                    <div id="file-info" class="hidden mt-2 p-2 bg-surface-light rounded-lg">
                        <p class="text-sm"><span class="font-semibold">Selected:</span> <span id="file-name"></span></p>
                        <p class="text-sm"><span class="font-semibold">Size:</span> <span id="file-size"></span></p>
                    </div>
                </div>
                
                <div id="upload-status" class="upload-status hidden">
                    <div class="flex justify-between text-sm mb-1">
                        <span id="upload-status-text">Uploading...</span>
                        <span id="upload-percentage">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div id="upload-progress" class="progress-fill" style="width: 0%"></div>
                    </div>
                </div>

                <div class="flex gap-2 mt-4">
                    <button class="btn btn-secondary flex-1" onclick="closeModal('upload-video-modal'); resetUploadForm()">Cancel</button>
                    <button class="btn btn-primary flex-1" id="upload-btn" onclick="uploadVideo()"><i class="fas fa-upload"></i> Upload Video</button>
                </div>
            </div>
        </div>
    </div>

    <div id="upload-image-modal" class="modal-overlay hidden">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title">Upload Image</h3>
                <button class="modal-close" onclick="closeModal('upload-image-modal'); resetImageUploadForm()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label class="input-label">Image Title</label>
                    <input type="text" class="input" id="image-title-input" placeholder="Enter image title" required>
                </div>
                <div class="input-group">
                    <label class="input-label">Description</label>
                    <textarea class="input textarea" id="image-description-input" placeholder="Write image description" rows="3"></textarea>
                </div>
                <div class="input-group">
                    <label class="input-label">Price ($) - Optional</label>
                    <input type="number" class="input" id="image-price" step="0.01" placeholder="0.00">
                </div>
                <div class="input-group">
                    <label class="input-label">Image File</label>
                    <div class="image-upload-area" id="image-upload-area" onclick="document.getElementById('image-file').click()">
                        <i class="fas fa-cloud-upload-alt text-3xl text-primary mb-2"></i>
                        <p id="image-upload-text">Click to select image file</p>
                        <p class="text-xs text-zinc-500 mt-1">JPG, PNG, GIF, WEBP (max 10MB)</p>
                        <input type="file" id="image-file" accept="image/jpeg,image/png,image/gif,image/webp" class="hidden" onchange="handleImageSelect(event)">
                    </div>
                    <div id="image-preview-container" class="hidden mt-3">
                        <img id="image-preview" class="image-upload-preview" src="" alt="Preview">
                    </div>
                    <div id="image-file-info" class="hidden mt-2 p-2 bg-surface-light rounded-lg">
                        <p class="text-sm"><span class="font-semibold">Selected:</span> <span id="image-file-name"></span></p>
                        <p class="text-sm"><span class="font-semibold">Size:</span> <span id="image-file-size"></span></p>
                    </div>
                </div>
                
                <div id="image-upload-status" class="image-upload-status hidden">
                    <div class="flex justify-between text-sm mb-1">
                        <span id="image-upload-status-text">Uploading...</span>
                        <span id="image-upload-percentage">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div id="image-upload-progress" class="progress-fill" style="width: 0%"></div>
                    </div>
                </div>

                <div class="flex gap-2 mt-4">
                    <button class="btn btn-secondary flex-1" onclick="closeModal('upload-image-modal'); resetImageUploadForm()">Cancel</button>
                    <button class="btn btn-primary flex-1" id="image-upload-btn" onclick="uploadImage()"><i class="fas fa-upload"></i> Upload Image</button>
                </div>
            </div>
        </div>
    </div>

    <div id="manage-images-modal" class="modal-overlay hidden">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title">Manage Images</h3>
                <button class="modal-close" onclick="closeModal('manage-images-modal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div id="admin-images-list" class="space-y-3 max-h-96 overflow-y-auto"></div>
                <div id="admin-images-empty" class="hidden text-center py-8">
                    <i class="fas fa-images text-4xl text-zinc-600 mb-4"></i>
                    <h3>No Images</h3>
                </div>
            </div>
        </div>
    </div>

    <div id="image-preview-modal" class="image-preview-modal hidden" onclick="closeImagePreview()">
        <div class="image-preview-content" onclick="event.stopPropagation()">
            <img id="preview-image" src="" alt="Preview">
            <button class="image-preview-close" onclick="closeImagePreview()">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <div id="manage-videos-modal" class="modal-overlay hidden">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title">Manage Videos</h3>
                <button class="modal-close" onclick="closeModal('manage-videos-modal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div class="tab-bar mb-4">
                    <div class="tab-item active" onclick="adminFilterVideos('all')">All</div>
                    <div class="tab-item" onclick="adminFilterVideos('small')">Small</div>
                    <div class="tab-item" onclick="adminFilterVideos('medium')">Medium</div>
                    <div class="tab-item" onclick="adminFilterVideos('big')">Big</div>
                </div>
                <div id="admin-videos-list" class="space-y-3 max-h-96 overflow-y-auto"></div>
            </div>
        </div>
    </div>

    <div id="book-requests-modal" class="modal-overlay hidden">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title">Book Requests</h3>
                <button class="modal-close" onclick="closeModal('book-requests-modal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div id="admin-book-requests-list" class="space-y-3 max-h-96 overflow-y-auto"></div>
                <div id="admin-book-requests-empty" class="hidden text-center py-8">
                    <i class="fas fa-inbox text-4xl text-zinc-600 mb-4"></i>
                    <h3>No Requests</h3>
                </div>
            </div>
        </div>
    </div>

    <div id="language-modal" class="modal-overlay hidden">
        <div class="modal" style="max-width: 300px;">
            <div class="modal-header">
                <h3 class="modal-title">Select Language</h3>
                <button class="modal-close" onclick="closeModal('language-modal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body p-0">
                <button class="w-full p-4 text-left hover:bg-surface-light" onclick="setLanguage('en')"> English <i id="lang-en-check" class="fas fa-check text-primary float-right"></i></button>
                <button class="w-full p-4 text-left hover:bg-surface-light" onclick="setLanguage('ps')">  <i id="lang-ps-check" class="fas fa-check text-primary float-right hidden"></i></button>
                <button class="w-full p-4 text-left hover:bg-surface-light" onclick="setLanguage('fa')">  <i id="lang-fa-check" class="fas fa-check text-primary float-right hidden"></i></button>
            </div>
        </div>
    </div>

    <div id="welcome-modal" class="modal-overlay hidden">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-body text-center">
                <div class="w-20 h-20 gradient-bg rounded-2xl flex items-center justify-center mx-auto mb-6">
                    <span style="color: white; font-size: 2rem;">GK</span>
                </div>
                <h2 class="text-2xl font-bold mb-4">Welcome to GK Store!</h2>
                <p class="text-zinc-400 mb-6">Your exclusive gateway to premium video and image content</p>
                <button class="btn btn-primary w-full" onclick="closeWelcomeModal()">Get Started <i class="fas fa-arrow-right ml-2"></i></button>
            </div>
        </div>
    </div>

    <div id="sql-setup-modal" class="modal-overlay hidden">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title">Database Setup</h3>
                <button class="modal-close" onclick="closeModal('sql-setup-modal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <p class="mb-4 text-warning"><i class="fas fa-exclamation-triangle"></i> Run this SQL in Supabase SQL Editor:</p>
                <pre class="bg-black text-green-400 p-3 rounded-lg text-xs overflow-x-auto" style="max-height: 300px;">
CREATE TABLE IF NOT EXISTS public.users (
    id SERIAL PRIMARY KEY,
    user_id TEXT UNIQUE NOT NULL,
    installed BOOLEAN DEFAULT false,
    visits_count INTEGER DEFAULT 1,
    last_seen TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE TABLE IF NOT EXISTS public.video_stats (
    id SERIAL PRIMARY KEY,
    video_id TEXT NOT NULL,
    user_id TEXT NOT NULL,
    action_type TEXT NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    UNIQUE(video_id, user_id, action_type)
);

CREATE TABLE IF NOT EXISTS public.gallery_images (
    id SERIAL PRIMARY KEY,
    title TEXT NOT NULL,
    image_url TEXT NOT NULL,
    image_path TEXT NOT NULL,
    views INTEGER DEFAULT 0,
    likes INTEGER DEFAULT 0,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

INSERT INTO storage.buckets (id, name, public) 
VALUES ('gallery-images', 'gallery-images', true)
ON CONFLICT (id) DO NOTHING;
                </pre>
                <div class="flex gap-2 mt-4">
                    <button class="btn btn-primary flex-1" onclick="window.open('https://app.supabase.com', '_blank')">
                        <i class="fas fa-external-link-alt"></i> Open Supabase
                    </button>
                    <button class="btn btn-secondary flex-1" onclick="closeModal('sql-setup-modal')">Close</button>
                </div>
            </div>
        </div>
    </div>

    <div id="video-info-drawer" class="video-info-drawer-overlay hidden">
        <div class="video-info-drawer">
            <div class="video-info-drawer-header">
                <h3>Video Information</h3>
                <button class="video-info-drawer-close" onclick="closeVideoDrawer()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="video-info-drawer-content" id="video-drawer-content"></div>
        </div>
    </div>

    <div id="play-pause-indicator" class="play-pause-indicator">
        <i class="fas fa-play"></i>
    </div>

    <div id="toast" class="hidden">
        <div class="bg-surface border border-border rounded-lg shadow-xl p-4">
            <div class="flex items-start gap-3">
                <i id="toast-icon" class="fas fa-check-circle text-success"></i>
                <div class="flex-1">
                    <h4 id="toast-title" class="font-semibold"></h4>
                    <p id="toast-message" class="text-sm text-zinc-400"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://ieinqlpnubtwwkldqhab.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImllaW5xbHBudWJ0d3drbGRxaGFiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1MzA3ODcsImV4cCI6MjA4NjEwNjc4N30.sJsoTu1bHBgconNOPfXZk33Ttuy1ZKC2oW2SonBnQ4o';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        const appState = {
            currentPage: 'home',
            currentVideoIndex: 0,
            videos: [],
            images: [],
            accounts: [],
            notifications: [],
            bookRequests: [],
            likedImages: new Set(),
            likedVideos: new Set(),
            language: 'en',
            theme: 'dark',
            isAdminLoggedIn: false,
            userStats: { 
                registeredUsers: 0, 
                onlineUsers: 0,
                installedUsers: 0,
                totalViews: 0,
                totalLikes: 0,
                imageLikes: 0 
            },
            currentUpload: { file: null },
            currentImageUpload: { file: null },
            currentAccount: null,
            scrollTimeout: null,
            deferredPrompt: null,
            orientationTimeout: null,
            unseenVideosCount: 0,
            unseenImagesCount: 0,
            lastVideoCheck: new Date(),
            lastImageCheck: new Date(),
            installInstructionsShown: false,
            userId: null,
            sessionId: null
        };

        async function initApp() {
            loadPreferences();
            setupEventListeners();
            setupOrientationHandling();
            setupPWAInstall();
            await generateUserId();
            await checkDatabaseSetup();
            await trackUserVisit();
            await checkInstallStatus();
            
            showPage('home');
            await loadInitialData();
            startContentCheckInterval();
            startOnlineUsersTracking();
            
            setTimeout(checkAndShowInstallButton, 2000);
            setTimeout(() => showWelcomeModal(), 1000);
        }

        async function generateUserId() {
            let userId = localStorage.getItem('userId');
            if (!userId) {
                userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('userId', userId);
            }
            appState.userId = userId;
            appState.sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        async function checkInstallStatus() {
            try {
                const isStandalone = window.matchMedia('(display-mode: standalone)').matches || 
                                    window.navigator.standalone || 
                                    window.matchMedia('(display-mode: fullscreen)').matches ||
                                    window.matchMedia('(display-mode: minimal-ui)').matches;
                
                if (isStandalone) {
                    await supabase
                        .from('users')
                        .update({ installed: true })
                        .eq('user_id', appState.userId);
                }
            } catch (error) {
                console.error('Error checking install status:', error);
            }
        }

        async function trackUserVisit() {
            try {
                const isInstalled = window.matchMedia('(display-mode: standalone)').matches || 
                                   window.navigator.standalone;

                const { data: existingUser } = await supabase
                    .from('users')
                    .select('*')
                    .eq('user_id', appState.userId)
                    .maybeSingle();

                if (existingUser) {
                    await supabase
                        .from('users')
                        .update({
                            last_seen: new Date().toISOString(),
                            visits_count: (existingUser.visits_count || 1) + 1,
                            installed: isInstalled || existingUser.installed
                        })
                        .eq('user_id', appState.userId);
                } else {
                    await supabase
                        .from('users')
                        .insert([{
                            user_id: appState.userId,
                            last_seen: new Date().toISOString(),
                            visits_count: 1,
                            installed: isInstalled
                        }]);
                }
            } catch (error) {
                console.error('Error tracking user:', error);
            }
        }

        async function trackVideoView(videoId) {
            try {
                const { data: existingView } = await supabase
                    .from('video_stats')
                    .select('id')
                    .eq('video_id', videoId)
                    .eq('user_id', appState.userId)
                    .eq('action_type', 'view')
                    .maybeSingle();

                if (!existingView) {
                    await supabase
                        .from('video_stats')
                        .insert([{
                            video_id: videoId,
                            user_id: appState.userId,
                            action_type: 'view'
                        }]);

                    const { count } = await supabase
                        .from('video_stats')
                        .select('*', { count: 'exact', head: true })
                        .eq('video_id', videoId)
                        .eq('action_type', 'view');
                    
                    const video = appState.videos.find(v => v.id === videoId);
                    if (video) {
                        video.views = count || 0;
                        await supabase
                            .from('videos')
                            .update({ views: video.views })
                            .eq('video_id', videoId);
                    }
                    updateUserStats();
                }
            } catch (error) {
                console.error('Error tracking view:', error);
            }
        }

        async function trackVideoLike(videoId) {
            try {
                const { data: existingLike } = await supabase
                    .from('video_stats')
                    .select('id')
                    .eq('video_id', videoId)
                    .eq('user_id', appState.userId)
                    .eq('action_type', 'like')
                    .maybeSingle();

                if (!existingLike) {
                    await supabase
                        .from('video_stats')
                        .insert([{
                            video_id: videoId,
                            user_id: appState.userId,
                            action_type: 'like'
                        }]);

                    const { count } = await supabase
                        .from('video_stats')
                        .select('*', { count: 'exact', head: true })
                        .eq('video_id', videoId)
                        .eq('action_type', 'like');
                    
                    const video = appState.videos.find(v => v.id === videoId);
                    if (video) {
                        video.likes = count || 0;
                        await supabase
                            .from('videos')
                            .update({ likes: video.likes })
                            .eq('video_id', videoId);
                    }
                    updateUserStats();
                }
            } catch (error) {
                console.error('Error tracking like:', error);
            }
        }

        async function trackVideoUnlike(videoId) {
            try {
                await supabase
                    .from('video_stats')
                    .delete()
                    .eq('video_id', videoId)
                    .eq('user_id', appState.userId)
                    .eq('action_type', 'like');

                const { count } = await supabase
                    .from('video_stats')
                    .select('*', { count: 'exact', head: true })
                    .eq('video_id', videoId)
                    .eq('action_type', 'like');
                
                const video = appState.videos.find(v => v.id === videoId);
                if (video) {
                    video.likes = count || 0;
                    await supabase
                        .from('videos')
                        .update({ likes: video.likes })
                        .eq('video_id', videoId);
                }
                updateUserStats();
            } catch (error) {
                console.error('Error tracking unlike:', error);
            }
        }

        async function trackImageLike(imageId) {
            try {
                const image = appState.images.find(img => img.id === imageId);
                if (image) {
                    image.likes = (image.likes || 0) + 1;
                    await supabase
                        .from('gallery_images')
                        .update({ likes: image.likes })
                        .eq('id', imageId);
                    updateUserStats();
                }
            } catch (error) {
                console.error('Error tracking image like:', error);
            }
        }

        async function trackImageUnlike(imageId) {
            try {
                const image = appState.images.find(img => img.id === imageId);
                if (image) {
                    image.likes = Math.max(0, (image.likes || 0) - 1);
                    await supabase
                        .from('gallery_images')
                        .update({ likes: image.likes })
                        .eq('id', imageId);
                    updateUserStats();
                }
            } catch (error) {
                console.error('Error tracking image unlike:', error);
            }
        }

        function startOnlineUsersTracking() {
            updateUserStats();
            setInterval(updateUserStats, 30000);
        }

        async function updateUserStats() {
            try {
                await supabase
                    .from('users')
                    .update({ last_seen: new Date().toISOString() })
                    .eq('user_id', appState.userId);

                const fiveMinutesAgo = new Date(Date.now() - 5 * 60 * 1000).toISOString();
                const { count: onlineCount } = await supabase
                    .from('users')
                    .select('*', { count: 'exact', head: true })
                    .gt('last_seen', fiveMinutesAgo);
                appState.userStats.onlineUsers = onlineCount || 0;

                const { count: totalUsers } = await supabase
                    .from('users')
                    .select('*', { count: 'exact', head: true });
                appState.userStats.registeredUsers = totalUsers || 0;

                const { count: installedCount } = await supabase
                    .from('users')
                    .select('*', { count: 'exact', head: true })
                    .eq('installed', true);
                appState.userStats.installedUsers = installedCount || 0;

                const { data: videoViews } = await supabase
                    .from('video_stats')
                    .select('video_id')
                    .eq('action_type', 'view');
                appState.userStats.totalViews = videoViews ? videoViews.length : 0;

                const { count: likesCount } = await supabase
                    .from('video_stats')
                    .select('*', { count: 'exact', head: true })
                    .eq('action_type', 'like');
                appState.userStats.totalLikes = likesCount || 0;

                const { data: images } = await supabase
                    .from('gallery_images')
                    .select('likes');
                if (images) {
                    appState.userStats.imageLikes = images.reduce((sum, img) => sum + (img.likes || 0), 0);
                }

                if (appState.isAdminLoggedIn) updateAdminStats();
            } catch (error) {
                console.error('Error updating user stats:', error);
            }
        }

        async function checkDatabaseSetup() {
            try {
                const { error } = await supabase
                    .from('users')
                    .select('count')
                    .limit(1);
                if (error?.code === '42P01') showModal('sql-setup-modal');
            } catch {}
        }

        function showPage(page) {
            document.querySelectorAll('[id$="-page"]').forEach(p => p.classList.add('hidden'));
            document.getElementById(`${page}-page`).classList.remove('hidden');
            appState.currentPage = page;
            
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            document.querySelector(`.nav-item[href="#${page}"]`)?.classList.add('active');
            
            if (page === 'home') { 
                setTimeout(() => { 
                    pauseAllVideos(); 
                    playVideoAtIndex(appState.currentVideoIndex); 
                }, 100); 
                closeVideoDrawer();
            }
            if (page === 'accounts') loadAccountsContent();
            if (page === 'images') {
                loadImages();
                document.getElementById('admin-image-upload-section').classList.toggle('hidden', !appState.isAdminLoggedIn);
            }
            if (page === 'admin') {
                document.getElementById('admin-dashboard').classList.toggle('hidden', !appState.isAdminLoggedIn);
                loadAdminBookRequests();
                updateAdminStats();
            }
            if (page === 'notifications') {
                appState.unseenVideosCount = appState.unseenImagesCount = 0;
                updateNotificationBadge();
                loadNotificationsPage();
            }
        }

        async function loadInitialData() {
            await Promise.all([loadVideos(), loadAccounts(), loadBookRequests(), loadImages()]);
            if (appState.isAdminLoggedIn) updateAdminStats();
            renderReels();
            renderImages();
        }

        async function loadVideos() {
            try {
                const { data, error } = await supabase
                    .from('videos')
                    .select('*')
                    .order('created_at', { ascending: false });
                    
                if (error) { 
                    console.error('Error loading videos:', error); 
                    initializeWithDemoData(); 
                    return; 
                }
                
                appState.videos = (data || []).map(v => ({
                    id: v.video_id,
                    title: v.video_title,
                    description: v.description,
                    views: v.views || 0,
                    likes: v.likes || 0,
                    url: v.video_url,
                    tier: v.account_tier,
                    price: v.price,
                    viewTracked: false,
                    created_at: v.created_at,
                    account: { 
                        id: v.video_id, 
                        title: v.video_title, 
                        tier: v.account_tier, 
                        price: v.price, 
                        url: v.video_url 
                    }
                }));
                appState.accounts = appState.videos.map(v => ({ 
                    id: v.id, 
                    title: v.title, 
                    description: v.description, 
                    tier: v.tier, 
                    price: v.price, 
                    sold: false, 
                    url: v.url 
                }));
            } catch (error) {
                console.error('Error in loadVideos:', error);
                appState.videos = appState.accounts = [];
            }
        }

        async function loadAccounts() {
            try {
                const { data, error } = await supabase
                    .from('videos')
                    .select('video_id, video_title, description, account_tier, price, sold, video_url');
                if (!error && data) {
                    appState.accounts = data.map(v => ({ 
                        id: v.video_id, 
                        title: v.video_title, 
                        description: v.description, 
                        tier: v.account_tier, 
                        price: v.price, 
                        sold: v.sold || false, 
                        url: v.video_url 
                    }));
                }
            } catch (error) {
                console.error('Error in loadAccounts:', error);
            }
        }

        async function loadBookRequests() {
            try {
                const { data, error } = await supabase
                    .from('book_requests')
                    .select('*')
                    .order('created_at', { ascending: false });
                if (!error && data) appState.bookRequests = data;
            } catch (error) {
                console.log('Error in loadBookRequests:', error);
                appState.bookRequests = [];
            }
        }

        async function loadImages() {
            try {
                const { data, error } = await supabase
                    .from('gallery_images')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) { 
                    console.error('Error loading images:', error); 
                    if (error.code === '42P01') showModal('sql-setup-modal'); 
                    return; 
                }

                appState.images = data || [];
                renderImages();
                if (appState.isAdminLoggedIn) updateAdminStats();
            } catch (error) {
                console.error('Error in loadImages:', error);
            }
        }

        function renderImages() {
            const grid = document.getElementById('images-grid');
            const empty = document.getElementById('images-empty');
            if (!grid) return;

            if (!appState.images?.length) {
                grid.innerHTML = '';
                empty?.classList.remove('hidden');
                return;
            }

            empty?.classList.add('hidden');
            grid.innerHTML = appState.images.map(img => {
                const likedClass = appState.likedImages.has(img.id) ? 'liked' : '';
                return `
                    <div class="image-card" data-id="${img.id}">
                        <img src="${img.image_url}" class="image-card-media" onclick="previewImage('${img.image_url}')" alt="${img.title}">
                        <div class="image-card-info">
                            <h3 class="image-card-title">${img.title}</h3>
                            <p class="image-card-description">${img.description || 'No description'}</p>
                            <div class="image-card-stats">
                                <span><i class="fas fa-eye"></i> ${img.views || 0}</span>
                                <span class="like-count-${img.id}"><i class="fas fa-heart"></i> ${img.likes || 0}</span>
                                ${img.price > 0 ? `<span><i class="fas fa-tag"></i> $${img.price}</span>` : ''}
                            </div>
                            <div class="image-card-actions">
                                <button class="image-action-btn like ${likedClass}" onclick="likeImage(${img.id})">
                                    <i class="fas fa-heart"></i> Like
                                </button>
                                ${img.price > 0 ? `
                                    <button class="image-action-btn book" onclick="bookImage(${img.id})">
                                        <i class="fas fa-bookmark"></i> Book
                                    </button>
                                    <button class="image-action-btn buy" onclick="buyImage(${img.id})">
                                        <i class="fas fa-shopping-bag"></i> Buy
                                    </button>
                                ` : ''}
                                ${appState.isAdminLoggedIn ? `
                                    <button class="image-action-btn" style="background: var(--danger); color: white;" onclick="deleteImage(${img.id})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        async function likeImage(imageId) {
            const image = appState.images.find(img => img.id === imageId);
            if (!image) return;

            if (appState.likedImages.has(imageId)) {
                appState.likedImages.delete(imageId);
                image.likes = Math.max(0, (image.likes || 0) - 1);
                await trackImageUnlike(imageId);
            } else {
                appState.likedImages.add(imageId);
                image.likes = (image.likes || 0) + 1;
                await trackImageLike(imageId);
            }

            const likeCountEl = document.querySelector(`.like-count-${imageId}`);
            if (likeCountEl) likeCountEl.innerHTML = `<i class="fas fa-heart"></i> ${image.likes}`;
            
            const likeBtn = document.querySelector(`.image-card[data-id="${imageId}"] .image-action-btn.like`);
            if (likeBtn) likeBtn.classList.toggle('liked', appState.likedImages.has(imageId));
            
            if (appState.isAdminLoggedIn) updateAdminStats();
        }

        function previewImage(imageUrl) {
            document.getElementById('preview-image').src = imageUrl;
            document.getElementById('image-preview-modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeImagePreview() {
            document.getElementById('image-preview-modal').classList.add('hidden');
            document.body.style.overflow = '';
        }

        function showUploadImageModal() {
            if (!appState.isAdminLoggedIn) { 
                showToast('error', 'Access Denied', 'Login as admin first'); 
                return; 
            }
            resetImageUploadForm();
            showModal('upload-image-modal');
        }

        function resetImageUploadForm() {
            document.getElementById('image-title-input').value = '';
            document.getElementById('image-description-input').value = '';
            document.getElementById('image-price').value = '';
            document.getElementById('image-file').value = '';
            document.getElementById('image-preview-container').classList.add('hidden');
            document.getElementById('image-file-info').classList.add('hidden');
            document.getElementById('image-upload-status').classList.add('hidden');
            document.getElementById('image-upload-area').classList.remove('has-file');
            const progress = document.getElementById('image-upload-progress');
            if (progress) progress.style.width = '0%';
            document.getElementById('image-upload-percentage').textContent = '0%';
            appState.currentImageUpload.file = null;
        }

        function handleImageSelect(e) {
            const file = e.target.files[0];
            if (!file) return;

            if (!['image/jpeg', 'image/png', 'image/gif', 'image/webp'].includes(file.type)) {
                showToast('error', 'Invalid File', 'Please select a valid image');
                document.getElementById('image-file').value = '';
                return;
            }

            if (file.size > 10 * 1024 * 1024) {
                showToast('error', 'File Too Large', 'Image must be less than 10MB');
                document.getElementById('image-file').value = '';
                return;
            }

            appState.currentImageUpload.file = file;
            document.getElementById('image-file-info').classList.remove('hidden');
            document.getElementById('image-file-name').textContent = file.name;
            document.getElementById('image-file-size').textContent = (file.size / 1024 / 1024).toFixed(2) + ' MB';
            document.getElementById('image-upload-area').classList.add('has-file');
            document.getElementById('image-upload-text').textContent = 'Change image';

            const reader = new FileReader();
            reader.onload = function(event) {
                document.getElementById('image-preview').src = event.target.result;
                document.getElementById('image-preview-container').classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        }

        async function uploadImage() {
            if (!appState.isAdminLoggedIn) { 
                showToast('error', 'Access Denied', 'Login as admin first'); 
                return; 
            }

            const title = document.getElementById('image-title-input').value.trim();
            const description = document.getElementById('image-description-input').value.trim();
            const price = parseFloat(document.getElementById('image-price').value) || 0;
            const file = appState.currentImageUpload.file;

            if (!title) { 
                showToast('error', 'Validation Error', 'Please enter image title'); 
                return; 
            }
            if (!file) { 
                showToast('error', 'Validation Error', 'Please select an image file'); 
                return; 
            }

            const uploadStatus = document.getElementById('image-upload-status');
            const uploadProgress = document.getElementById('image-upload-progress');
            const uploadPercentage = document.getElementById('image-upload-percentage');
            const uploadStatusText = document.getElementById('image-upload-status-text');
            const uploadBtn = document.getElementById('image-upload-btn');

            uploadStatus.classList.remove('hidden');
            uploadBtn.disabled = true;
            uploadBtn.classList.add('opacity-50');

            try {
                const fileName = `gallery_${Date.now()}_${Math.random().toString(36).substring(7)}.${file.name.split('.').pop()}`;
                uploadStatusText.textContent = 'Uploading...';

                const { error: storageError } = await supabase.storage
                    .from('gallery-images')
                    .upload(fileName, file);
                    
                if (storageError) throw new Error('Upload failed: ' + storageError.message);

                uploadProgress.style.width = '100%';
                uploadPercentage.textContent = '100%';
                uploadStatusText.textContent = 'Getting URL...';

                const { data: { publicUrl } } = supabase.storage
                    .from('gallery-images')
                    .getPublicUrl(fileName);
                
                const { error } = await supabase
                    .from('gallery_images')
                    .insert([{
                        title, 
                        description, 
                        image_url: publicUrl, 
                        image_path: fileName, 
                        price, 
                        views: 0, 
                        likes: 0
                    }]);

                if (error) {
                    await supabase.storage.from('gallery-images').remove([fileName]);
                    throw new Error('Database error: ' + error.message);
                }

                showToast('success', 'Success', 'Image uploaded successfully');
                await loadImages();
                closeModal('upload-image-modal');
                resetImageUploadForm();
            } catch (error) {
                showToast('error', 'Upload Failed', error.message);
                uploadStatus.classList.add('hidden');
            } finally {
                uploadBtn.disabled = false;
                uploadBtn.classList.remove('opacity-50');
            }
        }

        function showManageImages() {
            if (!appState.isAdminLoggedIn) { 
                showToast('error', 'Access Denied', 'Login as admin first'); 
                return; 
            }
            renderAdminImagesList();
            showModal('manage-images-modal');
        }

        function renderAdminImagesList() {
            const list = document.getElementById('admin-images-list');
            const empty = document.getElementById('admin-images-empty');
            if (!list) return;

            if (!appState.images?.length) {
                list.innerHTML = '';
                empty?.classList.remove('hidden');
                return;
            }

            empty?.classList.add('hidden');
            list.innerHTML = appState.images.map(img => `
                <div class="flex items-center justify-between p-3 bg-surface-light rounded-lg">
                    <div class="flex items-center gap-3 flex-1">
                        <img src="${img.image_url}" class="w-12 h-12 rounded-lg object-cover">
                        <div>
                            <div class="font-medium">${img.title}</div>
                            <div class="text-xs text-zinc-400">Views: ${img.views || 0}  Likes: ${img.likes || 0}</div>
                        </div>
                    </div>
                    <button class="btn btn-sm btn-danger" onclick="deleteImage(${img.id})"><i class="fas fa-trash"></i></button>
                </div>
            `).join('');
        }

        async function deleteImage(id) {
            if (!appState.isAdminLoggedIn || !confirm('Delete permanently?')) return;
            try {
                const image = appState.images.find(img => img.id === id);
                if (image?.image_path) {
                    await supabase.storage.from('gallery-images').remove([image.image_path]);
                }
                await supabase.from('gallery_images').delete().eq('id', id);
                showToast('success', 'Deleted', 'Image deleted');
                await loadImages();
                if (!document.getElementById('manage-images-modal').classList.contains('hidden')) {
                    renderAdminImagesList();
                }
            } catch (error) {
                showToast('error', 'Delete Failed', error.message);
            }
        }

        function initializeWithDemoData() {
            appState.videos = [
                { id: 'demo_001', title: 'Welcome', description: 'Welcome video', views: 150, likes: 45, url: 'https://assets.mixkit.co/videos/preview/mixkit-close-up-of-a-blue-tit-1257-large.mp4', tier: 'small', price: 199, viewTracked: false, created_at: new Date().toISOString(), account: { id: 'demo_001', title: 'Welcome', tier: 'small', price: 199 } },
                { id: 'demo_002', title: 'Premium', description: 'Premium content', views: 89, likes: 23, url: 'https://assets.mixkit.co/videos/preview/mixkit-tree-with-yellow-flowers-1173-large.mp4', tier: 'medium', price: 299, viewTracked: false, created_at: new Date().toISOString(), account: { id: 'demo_002', title: 'Premium', tier: 'medium', price: 299 } }
            ];
            appState.accounts = appState.videos.map(v => ({ 
                id: v.id, 
                title: v.title, 
                description: v.description, 
                tier: v.tier, 
                price: v.price, 
                sold: false, 
                url: v.url 
            }));
            appState.bookRequests = [
                { id: 1, video_id: 'demo_001', user_name: 'John Doe', whatsapp_number: '+93793066322', created_at: new Date().toISOString() },
                { id: 2, video_id: 'demo_002', user_name: 'Jane Smith', whatsapp_number: '+93749949041', created_at: new Date().toISOString() }
            ];
        }

        function renderReels() {
            const container = document.getElementById('reels-container');
            if (!container) return;
            container.innerHTML = '';

            if (!appState.videos.length) {
                container.innerHTML = '<div class="reel-item"><div class="text-center"><i class="fas fa-video text-4xl text-zinc-600 mb-4"></i><p class="text-zinc-400">No videos available</p></div></div>';
                return;
            }

            appState.videos.forEach((video, index) => {
                const reelItem = document.createElement('div'); 
                reelItem.className = 'reel-item'; 
                reelItem.setAttribute('data-index', index);
                const likedClass = appState.likedVideos.has(video.id) ? 'liked' : '';

                reelItem.innerHTML = `
                    <div class="reel-video-container">
                        <video class="reel-video" data-index="${index}" src="${video.url}" loop playsinline preload="metadata"></video>
                        <div class="reel-top-gradient"></div>
                        <div class="video-info-btn" onclick="event.stopPropagation(); showVideoDrawer(${index})"><i class="fas fa-ellipsis-h"></i></div>
                        <div class="reel-info">
                            <div class="reel-title"><i class="fas fa-music"></i><span>${video.title}</span></div>
                            <div class="reel-description">${video.description || 'Premium video content'}</div>
                            <div class="reel-stats">
                                <span><i class="fas fa-eye"></i> ${video.views || 0}</span>
                                <span class="like-count"><i class="fas fa-heart"></i> ${video.likes || 0}</span>
                                <span><i class="fas fa-tag"></i> $${video.price}</span>
                            </div>
                        </div>
                        <div class="reel-actions">
                            <div class="reel-action-btn rotate-btn" onclick="rotateToFullscreen()"><div class="icon-circle"><i class="fas fa-undo-alt"></i></div><span>Rotate</span></div>
                            <div class="reel-action-btn" onclick="bookFromReel(${index})"><div class="icon-circle"><i class="fas fa-bookmark"></i></div><span>Book</span></div>
                            <div class="reel-action-btn" onclick="buyFromReel(${index})"><div class="icon-circle"><i class="fas fa-shopping-bag"></i></div><span>Buy</span></div>
                            <div class="reel-action-btn ${likedClass}" onclick="likeFromReel(${index})"><div class="icon-circle"><i class="fas fa-heart"></i></div><span class="like-count">${video.likes || 0}</span></div>
                            <div class="reel-action-btn" onclick="shareAppFromReel()"><div class="icon-circle"><i class="fas fa-share"></i></div><span>Share</span></div>
                        </div>
                        <div class="reel-overlay"></div>
                    </div>
                `;
                container.appendChild(reelItem);

                const videoEl = reelItem.querySelector('.reel-video');
                videoEl.addEventListener('click', (e) => {
                    e.stopPropagation();
                    videoEl.paused ? videoEl.play() : videoEl.pause();
                    showPlayPauseIndicator(videoEl.paused ? 'pause' : 'play');
                });

                videoEl.addEventListener('play', () => {
                    if (!video.viewTracked) {
                        video.viewTracked = true;
                        trackVideoView(video.id);
                    }
                });
            });
            setTimeout(() => playVideoAtIndex(0), 500);
        }

        function playVideoAtIndex(index) {
            const video = document.querySelector(`.reel-video[data-index="${index}"]`);
            if (video) { 
                video.play().catch(() => {}); 
            }
        }

        function pauseAllVideos() { 
            document.querySelectorAll('.reel-video').forEach(v => v.pause()); 
        }

        function handleReelScroll() {
            const container = document.getElementById('reels-container');
            const reels = document.querySelectorAll('.reel-item');
            const activeIndex = Math.round(container.scrollTop / container.clientHeight);
            
            if (activeIndex !== appState.currentVideoIndex && activeIndex < reels.length) {
                pauseAllVideos();
                appState.currentVideoIndex = activeIndex;
                playVideoAtIndex(activeIndex);
                closeVideoDrawer();
            }
        }

        function showVideoDrawer(index) {
            const video = appState.videos[index];
            if (!video) return;
            
            appState.currentAccount = video.account || video;
            document.getElementById('video-drawer-content').innerHTML = `
                <div class="video-info-section">
                    <div class="video-info-section-title">Title</div>
                    <div class="video-info-section-content">${video.title}</div>
                </div>
                <div class="video-info-section">
                    <div class="video-info-section-title">Description</div>
                    <div class="video-info-section-content">${video.description || 'No description'}</div>
                </div>
                <div class="video-info-section">
                    <div class="video-info-section-title">Price</div>
                    <div class="video-info-price-tag">$${video.price}</div>
                </div>
                <div class="video-info-section">
                    <div class="video-info-section-title">Tier</div>
                    <div class="video-info-tier-badge"><i class="fas ${video.tier === 'small' ? 'fa-user' : video.tier === 'medium' ? 'fa-user-tie' : 'fa-crown'}"></i> ${video.tier}</div>
                </div>
                <div class="video-info-section">
                    <div class="video-info-section-title">Stats</div>
                    <div class="flex gap-4"><span><i class="fas fa-eye"></i> ${video.views || 0} views</span><span><i class="fas fa-heart"></i> ${video.likes || 0} likes</span></div>
                </div>
                <div class="video-info-actions">
                    <button class="video-info-action-btn book" onclick="bookFromDrawer()"><i class="fas fa-bookmark"></i> Book Now</button>
                    <button class="video-info-action-btn buy" onclick="buyFromDrawer()"><i class="fas fa-shopping-bag"></i> Buy Now</button>
                </div>
            `;
            document.getElementById('video-info-drawer').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeVideoDrawer() {
            document.getElementById('video-info-drawer').classList.add('hidden');
            document.body.style.overflow = '';
        }

        function bookFromDrawer() {
            if (appState.currentAccount) {
                document.getElementById('book-account-name').textContent = appState.currentAccount.title;
                document.getElementById('book-account-tier').textContent = appState.currentAccount.tier;
                document.getElementById('book-account-price').textContent = `$${appState.currentAccount.price}`;
                showModal('book-modal');
                closeVideoDrawer();
            }
        }

        function buyFromDrawer() {
            if (appState.currentAccount) {
                document.getElementById('buy-account-name').textContent = appState.currentAccount.title;
                document.getElementById('buy-account-tier').textContent = appState.currentAccount.tier;
                document.getElementById('buy-account-price').textContent = `$${appState.currentAccount.price}`;
                showModal('buy-modal');
                closeVideoDrawer();
            }
        }

        function bookFromReel(index) {
            const video = appState.videos[index];
            if (video) {
                appState.currentAccount = video.account || video;
                document.getElementById('book-account-name').textContent = video.title;
                document.getElementById('book-account-tier').textContent = video.tier;
                document.getElementById('book-account-price').textContent = `$${video.price}`;
                showModal('book-modal');
            }
        }

        function buyFromReel(index) {
            const video = appState.videos[index];
            if (video) {
                appState.currentAccount = video.account || video;
                document.getElementById('buy-account-name').textContent = video.title;
                document.getElementById('buy-account-tier').textContent = video.tier;
                document.getElementById('buy-account-price').textContent = `$${video.price}`;
                showModal('buy-modal');
            }
        }

        async function likeFromReel(index) {
            const video = appState.videos[index];
            if (!video) return;

            if (appState.likedVideos.has(video.id)) {
                appState.likedVideos.delete(video.id);
                video.likes = Math.max(0, (video.likes || 0) - 1);
                await trackVideoUnlike(video.id);
            } else {
                appState.likedVideos.add(video.id);
                video.likes = (video.likes || 0) + 1;
                await trackVideoLike(video.id);
            }

            const reel = document.querySelector(`.reel-item[data-index="${index}"]`);
            if (reel) {
                const likeBtn = reel.querySelector('.reel-action-btn[onclick*="likeFromReel"]');
                const likeSpan = reel.querySelector('.like-count');
                if (likeBtn) likeBtn.classList.toggle('liked', appState.likedVideos.has(video.id));
                if (likeSpan) likeSpan.textContent = video.likes;
            }
        }

        function rotateToFullscreen() {
            const video = document.querySelector(`.reel-video[data-index="${appState.currentVideoIndex}"]`);
            if (!video) return;
            
            if (document.fullscreenElement) {
                document.exitFullscreen();
                video.classList.remove('fullscreen-mode');
            } else {
                video.requestFullscreen();
                video.classList.add('fullscreen-mode');
                document.getElementById('rotate-indicator').classList.remove('hidden');
                setTimeout(() => document.getElementById('rotate-indicator').classList.add('hidden'), 3000);
            }
        }

        function showPlayPauseIndicator(action) { 
            const indicator = document.getElementById('play-pause-indicator'); 
            indicator.innerHTML = `<i class="fas fa-${action === 'play' ? 'play' : 'pause'}"></i>`; 
            indicator.classList.add('show'); 
            setTimeout(() => indicator.classList.remove('show'), 500); 
        }

        function loadAccountsContent(filterTier = 'all') {
            const grid = document.getElementById('accounts-grid');
            if (!grid) return;
            
            const filtered = filterTier === 'all' ? appState.accounts : appState.accounts.filter(a => a.tier === filterTier);
            grid.innerHTML = filtered.length ? filtered.map(a => `
                <div class="account-card">
                    <div class="account-icon ${a.tier}" onclick="playVideoFromAccount('${a.id}')">
                        <i class="fas ${a.tier === 'small' ? 'fa-user' : a.tier === 'medium' ? 'fa-user-tie' : 'fa-crown'}"></i>
                    </div>
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-semibold">${a.title}</h3>
                        <span class="badge ${a.tier === 'big' ? 'badge-primary' : a.tier === 'medium' ? 'badge-secondary' : 'badge-warning'}">${a.tier}</span>
                    </div>
                    <p class="text-zinc-400 text-sm mb-4">${a.description || 'Premium account'}</p>
                    <div class="flex justify-between items-center mb-3">
                        <span class="text-2xl font-bold gradient-text">$${a.price}</span>
                    </div>
                    <div class="account-actions">
                        <button class="account-action-btn book" onclick="bookFromAccount('${a.id}')"><i class="fas fa-bookmark"></i> Book</button>
                        <button class="account-action-btn buy" onclick="buyFromAccount('${a.id}')"><i class="fas fa-shopping-bag"></i> Buy</button>
                        <button class="account-action-btn share" onclick="shareAppFromReel()"><i class="fas fa-share"></i> Share</button>
                    </div>
                </div>
            `).join('') : '<div class="col-span-2 text-center py-12">No accounts available</div>';
        }

        function filterAccounts(tier) {
            document.querySelectorAll('#accounts-page .tab-item').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            loadAccountsContent(tier);
        }

        function playVideoFromAccount(id) {
            const index = appState.videos.findIndex(v => v.id === id);
            if (index !== -1) {
                appState.currentVideoIndex = index;
                showPage('home');
                setTimeout(() => {
                    document.getElementById('reels-container').scrollTo({ 
                        top: index * document.getElementById('reels-container').clientHeight, 
                        behavior: 'smooth' 
                    });
                }, 100);
            }
        }

        function bookFromAccount(id) {
            const account = appState.accounts.find(a => a.id === id);
            if (account) { 
                appState.currentAccount = account; 
                document.getElementById('book-account-name').textContent = account.title; 
                document.getElementById('book-account-tier').textContent = account.tier; 
                document.getElementById('book-account-price').textContent = `$${account.price}`; 
                showModal('book-modal'); 
            }
        }

        function buyFromAccount(id) {
            const account = appState.accounts.find(a => a.id === id);
            if (account) { 
                appState.currentAccount = account; 
                document.getElementById('buy-account-name').textContent = account.title; 
                document.getElementById('buy-account-tier').textContent = account.tier; 
                document.getElementById('buy-account-price').textContent = `$${account.price}`; 
                showModal('buy-modal'); 
            }
        }

        async function adminLogin() {
            const email = document.getElementById('admin-email').value;
            const password = document.getElementById('admin-password').value;
            
            try {
                const { data, error } = await supabase.auth.signInWithPassword({ email, password });
                if (error) throw error;
                
                appState.isAdminLoggedIn = true;
                document.getElementById('admin-dashboard').classList.remove('hidden');
                document.getElementById('admin-image-upload-section')?.classList.toggle('hidden', appState.currentPage !== 'images');
                showToast('success', 'Admin Login', 'Welcome admin');
                await updateUserStats();
                showPage('admin');
            } catch (error) { 
                showToast('error', 'Login Failed', error.message); 
            }
        }

        async function logout() {
            appState.isAdminLoggedIn = false;
            appState.likedVideos.clear();
            appState.likedImages.clear();
            appState.unseenVideosCount = appState.unseenImagesCount = 0;
            updateNotificationBadge();
            document.getElementById('admin-dashboard').classList.add('hidden');
            document.getElementById('admin-image-upload-section')?.classList.add('hidden');
            showPage('home');
            showToast('success', 'Logged Out', 'Admin logged out');
        }

        async function updateAdminStats() {
            document.getElementById('admin-video-count').textContent = appState.videos.length || 0;
            document.getElementById('admin-image-count').textContent = appState.images.length || 0;
            document.getElementById('admin-registered-users').textContent = appState.userStats.registeredUsers || 0;
            document.getElementById('admin-online-users').textContent = appState.userStats.onlineUsers || 0;
            document.getElementById('admin-installed-users').textContent = appState.userStats.installedUsers || 0;
            document.getElementById('admin-total-views').textContent = appState.userStats.totalViews || 0;
            document.getElementById('admin-total-likes').textContent = appState.userStats.totalLikes || 0;
            document.getElementById('admin-image-likes').textContent = appState.userStats.imageLikes || 0;
        }

        async function showManageVideos() {
            if (!appState.isAdminLoggedIn) { 
                showToast('error', 'Access Denied', 'Login as admin first'); 
                return; 
            }
            await loadAdminVideos();
            showModal('manage-videos-modal');
        }

        async function loadAdminVideos(filter = 'all') {
            const list = document.getElementById('admin-videos-list');
            const filtered = filter === 'all' ? appState.videos : appState.videos.filter(v => v.tier === filter);
            list.innerHTML = filtered.length ? filtered.map(v => `
                <div class="flex items-center justify-between p-3 bg-surface-light rounded-lg">
                    <div class="flex-1">
                        <div class="flex items-center gap-2"><span class="font-medium">${v.title}</span><span class="badge ${v.tier === 'big' ? 'badge-primary' : v.tier === 'medium' ? 'badge-secondary' : 'badge-warning'}">${v.tier}</span></div>
                        <p class="text-xs text-zinc-400">ID: ${v.id}  $${v.price}</p>
                    </div>
                    <button class="btn btn-sm btn-danger" onclick="deleteVideo('${v.id}')"><i class="fas fa-trash"></i></button>
                </div>
            `).join('') : '<div class="text-center py-8 text-zinc-400">No videos found</div>';
        }

        function adminFilterVideos(tier) {
            document.querySelectorAll('#manage-videos-modal .tab-item').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            loadAdminVideos(tier);
        }

        async function deleteVideo(id) {
            if (!appState.isAdminLoggedIn || !confirm('Delete this video permanently?')) return;
            
            try {
                await supabase.from('book_requests').delete().eq('video_id', id);
                await supabase.from('notifications').delete().eq('video_id', id);
                
                const video = appState.videos.find(v => v.id === id);
                if (video?.url) {
                    const fileName = video.url.split('/').pop();
                    const bucketName = video.tier === 'small' ? 'videos-small' : video.tier === 'medium' ? 'videos-medium' : 'videos-big';
                    await supabase.storage.from(bucketName).remove([fileName]);
                }
                
                await supabase.from('videos').delete().eq('video_id', id);
                
                appState.videos = appState.videos.filter(v => v.id !== id);
                appState.accounts = appState.accounts.filter(a => a.id !== id);
                
                showToast('success', 'Deleted', 'Video removed');
                loadAdminVideos();
                renderReels();
                if (appState.currentPage === 'accounts') loadAccountsContent();
                updateAdminStats();
            } catch (error) {
                showToast('error', 'Delete Failed', error.message);
            }
        }

        async function showBookRequests() {
            if (!appState.isAdminLoggedIn) { 
                showToast('error', 'Access Denied', 'Login as admin first'); 
                return; 
            }
            await loadAdminBookRequests();
            showModal('book-requests-modal');
        }

        async function loadAdminBookRequests() {
            const list = document.getElementById('admin-book-requests-list');
            const empty = document.getElementById('admin-book-requests-empty');
            
            if (appState.bookRequests?.length) {
                list.classList.remove('hidden'); 
                empty?.classList.add('hidden');
                list.innerHTML = appState.bookRequests.map(r => {
                    const video = appState.videos.find(v => v.id === r.video_id);
                    return `
                        <div class="card bg-surface-light p-3" id="request-${r.id}">
                            <div class="flex justify-between items-start mb-2">
                                <h4 class="font-semibold">${r.user_name}</h4>
                                <span class="text-xs text-zinc-400">${new Date(r.created_at).toLocaleDateString()}</span>
                            </div>
                            <p class="text-sm mb-2">${r.whatsapp_number}</p>
                            ${video ? `<p class="text-xs text-primary mb-2">Account: ${video.title}</p>` : ''}
                            <div class="flex gap-2 mt-3">
                                <button class="btn btn-sm btn-success flex-1" onclick="contactRequester('${r.whatsapp_number}')"><i class="fab fa-whatsapp"></i> WhatsApp</button>
                                <button class="btn btn-sm btn-danger flex-1" onclick="deleteBookRequest('${r.id}')"><i class="fas fa-trash"></i> Delete</button>
                            </div>
                        </div>
                    `;
                }).join('');
            } else {
                list.classList.add('hidden'); 
                empty?.classList.remove('hidden');
            }
        }

        async function deleteBookRequest(id) {
            if (!appState.isAdminLoggedIn || !confirm('Delete this request?')) return;
            try {
                await supabase.from('book_requests').delete().eq('id', id);
                appState.bookRequests = appState.bookRequests.filter(r => r.id !== id);
                showToast('success', 'Deleted', 'Request deleted');
                loadAdminBookRequests();
            } catch (error) {
                showToast('error', 'Delete Failed', error.message);
            }
        }

        function contactRequester(whatsAppNumber) {
            window.open(`https://wa.me/${whatsAppNumber.replace(/\D/g, '')}`, '_blank');
        }

        async function submitBookRequest() {
            if (!appState.currentAccount) { 
                showToast('error', 'Error', 'No account selected'); 
                return; 
            }

            const name = document.getElementById('book-name').value.trim();
            const phone = document.getElementById('book-whatsapp').value.trim();
            const countryCode = document.getElementById('book-country-code').value;
            
            if (!name || !phone) { 
                showToast('error', 'Validation Error', 'Please fill all fields'); 
                return; 
            }
            
            try {
                const { error } = await supabase
                    .from('book_requests')
                    .insert([{
                        video_id: appState.currentAccount.id,
                        user_name: name,
                        whatsapp_number: countryCode + phone.replace(/^0+/, ''),
                        user_id: appState.userId,
                        created_at: new Date().toISOString()
                    }]);
                
                if (error) throw error;
                
                showToast('success', 'Submitted!', 'We will contact you soon');
                closeModal('book-modal');
                document.getElementById('book-name').value = '';
                document.getElementById('book-whatsapp').value = '';
                await loadBookRequests();
            } catch (error) { 
                showToast('error', 'Submission Failed', error.message); 
            }
        }

        function showUploadVideo() { 
            if (!appState.isAdminLoggedIn) { 
                showToast('error', 'Access Denied', 'Login as admin first'); 
                return; 
            } 
            resetUploadForm(); 
            showModal('upload-video-modal'); 
        }

        function resetUploadForm() { 
            document.getElementById('video-title-input').value = '';
            document.getElementById('video-description-input').value = '';
            document.getElementById('video-price').value = '';
            document.getElementById('video-tier').value = '';
            document.getElementById('video-file').value = '';
            document.getElementById('file-info').classList.add('hidden');
            document.getElementById('upload-status').classList.add('hidden');
            document.getElementById('file-upload-area').classList.remove('has-file');
            appState.currentUpload.file = null; 
        }

        function handleFileSelect(e) { 
            const file = e.target.files[0]; 
            if (!file) return; 
            appState.currentUpload.file = file; 
            document.getElementById('file-info').classList.remove('hidden'); 
            document.getElementById('file-name').textContent = file.name; 
            document.getElementById('file-size').textContent = (file.size / 1024 / 1024).toFixed(2) + ' MB'; 
            document.getElementById('file-upload-area').classList.add('has-file'); 
        }

        async function uploadVideo() {
            if (!appState.isAdminLoggedIn) { 
                showToast('error', 'Access Denied', 'Login as admin first'); 
                return; 
            }

            const title = document.getElementById('video-title-input').value.trim();
            const description = document.getElementById('video-description-input').value.trim();
            const price = parseFloat(document.getElementById('video-price').value);
            const tier = document.getElementById('video-tier').value;
            const file = appState.currentUpload.file;

            if (!title || !price || !tier || !file) { 
                showToast('error', 'Validation Error', 'Please fill all fields'); 
                return; 
            }

            const bucketMap = { small: 'videos-small', medium: 'videos-medium', big: 'videos-big' };
            const maxSizeMap = { small: 100, medium: 200, big: 500 };
            const bucketName = bucketMap[tier];
            const maxSize = maxSizeMap[tier];

            if (file.size > maxSize * 1024 * 1024) { 
                showToast('error', 'File Too Large', `Max ${maxSize}MB`); 
                return; 
            }

            const uploadStatus = document.getElementById('upload-status');
            const uploadProgress = document.getElementById('upload-progress');
            const uploadPercentage = document.getElementById('upload-percentage');
            const uploadStatusText = document.getElementById('upload-status-text');
            const uploadBtn = document.getElementById('upload-btn');

            uploadStatus.classList.remove('hidden');
            uploadBtn.disabled = true;

            try {
                const videoId = `video_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                const fileName = `${videoId}.${file.name.split('.').pop()}`;

                uploadStatusText.textContent = 'Uploading...';
                const { error: storageError } = await supabase.storage
                    .from(bucketName)
                    .upload(fileName, file);
                    
                if (storageError) throw new Error('Upload failed');

                uploadProgress.style.width = '100%';
                uploadPercentage.textContent = '100%';

                const { data: { publicUrl } } = supabase.storage
                    .from(bucketName)
                    .getPublicUrl(fileName);
                
                await supabase
                    .from('videos')
                    .insert([{
                        video_id: videoId, 
                        video_title: title, 
                        description, 
                        account_tier: tier, 
                        price,
                        video_url: publicUrl, 
                        bucket_name: bucketName, 
                        views: 0, 
                        likes: 0, 
                        created_at: new Date().toISOString()
                    }]);

                showToast('success', 'Success', 'Video uploaded');
                setTimeout(() => {
                    closeModal('upload-video-modal');
                    resetUploadForm();
                    loadVideos().then(() => {
                        renderReels();
                        if (appState.currentPage === 'accounts') loadAccountsContent();
                        updateAdminStats();
                    });
                }, 1500);
            } catch (error) {
                showToast('error', 'Upload Failed', error.message);
                uploadStatus.classList.add('hidden');
            } finally {
                uploadBtn.disabled = false;
            }
        }

        function startContentCheckInterval() {
            setInterval(checkForNewContent, 60000);
        }

        async function checkForNewContent() {
            const now = new Date();
            const newVideos = appState.videos.filter(v => new Date(v.created_at) > appState.lastVideoCheck);
            const newImages = appState.images.filter(i => new Date(i.created_at) > appState.lastImageCheck);
            
            if (newVideos.length) {
                appState.unseenVideosCount += newVideos.length;
                newVideos.forEach(v => appState.notifications.unshift({
                    id: `video_${v.id}_${Date.now()}`,
                    type: 'new_video', 
                    title: 'New Video', 
                    message: v.title, 
                    video_id: v.id, 
                    created_at: now
                }));
            }
            if (newImages.length) {
                appState.unseenImagesCount += newImages.length;
                newImages.forEach(i => appState.notifications.unshift({
                    id: `image_${i.id}_${Date.now()}`,
                    type: 'new_image', 
                    title: 'New Image', 
                    message: i.title, 
                    image_id: i.id, 
                    created_at: now
                }));
            }
            if (newVideos.length || newImages.length) updateNotificationBadge();
            
            appState.lastVideoCheck = appState.lastImageCheck = now;
        }

        function updateNotificationBadge() {
            const badge = document.getElementById('notification-count');
            const total = appState.unseenVideosCount + appState.unseenImagesCount;
            badge.textContent = total;
            badge.classList.toggle('hidden', total === 0);
        }

        function loadNotificationsPage() {
            const list = document.getElementById('notifications-list');
            const empty = document.getElementById('notifications-empty');
            
            if (appState.notifications?.length) {
                list.classList.remove('hidden');
                empty?.classList.add('hidden');
                list.innerHTML = appState.notifications.map(n => `
                    <div class="card p-4" onclick="${n.type === 'new_video' ? `playVideoFromAccount('${n.video_id}')` : `showPage('images')`}">
                        <div class="flex items-start gap-3">
                            <div class="w-10 h-10 rounded-full gradient-bg flex items-center justify-center">
                                <i class="fas fa-${n.type === 'new_video' ? 'video' : 'image'} text-white"></i>
                            </div>
                            <div class="flex-1">
                                <div class="flex justify-between items-start">
                                    <h4 class="font-semibold">${n.title}</h4>
                                    <span class="text-xs text-zinc-400">${new Date(n.created_at).toLocaleDateString()}</span>
                                </div>
                                <p class="text-sm text-primary mb-1">${n.message}</p>
                                <button class="btn btn-sm btn-primary mt-2" onclick="event.stopPropagation(); ${n.type === 'new_video' ? `playVideoFromAccount('${n.video_id}')` : `showPage('images')`}">
                                    <i class="fas fa-${n.type === 'new_video' ? 'play' : 'eye'}"></i> View
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            } else {
                list.classList.add('hidden');
                empty?.classList.remove('hidden');
            }
        }

        function shareAppFromReel() { showModal('share-modal'); }
        function shareAppViaWhatsApp() { 
            window.open(`https://wa.me/?text=${encodeURIComponent('Check out GK Store: ' + window.location.href)}`, '_blank'); 
            closeModal('share-modal'); 
        }
        function shareAppViaTelegram() { 
            window.open(`https://t.me/share/url?url=${encodeURIComponent(window.location.href)}&text=GK%20Store`, '_blank'); 
            closeModal('share-modal'); 
        }
        function copyAppLink() { 
            navigator.clipboard.writeText(window.location.href); 
            showToast('success', 'Copied!', 'Link copied'); 
            closeModal('share-modal'); 
        }
        function shareAppViaSystem() { 
            if (navigator.share) { 
                navigator.share({ title: 'GK Store', url: window.location.href }).catch(console.error); 
            } else { 
                copyAppLink(); 
            } 
            closeModal('share-modal'); 
        }

        function showModal(id) { 
            document.getElementById(id).classList.remove('hidden'); 
            document.body.style.overflow = 'hidden'; 
        }
        
        function closeModal(id) { 
            document.getElementById(id).classList.add('hidden'); 
            document.body.style.overflow = ''; 
        }

        function showToast(type, title, message) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-icon').className = `fas ${type === 'success' ? 'fa-check-circle text-success' : 'fa-exclamation-circle text-danger'}`;
            document.getElementById('toast-title').textContent = title;
            document.getElementById('toast-message').textContent = message;
            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('hidden'), 3000);
        }

        function closeWelcomeModal() { closeModal('welcome-modal'); }
        
        function showWelcomeModal() {
            if (!localStorage.getItem('hasSeenWelcome')) {
                showModal('welcome-modal');
                localStorage.setItem('hasSeenWelcome', 'true');
            }
        }

        function copyUSDTAddress() { 
            navigator.clipboard.writeText(document.getElementById('usdt-address').textContent); 
            showToast('success', 'Copied!', 'Address copied'); 
        }
        
        function copyAddress() { 
            navigator.clipboard.writeText(document.getElementById('payment-address').textContent); 
            showToast('success', 'Copied!', 'Address copied'); 
        }
        
        function openWhatsApp(number) { 
            window.open(`https://wa.me/${number.replace(/\D/g, '')}?text=Hello%20GK%20Store`, '_blank'); 
        }
        
        function openPaymentChat() { 
            if (!appState.currentAccount) return; 
            window.open(`https://wa.me/93793066322?text=${encodeURIComponent(`I want to buy: ${appState.currentAccount.title} for $${appState.currentAccount.price}`)}`, '_blank'); 
        }
        
        function toggleLanguage() { showModal('language-modal'); }
        
        function setLanguage(lang) { 
            appState.language = lang; 
            localStorage.setItem('appLanguage', lang); 
            document.querySelectorAll('[id^="lang-"]').forEach(c => c.classList.add('hidden')); 
            document.getElementById(`lang-${lang}-check`).classList.remove('hidden'); 
            closeModal('language-modal'); 
        }
        
        function toggleTheme() { 
            appState.theme = appState.theme === 'dark' ? 'light' : 'dark'; 
            localStorage.setItem('appTheme', appState.theme); 
            document.documentElement.setAttribute('data-theme', appState.theme); 
        }
        
        function loadPreferences() { 
            appState.language = localStorage.getItem('appLanguage') || 'en'; 
            appState.theme = localStorage.getItem('appTheme') || 'dark'; 
            document.documentElement.setAttribute('data-theme', appState.theme); 
        }

        function setupEventListeners() { 
            document.getElementById('reels-container')?.addEventListener('scroll', () => { 
                clearTimeout(appState.scrollTimeout); 
                appState.scrollTimeout = setTimeout(handleReelScroll, 100); 
            }); 
            
            window.addEventListener('online', () => {
                document.getElementById('offline-indicator').classList.remove('show');
            });
            
            window.addEventListener('offline', () => {
                document.getElementById('offline-indicator').classList.add('show');
            });
            
            document.getElementById('video-info-drawer')?.addEventListener('click', (e) => {
                if (e.target.classList.contains('video-info-drawer-overlay')) closeVideoDrawer();
            });
        }

        function setupOrientationHandling() { 
            window.addEventListener('orientationchange', () => { 
                clearTimeout(appState.orientationTimeout); 
                appState.orientationTimeout = setTimeout(() => { 
                    if (appState.currentPage === 'home' && window.innerWidth > window.innerHeight && !document.fullscreenElement) {
                        rotateToFullscreen(); 
                    }
                }, 100); 
            }); 
        }

        function setupPWAInstall() {
            if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone) {
                trackInstall();
            }
            
            window.addEventListener('beforeinstallprompt', (e) => { 
                e.preventDefault(); 
                appState.deferredPrompt = e; 
                showInstallButton(); 
            });
            
            window.addEventListener('appinstalled', () => { 
                trackInstall(); 
                showToast('success', 'Installed!', 'App installed'); 
            });
        }

        function checkAndShowInstallButton() {
            const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
            if (isStandalone) { 
                document.getElementById('pwa-install-btn')?.classList.add('hidden'); 
                return; 
            }
            setTimeout(() => { 
                if (!appState.installInstructionsShown) showInstallInstructions(); 
            }, 5000);
        }

        function showInstallInstructions() {
            const instructions = document.getElementById('install-instructions');
            const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
            const isAndroid = /Android/i.test(navigator.userAgent);
            
            document.getElementById('ios-instructions').classList.toggle('hidden', !isIOS);
            document.getElementById('android-instructions').classList.toggle('hidden', !isAndroid);
            instructions.classList.remove('hidden');
            appState.installInstructionsShown = true;
            setTimeout(() => instructions.classList.add('hidden'), 10000);
        }

        function closeInstallInstructions() { 
            document.getElementById('install-instructions').classList.add('hidden'); 
        }

        function showInstallButton() { 
            const btn = document.getElementById('pwa-install-btn'); 
            if (btn) { 
                btn.classList.remove('hidden'); 
                btn.onclick = async () => { 
                    if (appState.deferredPrompt) { 
                        appState.deferredPrompt.prompt(); 
                        await appState.deferredPrompt.userChoice; 
                        appState.deferredPrompt = null; 
                        btn.classList.add('hidden'); 
                    } else {
                        showInstallInstructions();
                    }
                }; 
            } 
        }

        async function trackInstall() {
            try {
                await supabase
                    .from('users')
                    .update({ installed: true })
                    .eq('user_id', appState.userId);
            } catch (error) {
                console.error('Error tracking install:', error);
            }
        }

        document.addEventListener('DOMContentLoaded', initApp);

        window.showPage = showPage;
        window.logout = logout;
        window.adminLogin = adminLogin;
        window.closeWelcomeModal = closeWelcomeModal;
        window.copyUSDTAddress = copyUSDTAddress;
        window.copyAddress = copyAddress;
        window.openWhatsApp = openWhatsApp;
        window.openPaymentChat = openPaymentChat;
        window.toggleLanguage = toggleLanguage;
        window.setLanguage = setLanguage;
        window.toggleTheme = toggleTheme;
        window.showModal = showModal;
        window.closeModal = closeModal;
        window.rotateToFullscreen = rotateToFullscreen;
        window.likeFromReel = likeFromReel;
        window.bookFromReel = bookFromReel;
        window.buyFromReel = buyFromReel;
        window.submitBookRequest = submitBookRequest;
        window.filterAccounts = filterAccounts;
        window.playVideoFromAccount = playVideoFromAccount;
        window.bookFromAccount = bookFromAccount;
        window.buyFromAccount = buyFromAccount;
        window.showUploadVideo = showUploadVideo;
        window.showManageVideos = showManageVideos;
        window.showBookRequests = showBookRequests;
        window.adminFilterVideos = adminFilterVideos;
        window.deleteVideo = deleteVideo;
        window.contactRequester = contactRequester;
        window.resetUploadForm = resetUploadForm;
        window.handleFileSelect = handleFileSelect;
        window.uploadVideo = uploadVideo;
        window.shareAppFromReel = shareAppFromReel;
        window.shareAppViaWhatsApp = shareAppViaWhatsApp;
        window.shareAppViaTelegram = shareAppViaTelegram;
        window.copyAppLink = copyAppLink;
        window.shareAppViaSystem = shareAppViaSystem;
        window.closeInstallInstructions = closeInstallInstructions;
        window.deleteBookRequest = deleteBookRequest;
        window.showVideoDrawer = showVideoDrawer;
        window.closeVideoDrawer = closeVideoDrawer;
        window.bookFromDrawer = bookFromDrawer;
        window.buyFromDrawer = buyFromDrawer;
        window.showUploadImageModal = showUploadImageModal;
        window.handleImageSelect = handleImageSelect;
        window.uploadImage = uploadImage;
        window.showManageImages = showManageImages;
        window.likeImage = likeImage;
        window.bookImage = bookImage;
        window.buyImage = buyImage;
        window.previewImage = previewImage;
        window.closeImagePreview = closeImagePreview;
        window.deleteImage = deleteImage;
    </script>

    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/GKStore/sw.js').catch(console.log);
        }
    </script>
</body>
</html>
