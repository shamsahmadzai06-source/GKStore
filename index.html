<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <!-- PWA primary tags -->
    <meta name="theme-color" content="#ec4899">
    <meta name="description" content="GK Store - Exclusive Video Marketplace. Buy & book premium video accounts.">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="GK Store">
    <meta name="application-name" content="GK Store">
    
    <!-- Manifest as Data URI (base64) - FIXED with correct icon paths -->
    <link rel="manifest" href="data:application/manifest+json;base64,ewogICJuYW1lIjogIkdLIFN0b3JlIC0gVmlkZW8gTWFya2V0cGxhY2UiLAogICJzaG9ydF9uYW1lIjogIkdLIFN0b3JlIiwKICAiZGVzY3JpcHRpb24iOiAiRXhjbHVzaXZlIHZpZGVvIG1hcmtldHBsYWNlIOKAkyBidXkgYW5kIGJvb2sgcHJlbWl1bSBhY2NvdW50cy4iLAogICJzdGFydF91cmwiOiAiLyIsCiAgInNjb3BlIjogIi8iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiMwMDAwMDAiLAogICJ0aGVtZV9jb2xvciI6ICIjZWM0ODk5IiwKICAib3JpZW50YXRpb24iOiAicG9ydHJhaXQiLAogICJpY29ucyI6IFsKICAgIHsgInNyYyI6ICJhbmRyb2lkLWxhdW5jaGVyaWNvbi03Mi03Mi5wbmciLCAic2l6ZXMiOiAiNzJ4NzIiLCAidHlwZSI6ICJpbWFnZS9wbmciLCAicHVycG9zZSI6ICJhbnkgbWFza2FibGUiIH0sCiAgICB7ICJzcmMiOiAiYW5kcm9pZC1sYXVuY2hlcmljb24tOTYtOTYucG5nIiwgInNpemVzIjogIjk2eDk2IiwgInR5cGUiOiAiaW1hZ2UvcG5nIiwgInB1cnBvc2UiOiAiYW55IG1hc2thYmxlIiB9LAogICAgeyAic3JjIjogImFuZHJvaWQtbGF1bmNoZXJpY29uLTE0NC0xNDQucG5nIiwgInNpemVzIjogIjE0NHgxNDQiLCAidHlwZSI6ICJpbWFnZS9wbmciLCAicHVycG9zZSI6ICJhbnkgbWFza2FibGUiIH0sCiAgICB7ICJzcmMiOiAiYW5kcm9pZC1sYXVuY2hlcmljb24tMTkyLTE5Mi5wbmciLCAic2l6ZXMiOiAiMTkyeDE5MiIsICJ0eXBlIjogImltYWdlL3BuZyIsICJwdXJwb3NlIjogImFueSBtYXNrYWJsZSIgfSwKICAgIHsgInNyYyI6ICJhbmRyb2lkLWxhdW5jaGVyaWNvbi01MTItNTEyLnBuZyIsICJzaXplcyI6ICI1MTJ4NTEyIiwgInR5cGUiOiAiaW1hZ2UvcG5nIiwgInB1cnBvc2UiOiAiYW55IG1hc2thYmxlIiB9CiAgXQp9">
    
    <!-- iOS icons - FIXED: now pointing to your actual GitHub files -->
    <link rel="apple-touch-icon" sizes="72x72" href="https://shamsahmadzai06-source.github.io/GKStore/android-launchericon-72-72.png">
    <link rel="apple-touch-icon" sizes="96x96" href="https://shamsahmadzai06-source.github.io/GKStore/android-launchericon-96-96.png">
    <link rel="apple-touch-icon" sizes="144x144" href="https://shamsahmadzai06-source.github.io/GKStore/android-launchericon-144-144.png">
    <link rel="apple-touch-icon" sizes="192x192" href="https://shamsahmadzai06-source.github.io/GKStore/android-launchericon-192-192.png">
    <link rel="apple-touch-icon" sizes="512x512" href="https://shamsahmadzai06-source.github.io/GKStore/android-launchericon-512-512.png">
    
    <!-- Favicon - FIXED -->
    <link rel="icon" type="image/png" href="https://shamsahmadzai06-source.github.io/GKStore/android-launchericon-72-72.png">
    
    <title>GK Store - Video Marketplace</title>
    
    <!-- Supabase & Font Awesome -->
    <script src="https://unpkg.com/@supabase/supabase-js@2.39.7/dist/umd/supabase.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* ... (keep all your existing styles - they are excellent) ... */
        :root {
            --primary: #ec4899;
            --primary-dark: #db2777;
            --secondary: #8b5cf6;
            --secondary-dark: #7c3aed;
            --accent: #f59e0b;
            --background: #000000;
            --surface: #18181b;
            --surface-light: #27272a;
            --text: #ffffff;
            --text-secondary: #a1a1aa;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --border: #3f3f46;
            --gradient: linear-gradient(135deg, var(--primary), var(--secondary));
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html { 
            font-size: 16px; 
            scroll-behavior: smooth;
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--background);
            color: var(--text);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            height: 100%;
            overflow: hidden;
            position: fixed;
            width: 100%;
        }

        /* Scrollbar - hidden for reels style */
        ::-webkit-scrollbar { 
            width: 0px; 
            background: transparent;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        @keyframes shimmer {
            0% { background-position: -200% center; }
            100% { background-position: 200% center; }
        }

        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        .animate-slide-in { animation: slideIn 0.3s ease-out; }
        .animate-spin { animation: spin 1s linear infinite; }
        .shimmer {
            background: linear-gradient(90deg, var(--surface-light) 0%, var(--surface) 50%, var(--surface-light) 100%);
            background-size: 200% auto;
            animation: shimmer 2s infinite linear;
        }

        /* Utility */
        .gradient-text { background: var(--gradient); -webkit-background-clip: text; background-clip: text; color: transparent; }
        .gradient-bg { background: var(--gradient); }
        .glass-effect { background: rgba(255,255,255,0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .blur-bg { backdrop-filter: blur(20px); background: rgba(0,0,0,0.5); }
        .hidden { display: none !important; }

        /* Layout - TikTok/Reels Style */
        .app-container {
            height: 100vh;
            height: 100dvh;
            overflow: hidden;
            position: relative;
        }

        .page {
            height: 100%;
            overflow: hidden;
            position: relative;
        }

        /* Home Page - Reels Style */
        #home-page {
            background: #000;
        }

        .reels-container {
            height: 100%;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
            position: relative;
            background: #000;
        }

        .reel-item {
            height: 100%;
            scroll-snap-align: start;
            scroll-snap-stop: always;
            position: relative;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .reel-video-container {
            width: 100%;
            height: 100%;
            position: relative;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .reel-video {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: #000;
        }

        /* Fullscreen video styles - FIXED for mobile */
        .reel-video.fullscreen-mode {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 9999;
            object-fit: contain;
            background: #000;
        }

        /* Mobile-specific fullscreen fixes */
        @media (max-width: 768px) {
            .reel-video.fullscreen-mode {
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                object-fit: contain;
                z-index: 10000;
            }
            
            body.video-playing {
                overflow: hidden;
                position: fixed;
                width: 100%;
                height: 100%;
            }
        }

        /* Landscape orientation handling - FIXED for mobile */
        @media (orientation: landscape) {
            .reel-video.auto-rotate {
                object-fit: cover;
                width: 100vw;
                height: 100vh;
            }
            
            /* Hide navigation in landscape when video is playing */
            body.video-playing .top-nav,
            body.video-playing .bottom-nav,
            body.video-playing .notification-bell,
            body.video-playing .pwa-install-btn {
                transform: translateY(-100%);
                opacity: 0;
                transition: all 0.3s;
                pointer-events: none;
            }
            
            /* Show controls on tap in landscape */
            body.video-playing .reel-actions {
                opacity: 1;
            }
        }

        /* Video overlay - TikTok style */
        .reel-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to bottom, 
                rgba(0,0,0,0.3) 0%, 
                transparent 30%, 
                transparent 70%, 
                rgba(0,0,0,0.5) 100%);
            pointer-events: none;
        }

        .reel-info {
            position: absolute;
            bottom: 100px;
            left: 16px;
            right: 80px;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            pointer-events: none;
            z-index: 10;
        }

        .reel-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .reel-title i {
            font-size: 1rem;
            color: var(--primary);
        }

        .reel-description {
            font-size: 0.9rem;
            color: rgba(255,255,255,0.9);
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .reel-stats {
            display: flex;
            gap: 16px;
            font-size: 0.85rem;
            color: rgba(255,255,255,0.8);
        }

        .reel-stats span {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* Right side action buttons - TikTok style */
        .reel-actions {
            position: absolute;
            right: 12px;
            bottom: 120px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            z-index: 20;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .reel-action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            pointer-events: auto;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .reel-action-btn:hover {
            transform: scale(1.1);
        }

        .reel-action-btn .icon-circle {
            width: 48px;
            height: 48px;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(10px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .reel-action-btn span {
            font-size: 0.7rem;
            font-weight: 600;
        }

        /* Rotate screen indicator */
        .rotate-indicator {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(10px);
            color: white;
            padding: 8px 16px;
            border-radius: 30px;
            font-size: 0.8rem;
            z-index: 30;
            display: flex;
            align-items: center;
            gap: 8px;
            border: 1px solid rgba(255,255,255,0.2);
            animation: fadeInOut 3s forwards;
            pointer-events: none;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateX(-50%) translateY(-10px); }
            10% { opacity: 1; transform: translateX(-50%) translateY(0); }
            90% { opacity: 1; transform: translateX(-50%) translateY(0); }
            100% { opacity: 0; transform: translateX(-50%) translateY(-10px); }
        }

        /* Top gradient */
        .reel-top-gradient {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 80px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.5), transparent);
            z-index: 15;
            pointer-events: none;
        }

        /* Loading state */
        .reel-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            z-index: 30;
        }

        /* Video Grid (for other views) */
        .grid { display: grid; gap: 1.5rem; }
        .grid-cols-1 { grid-template-columns: repeat(1, 1fr); }
        .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
        @media (min-width: 768px) { .md\:grid-cols-3 { grid-template-columns: repeat(3, 1fr); } }
        @media (min-width: 1024px) { .lg\:grid-cols-4 { grid-template-columns: repeat(4, 1fr); } }

        /* Video Item */
        .video-item { 
            position: relative; 
            border-radius: 1rem; 
            overflow: hidden; 
            cursor: pointer; 
            aspect-ratio: 9/16; 
            background: var(--surface);
        }
        .video-item img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s; }
        .video-item:hover img { transform: scale(1.05); }
        .video-item-overlay {
            position: absolute; bottom: 0; left: 0; right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent); padding: 1rem; color: white;
        }
        .video-item-title { font-weight: 600; margin-bottom: 0.25rem; font-size: 0.875rem; }
        .video-item-stats { display: flex; gap: 0.75rem; font-size: 0.75rem; color: rgba(255,255,255,0.8); }

        .video-grid-share-btn {
            position: absolute; top: 0.5rem; right: 0.5rem; width: 2.5rem; height: 2.5rem;
            background: rgba(0,0,0,0.7); backdrop-filter: blur(10px); color: white; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s;
            border: 1px solid rgba(255,255,255,0.2); z-index: 10;
        }
        .video-grid-share-btn:hover { background: rgba(236,72,153,0.7); transform: scale(1.1); }

        /* Video grid for home page (small preview) */
        #video-grid {
            padding: 1rem;
            max-height: 300px;
            overflow-y: auto;
            background: var(--background);
        }

        /* Navigation */
        .top-nav {
            position: fixed; top: 0; left: 0; right: 0; z-index: 1000; padding: 1rem;
            background: rgba(0,0,0,0.9); backdrop-filter: blur(20px); border-bottom: 1px solid var(--border);
            transition: transform 0.3s ease;
        }
        .nav-content { display: flex; align-items: center; justify-content: space-between; }
        .logo { display: flex; align-items: center; gap: 0.75rem; font-weight: 700; text-decoration: none; color: var(--text); }
        .logo-icon { width: 2rem; height: 2rem; background: var(--gradient); border-radius: 0.5rem; display: flex; align-items: center; justify-content: center; color: white; }
        .nav-actions { display: flex; align-items: center; gap: 0.5rem; }
        
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; right: 0; z-index: 1000; padding: 0.75rem 1rem;
            background: rgba(0,0,0,0.9); backdrop-filter: blur(20px); border-top: 1px solid var(--border);
            transition: transform 0.3s ease;
        }
        .nav-items { display: flex; justify-content: space-around; align-items: center; max-width: 400px; margin: 0 auto; }
        .nav-item {
            display: flex; flex-direction: column; align-items: center; text-decoration: none; color: var(--text-secondary);
            padding: 0.5rem; border-radius: 0.75rem; min-width: 4rem; transition: all 0.2s;
        }
        .nav-item:hover { color: var(--text); background: rgba(255,255,255,0.05); }
        .nav-item.active { color: var(--primary); background: rgba(236,72,153,0.1); }
        .nav-item i { font-size: 1.25rem; margin-bottom: 0.25rem; }
        .nav-item span { font-size: 0.75rem; font-weight: 500; }

        /* Buttons */
        .btn {
            display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; padding: 0.75rem 1.5rem;
            border-radius: 0.75rem; font-weight: 600; font-size: 0.875rem; cursor: pointer; border: none;
            transition: all 0.2s ease; position: relative; overflow: hidden;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        .btn:active { transform: translateY(0); }
        .btn-primary { background: var(--gradient); color: white; }
        .btn-secondary { background: var(--surface-light); color: var(--text); border: 1px solid var(--border); }
        .btn-outline { background: transparent; color: var(--text); border: 1px solid var(--border); }
        .btn-icon { width: 2.5rem; height: 2.5rem; padding: 0; border-radius: 50%; }
        .btn-sm { padding: 0.5rem 1rem; font-size: 0.75rem; }

        /* Cards */
        .card { background: var(--surface); border-radius: 1rem; border: 1px solid var(--border); overflow: hidden; transition: all 0.3s; }
        .card:hover { border-color: var(--primary); transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,0.3); }
        .card-glass { background: rgba(255,255,255,0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .card-header { padding: 1.5rem; border-bottom: 1px solid var(--border); }
        .card-body { padding: 1.5rem; }
        .card-footer { padding: 1.5rem; border-top: 1px solid var(--border); }

        /* Content area - adjust for pages other than home */
        .content {
            padding-top: 60px;
            padding-bottom: 70px;
            height: 100%;
            overflow-y: auto;
            position: relative;
        }

        /* Forms */
        .input-group { margin-bottom: 1.5rem; }
        .input-label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--text-secondary); }
        .input {
            width: 100%; padding: 0.75rem 1rem; background: var(--surface-light); border: 1px solid var(--border);
            border-radius: 0.75rem; color: var(--text); font-size: 0.875rem; transition: all 0.2s;
        }
        .input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(236,72,153,0.1); }
        .textarea { min-height: 120px; resize: vertical; }

        /* Account Card */
        .account-card {
            padding: 1.5rem; border-radius: 1rem; background: var(--surface); border: 1px solid var(--border);
            transition: all 0.3s; height: 100%;
        }
        .account-card:hover { border-color: var(--primary); transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,0.3); }
        .account-icon {
            width: 60px; height: 60px; border-radius: 12px; display: flex; align-items: center;
            justify-content: center; font-size: 1.5rem; margin-bottom: 1rem;
            cursor: pointer;
        }
        .account-icon.small { background: linear-gradient(135deg, #10b981, #059669); }
        .account-icon.medium { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .account-icon.big { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }

        /* Account Action Buttons */
        .account-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        .account-action-btn {
            flex: 1;
            padding: 0.5rem;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.25rem;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }
        .account-action-btn.book { background: rgba(236,72,153,0.1); color: var(--primary); border: 1px solid rgba(236,72,153,0.2); }
        .account-action-btn.buy { background: rgba(16,185,129,0.1); color: var(--success); border: 1px solid rgba(16,185,129,0.2); }
        .account-action-btn.share { background: rgba(139,92,246,0.1); color: var(--secondary); border: 1px solid rgba(139,92,246,0.2); }
        .account-action-btn.play { background: rgba(245,158,11,0.1); color: var(--warning); border: 1px solid rgba(245,158,11,0.2); }
        .account-action-btn:hover { transform: translateY(-2px); filter: brightness(1.1); }

        /* Upload Progress */
        .upload-status {
            margin-top: 1rem;
            padding: 1rem;
            background: var(--surface-light);
            border-radius: 0.75rem;
        }
        .progress-bar {
            width: 100%;
            height: 0.5rem;
            background: var(--border);
            border-radius: 9999px;
            overflow: hidden;
            margin: 0.5rem 0;
        }
        .progress-fill {
            height: 100%;
            background: var(--gradient);
            border-radius: 9999px;
            transition: width 0.3s;
        }

        /* Modals */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); z-index: 2000;
            display: flex; align-items: center; justify-content: center; padding: 1rem;
        }
        .modal {
            background: var(--surface); border-radius: 1.5rem; border: 1px solid var(--border);
            width: 100%; max-width: 400px; max-height: 90vh; overflow-y: auto;
        }
        .modal-header { padding: 1.5rem; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
        .modal-title { font-size: 1.25rem; font-weight: 700; }
        .modal-close { background: none; border: none; color: var(--text-secondary); cursor: pointer; width: 2.5rem; height: 2.5rem; border-radius: 0.5rem; transition: all 0.2s; }
        .modal-close:hover { background: rgba(255,255,255,0.05); color: var(--text); }
        .modal-body { padding: 1.5rem; }
        .modal-footer { padding: 1.5rem; border-top: 1px solid var(--border); display: flex; gap: 1rem; }

        /* File Upload */
        .file-upload-area {
            border: 2px dashed var(--border); border-radius: 1rem; padding: 2rem; text-align: center;
            cursor: pointer; transition: all 0.3s; background: var(--surface-light);
        }
        .file-upload-area:hover { border-color: var(--primary); background: rgba(236,72,153,0.05); }
        .file-upload-area.dragover { border-color: var(--primary); background: rgba(236,72,153,0.1); }
        .file-upload-area.has-file {
            border-color: var(--success);
            background: rgba(16,185,129,0.05);
        }

        /* Badges */
        .badge {
            display: inline-flex; align-items: center; padding: 0.25rem 0.75rem; border-radius: 9999px;
            font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.025em;
        }
        .badge-primary { background: rgba(236,72,153,0.1); color: var(--primary); border: 1px solid rgba(236,72,153,0.2); }
        .badge-secondary { background: rgba(139,92,246,0.1); color: var(--secondary); border: 1px solid rgba(139,92,246,0.2); }
        .badge-success { background: rgba(16,185,129,0.1); color: var(--success); border: 1px solid rgba(16,185,129,0.2); }
        .badge-warning { background: rgba(245,158,11,0.1); color: var(--warning); border: 1px solid rgba(245,158,11,0.2); }
        .badge-danger { background: rgba(239,68,68,0.1); color: var(--danger); border: 1px solid rgba(239,68,68,0.2); }

        /* Notifications */
        .notification-bell {
            position: fixed; left: 1rem; bottom: 5rem; width: 3rem; height: 3rem; border-radius: 50%;
            background: var(--surface-light); color: var(--text); display: flex; align-items: center;
            justify-content: center; cursor: pointer; z-index: 100; transition: all 0.3s;
            border: 1px solid var(--border);
        }
        .notification-bell:hover { background: var(--surface); transform: scale(1.1); }
        .notification-badge {
            position: absolute; top: -0.25rem; right: -0.25rem; width: 1.25rem; height: 1.25rem;
            background: var(--danger); color: white; border-radius: 50%; font-size: 0.75rem;
            display: flex; align-items: center; justify-content: center; font-weight: 600;
        }

        /* PWA Install Button - Improved */
        .pwa-install-btn {
            position: fixed;
            left: 1rem;
            bottom: 9rem;
            padding: 0 20px;
            height: 3rem;
            border-radius: 30px;
            background: var(--gradient);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 10px 25px rgba(236,72,153,0.3);
            transition: all 0.3s;
            border: none;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .pwa-install-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 30px rgba(236,72,153,0.4);
        }

        .pwa-install-btn i {
            font-size: 1.1rem;
        }

        /* Offline Indicator */
        .offline-indicator {
            position: fixed; top: 0; left: 0; right: 0; background: var(--danger); color: white;
            text-align: center; padding: 0.5rem; font-size: 0.875rem; z-index: 2000; display: none;
        }
        .offline-indicator.show { display: block; animation: slideIn 0.3s; }

        /* Auth */
        .auth-container { min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 1rem; }
        .auth-card { width: 100%; max-width: 400px; padding: 2rem; }
        .auth-divider { display: flex; align-items: center; margin: 1.5rem 0; }
        .auth-divider::before, .auth-divider::after { content: ''; flex: 1; height: 1px; background: var(--border); }
        .auth-divider span { padding: 0 1rem; color: var(--text-secondary); font-size: 0.875rem; }

        /* Toast */
        #toast {
            position: fixed; top: 4rem; right: 1rem; z-index: 2000; max-width: 350px;
        }

        /* Tab Bar */
        .tab-bar { display: flex; background: var(--surface); border-radius: 1rem; padding: 0.25rem; margin-bottom: 1.5rem; }
        .tab-item {
            flex: 1; padding: 0.75rem 1rem; text-align: center; font-weight: 500; cursor: pointer;
            border-radius: 0.75rem; transition: all 0.2s;
        }
        .tab-item:hover { background: rgba(255,255,255,0.05); }
        .tab-item.active { background: var(--gradient); color: white; }

        /* Gradient Effects */
        .gradient-bg-effects { position: fixed; inset: 0; z-index: -1; overflow: hidden; }
        .gradient-circle { position: absolute; border-radius: 50%; filter: blur(100px); opacity: 0.2; }
        .gradient-1 { top: -10%; right: -10%; width: 40%; height: 40%; background: var(--primary); }
        .gradient-2 { bottom: -10%; left: -10%; width: 40%; height: 40%; background: var(--secondary); }
        .gradient-3 { top: 50%; left: 50%; transform: translate(-50%, -50%); width: 30%; height: 30%; background: var(--accent); }

        /* Responsive */
        @media (max-width: 640px) {
            html { font-size: 14px; }
            .nav-item span { display: none; }
            .nav-item { min-width: 3rem; }
            .reel-info { bottom: 80px; }
            .reel-actions { bottom: 100px; }
        }

        /* Video play/pause indicator */
        .play-pause-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.6);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 25;
        }

        .play-pause-indicator.show {
            opacity: 1;
            animation: fadeOut 0.5s forwards;
        }

        @keyframes fadeOut {
            0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1.5); }
        }
    </style>
</head>
<body>
    <!-- Offline Indicator -->
    <div id="offline-indicator" class="offline-indicator">
        <i class="fas fa-wifi-slash"></i> You are currently offline. Some features may be limited.
    </div>

    <!-- PWA Install Button (initially hidden) -->
    <button id="pwa-install-btn" class="pwa-install-btn hidden">
        <i class="fas fa-download"></i> Install App
    </button>

    <!-- Gradient Background -->
    <div class="gradient-bg-effects">
        <div class="gradient-circle gradient-1"></div>
        <div class="gradient-circle gradient-2"></div>
        <div class="gradient-circle gradient-3"></div>
    </div>

    <!-- Top Navigation -->
    <nav class="top-nav">
        <div class="nav-content">
            <a href="#home" class="logo" onclick="showPage('home')">
                <div class="logo-icon">
                    <span style="font-size: 1rem; color: white;">GK</span>
                </div>
                <span class="gradient-text">GK Store</span>
            </a>
            
            <div class="nav-actions">
                <button class="btn btn-icon btn-secondary" onclick="toggleLanguage()">
                    <i class="fas fa-globe"></i>
                </button>
                <button class="btn btn-icon btn-secondary" onclick="showPage('admin')">
                    <i class="fas fa-user-shield"></i>
                </button>
                <button class="btn btn-icon btn-secondary" onclick="toggleTheme()">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div id="content-container" class="content">
        <!-- Auth Page -->
        <div id="auth-page" class="page">
            <div class="auth-container">
                <div class="auth-card card">
                    <!-- Login -->
                    <div id="login-form-container">
                        <div class="text-center mb-6">
                            <div class="w-16 h-16 gradient-bg rounded-2xl flex items-center justify-center mx-auto mb-4">
                                <span style="color: white; font-size: 1.5rem;">GK</span>
                            </div>
                            <h2 class="text-2xl font-bold mb-2">Welcome to GK Store</h2>
                            <p class="text-zinc-400">Sign in to access premium content</p>
                        </div>
                        
                        <form id="login-form" onsubmit="login(event)">
                            <div class="input-group">
                                <label class="input-label">Email</label>
                                <input type="email" class="input" id="login-email" required>
                            </div>
                            <div class="input-group">
                                <label class="input-label">Password</label>
                                <input type="password" class="input" id="login-password" required>
                            </div>
                            <div class="flex items-center justify-between mb-6">
                                <label class="flex items-center">
                                    <input type="checkbox" id="remember-me" class="mr-2">
                                    <span class="text-sm">Remember me</span>
                                </label>
                                <a href="#" class="text-sm text-primary" onclick="showForgotPassword()">Forgot password?</a>
                            </div>
                            <button type="submit" class="btn btn-primary w-full mb-4">
                                <i class="fas fa-sign-in-alt"></i> Sign In
                            </button>
                        </form>
                        
                        <div class="auth-divider"><span>Or</span></div>
                        
                        <div class="auth-switch text-center">
                            <span>Don't have an account? </span>
                            <a href="#" class="text-primary" onclick="showSignupForm()">Sign up</a>
                        </div>
                    </div>
                    
                    <!-- Signup -->
                    <div id="signup-form-container" class="hidden">
                        <div class="text-center mb-6">
                            <div class="w-16 h-16 gradient-bg rounded-2xl flex items-center justify-center mx-auto mb-4">
                                <span style="color: white; font-size: 1.5rem;">GK</span>
                            </div>
                            <h2 class="text-2xl font-bold mb-2">Create Account</h2>
                        </div>
                        
                        <form id="signup-form" onsubmit="signup(event)">
                            <div class="input-group">
                                <label class="input-label">Full Name</label>
                                <input type="text" class="input" id="signup-name" required>
                            </div>
                            <div class="input-group">
                                <label class="input-label">Email</label>
                                <input type="email" class="input" id="signup-email" required>
                            </div>
                            <div class="input-group">
                                <label class="input-label">Password</label>
                                <input type="password" class="input" id="signup-password" required>
                            </div>
                            <div class="input-group">
                                <label class="input-label">Confirm Password</label>
                                <input type="password" class="input" id="signup-confirm-password" required>
                            </div>
                            <button type="submit" class="btn btn-primary w-full">
                                <i class="fas fa-user-plus"></i> Create Account
                            </button>
                        </form>
                        
                        <div class="auth-switch text-center mt-4">
                            <span>Already have an account? </span>
                            <a href="#" class="text-primary" onclick="showLoginForm()">Sign in</a>
                        </div>
                    </div>
                    
                    <!-- Forgot Password -->
                    <div id="forgot-password-container" class="hidden">
                        <div class="text-center mb-6">
                            <div class="w-16 h-16 gradient-bg rounded-2xl flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-lock text-white text-2xl"></i>
                            </div>
                            <h2 class="text-2xl font-bold mb-2">Reset Password</h2>
                        </div>
                        
                        <form id="forgot-password-form" onsubmit="resetPassword(event)">
                            <div class="input-group">
                                <label class="input-label">Email</label>
                                <input type="email" class="input" id="reset-email" required>
                            </div>
                            <button type="submit" class="btn btn-primary w-full">
                                Send Reset Link
                            </button>
                        </form>
                        
                        <div class="auth-switch text-center mt-4">
                            <a href="#" onclick="showLoginForm()">‚Üê Back to login</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Home Page - TikTok/Reels Style -->
        <div id="home-page" class="page hidden">
            <div class="reels-container" id="reels-container">
                <!-- Videos will be dynamically inserted here -->
            </div>
            
            <!-- Video Grid (small preview) -->
            <div id="video-grid" class="grid grid-cols-2 md:grid-cols-3 gap-2 mt-2 px-2 hidden"></div>
            <div id="loading-more" class="hidden text-center py-8">
                <div class="w-8 h-8 border-2 border-transparent border-t-pink-500 rounded-full animate-spin mx-auto"></div>
                <p class="text-zinc-400 mt-2">Loading more videos...</p>
            </div>
        </div>

        <!-- Accounts Page -->
        <div id="accounts-page" class="page hidden">
            <div class="px-4">
                <h2 class="text-2xl font-bold mb-6">Premium Accounts</h2>
                
                <div class="tab-bar mb-6">
                    <div class="tab-item active" onclick="filterAccounts('all')">All</div>
                    <div class="tab-item" onclick="filterAccounts('small')">Small</div>
                    <div class="tab-item" onclick="filterAccounts('medium')">Medium</div>
                    <div class="tab-item" onclick="filterAccounts('big')">Big</div>
                </div>
                
                <div id="accounts-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
            </div>
        </div>

        <!-- Profile Page -->
        <div id="profile-page" class="page hidden">
            <div class="px-4">
                <div class="flex flex-col items-center mb-8">
                    <div class="w-24 h-24 rounded-full gradient-bg flex items-center justify-center text-2xl font-bold mb-4">
                        <span>GK</span>
                    </div>
                    <h2 class="text-2xl font-bold">User Profile</h2>
                    <p class="text-zinc-400">Premium Member</p>
                </div>
                
                <div class="grid gap-4">
                    <div class="card">
                        <div class="card-body">
                            <h3 class="font-semibold mb-4">Account Information</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-zinc-400">Name</span>
                                    <span id="user-name">John Doe</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-zinc-400">Email</span>
                                    <span id="user-email">john@example.com</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-zinc-400">Member Since</span>
                                    <span id="member-since">Jan 2024</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-body">
                            <h3 class="font-semibold mb-4">Statistics</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="text-center p-4 bg-surface-light rounded-lg">
                                    <div class="text-2xl font-bold gradient-text" id="videos-watched-count">0</div>
                                    <div class="text-sm text-zinc-400">Videos Watched</div>
                                </div>
                                <div class="text-center p-4 bg-surface-light rounded-lg">
                                    <div class="text-2xl font-bold gradient-text" id="accounts-booked-count">0</div>
                                    <div class="text-sm text-zinc-400">Accounts Booked</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn btn-secondary w-full" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </div>

        <!-- Contact Page -->
        <div id="contact-page" class="page hidden">
            <div class="px-4">
                <h2 class="text-2xl font-bold mb-6">Contact Us</h2>
                
                <div class="grid gap-6">
                    <div class="card">
                        <div class="card-body">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="w-12 h-12 rounded-full gradient-bg flex items-center justify-center">
                                    <i class="fas fa-whatsapp text-white"></i>
                                </div>
                                <div>
                                    <h3 class="font-semibold">WhatsApp Support</h3>
                                    <p class="text-zinc-400">+93 793066322</p>
                                </div>
                            </div>
                            <button class="btn btn-primary w-full" onclick="openWhatsApp()">
                                <i class="fab fa-whatsapp"></i> Chat Now
                            </button>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-body">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="w-12 h-12 rounded-full bg-amber-500 flex items-center justify-center">
                                    <i class="fas fa-wallet text-white"></i>
                                </div>
                                <div>
                                    <h3 class="font-semibold">USDT Address (TRC20)</h3>
                                    <p class="text-zinc-400 text-sm">Send payment to this address</p>
                                </div>
                            </div>
                            <div class="bg-surface-light p-3 rounded-lg mb-4">
                                <code id="usdt-address" class="text-sm break-all">TYpeauzqbVusejMAhJPnXuSb7wY6p69ZoY</code>
                            </div>
                            <button class="btn btn-secondary w-full" onclick="copyUSDTAddress()">
                                <i class="far fa-copy"></i> Copy Address
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Page -->
        <div id="admin-page" class="page hidden">
            <div class="px-4">
                <h2 class="text-2xl font-bold mb-6">Admin Panel</h2>
                
                <div class="grid gap-6">
                    <div class="card">
                        <div class="card-body">
                            <h3 class="font-semibold mb-4">Admin Login</h3>
                            <form id="admin-login-form" onsubmit="adminLogin(event)">
                                <div class="input-group">
                                    <label class="input-label">Admin Email</label>
                                    <input type="email" id="admin-email" class="input" required>
                                </div>
                                <div class="input-group">
                                    <label class="input-label">Admin Password</label>
                                    <input type="password" id="admin-password" class="input" required>
                                </div>
                                <button type="submit" class="btn btn-primary w-full">
                                    <i class="fas fa-lock"></i> Login as Admin
                                </button>
                            </form>
                        </div>
                    </div>
                    
                    <div id="admin-dashboard" class="hidden">
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                            <div class="card"><div class="card-body text-center"><div class="text-2xl font-bold gradient-text" id="admin-video-count">0</div><div class="text-sm text-zinc-400">Total Videos</div></div></div>
                            <div class="card"><div class="card-body text-center"><div class="text-2xl font-bold gradient-text" id="admin-registered-users">0</div><div class="text-sm text-zinc-400">Registered Users</div></div></div>
                            <div class="card"><div class="card-body text-center"><div class="text-2xl font-bold gradient-text" id="admin-online-users">1</div><div class="text-sm text-zinc-400">Online Users</div></div></div>
                            <div class="card"><div class="card-body text-center"><div class="text-2xl font-bold gradient-text" id="admin-sold-count">0</div><div class="text-sm text-zinc-400">Sold Accounts</div></div></div>
                        </div>
                        
                        <div class="card mb-6">
                            <div class="card-body">
                                <h3 class="font-semibold mb-4">Quick Actions</h3>
                                <div class="grid grid-cols-1 gap-3">
                                    <button class="btn btn-secondary" onclick="showUploadVideo()"><i class="fas fa-upload"></i> Upload Video</button>
                                    <button class="btn btn-secondary" onclick="showManageVideos()"><i class="fas fa-video"></i> Manage Videos</button>
                                    <button class="btn btn-secondary" onclick="showBookRequests()"><i class="fas fa-bookmark"></i> Book Requests</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-body">
                                <h3 class="font-semibold mb-4">Recent Activity</h3>
                                <div id="admin-recent-activity" class="space-y-3"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notifications Page -->
        <div id="notifications-page" class="page hidden">
            <div class="px-4">
                <h2 class="text-2xl font-bold mb-6">Notifications</h2>
                <div id="notifications-list" class="space-y-3"></div>
                <div id="notifications-empty" class="hidden text-center py-12">
                    <i class="far fa-bell text-4xl text-zinc-600 mb-4"></i>
                    <h3 class="text-xl font-semibold mb-2">No Notifications</h3>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <div class="nav-items">
            <a href="#accounts" class="nav-item" onclick="showPage('accounts')">
                <i class="fas fa-shopping-bag"></i>
                <span>Accounts</span>
            </a>
            <a href="#home" class="nav-item active" onclick="showPage('home')">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </a>
            <a href="#profile" class="nav-item" onclick="showPage('profile')">
                <i class="far fa-user"></i>
                <span>Profile</span>
            </a>
            <a href="#contact" class="nav-item" onclick="showPage('contact')">
                <i class="fas fa-headset"></i>
                <span>Contact</span>
            </a>
        </div>
    </nav>

    <!-- Notification Bell -->
    <div class="notification-bell" onclick="showPage('notifications')">
        <i class="far fa-bell"></i>
        <div id="notification-count" class="notification-badge hidden">0</div>
    </div>

    <!-- Rotate Screen Indicator -->
    <div id="rotate-indicator" class="rotate-indicator hidden">
        <i class="fas fa-undo-alt"></i> Rotate device for fullscreen
    </div>

    <!-- Modals (keep all existing modals) -->
    <div id="book-modal" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Book Account</h3>
                <button class="modal-close" onclick="closeModal('book-modal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div class="card glass-effect p-4 mb-4">
                    <h4 id="book-account-name" class="font-semibold mb-1"></h4>
                    <p id="book-account-tier" class="badge badge-secondary text-xs"></p>
                    <p id="book-account-price" class="text-lg font-bold mt-2"></p>
                </div>
                <form id="book-form">
                    <div class="input-group">
                        <label class="input-label">Your Name</label>
                        <input type="text" class="input" id="book-name" required>
                    </div>
                    <div class="input-group">
                        <label class="input-label">WhatsApp Number</label>
                        <input type="tel" class="input" id="book-whatsapp" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary flex-1" onclick="closeModal('book-modal')">Cancel</button>
                <button class="btn btn-primary flex-1" onclick="submitBookRequest()">Submit</button>
            </div>
        </div>
    </div>

    <div id="buy-modal" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Buy with USDT</h3>
                <button class="modal-close" onclick="closeModal('buy-modal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div class="card glass-effect p-4 mb-4">
                    <h4 id="buy-account-name" class="font-semibold mb-1"></h4>
                    <p id="buy-account-tier" class="badge badge-secondary text-xs"></p>
                    <p id="buy-account-price" class="text-2xl font-bold mt-2"></p>
                </div>
                <div class="bg-surface-light p-4 rounded-lg mb-4">
                    <div class="flex justify-between mb-2">
                        <span class="text-sm text-zinc-400">USDT Address (TRC20)</span>
                        <button class="btn btn-sm btn-secondary" onclick="copyAddress()">Copy</button>
                    </div>
                    <code id="payment-address" class="text-sm break-all">TYpeauzqbVusejMAhJPnXuSb7wY6p69ZoY</code>
                </div>
                <button class="btn btn-primary w-full" onclick="openPaymentChat()">
                    <i class="fab fa-whatsapp"></i> Confirm on WhatsApp
                </button>
            </div>
        </div>
    </div>

    <div id="share-modal" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Share Video</h3>
                <button class="modal-close" onclick="closeModal('share-modal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <h4 id="share-video-title" class="font-semibold text-center mb-4"></h4>
                <div class="grid grid-cols-4 gap-3 mb-6">
                    <button class="flex flex-col items-center p-3 bg-surface-light rounded-lg" onclick="shareViaWhatsApp()">
                        <i class="fab fa-whatsapp text-green-500 text-2xl mb-2"></i>
                        <span class="text-xs">WhatsApp</span>
                    </button>
                    <button class="flex flex-col items-center p-3 bg-surface-light rounded-lg" onclick="shareViaTelegram()">
                        <i class="fab fa-telegram text-blue-500 text-2xl mb-2"></i>
                        <span class="text-xs">Telegram</span>
                    </button>
                    <button class="flex flex-col items-center p-3 bg-surface-light rounded-lg" onclick="copyShareLink()">
                        <i class="fas fa-link text-purple-500 text-2xl mb-2"></i>
                        <span class="text-xs">Copy</span>
                    </button>
                    <button class="flex flex-col items-center p-3 bg-surface-light rounded-lg" onclick="shareViaSystem()">
                        <i class="fas fa-share-alt text-pink-500 text-2xl mb-2"></i>
                        <span class="text-xs">More</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="upload-video-modal" class="modal-overlay hidden">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title">Upload Video</h3>
                <button class="modal-close" onclick="closeModal('upload-video-modal'); resetUploadForm()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label class="input-label">Video Title</label>
                    <input type="text" class="input" id="video-title-input" placeholder="Enter video title" required>
                </div>
                <div class="input-group">
                    <label class="input-label">Description</label>
                    <textarea class="input textarea" id="video-description-input" placeholder="Enter video description"></textarea>
                </div>
                <div class="input-group">
                    <label class="input-label">Price ($)</label>
                    <input type="number" class="input" id="video-price" step="0.01" placeholder="0.00" required>
                </div>
                <div class="input-group">
                    <label class="input-label">Tier</label>
                    <select class="input" id="video-tier" required onchange="updateBucketInfo()">
                        <option value="">Select Tier</option>
                        <option value="small">Small (up to 100MB)</option>
                        <option value="medium">Medium (up to 200MB)</option>
                        <option value="big">Big (up to 500MB)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label class="input-label">Video File</label>
                    <div class="file-upload-area" id="file-upload-area" onclick="document.getElementById('video-file').click()">
                        <i class="fas fa-cloud-upload-alt text-3xl text-primary mb-2"></i>
                        <p id="file-upload-text">Click to select video file</p>
                        <p class="text-xs text-zinc-500 mt-1">MP4, WebM, OGG (max 500MB)</p>
                        <input type="file" id="video-file" accept="video/mp4,video/webm,video/ogg" class="hidden" onchange="handleFileSelect(event)">
                    </div>
                    <div id="file-info" class="hidden mt-2 p-2 bg-surface-light rounded-lg">
                        <p class="text-sm"><span class="font-semibold">Selected:</span> <span id="file-name"></span></p>
                        <p class="text-sm"><span class="font-semibold">Size:</span> <span id="file-size"></span></p>
                    </div>
                </div>
                
                <!-- Upload Progress -->
                <div id="upload-status" class="upload-status hidden">
                    <div class="flex justify-between text-sm mb-1">
                        <span id="upload-status-text">Uploading...</span>
                        <span id="upload-percentage">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div id="upload-progress" class="progress-fill" style="width: 0%"></div>
                    </div>
                </div>

                <input type="hidden" id="video-url-input">
                <input type="hidden" id="storage-path-input">
                <input type="hidden" id="bucket-name-input">

                <div class="flex gap-2 mt-4">
                    <button class="btn btn-secondary flex-1" onclick="closeModal('upload-video-modal'); resetUploadForm()">Cancel</button>
                    <button class="btn btn-primary flex-1" id="upload-btn" onclick="uploadVideo()">
                        <i class="fas fa-upload"></i> Upload Video
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="manage-videos-modal" class="modal-overlay hidden">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title">Manage Videos</h3>
                <button class="modal-close" onclick="closeModal('manage-videos-modal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div class="tab-bar mb-4">
                    <div class="tab-item active" onclick="adminFilterVideos('all')">All</div>
                    <div class="tab-item" onclick="adminFilterVideos('small')">Small</div>
                    <div class="tab-item" onclick="adminFilterVideos('medium')">Medium</div>
                    <div class="tab-item" onclick="adminFilterVideos('big')">Big</div>
                </div>
                <div id="admin-videos-list" class="space-y-3 max-h-96 overflow-y-auto"></div>
            </div>
        </div>
    </div>

    <div id="book-requests-modal" class="modal-overlay hidden">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title">Book Requests</h3>
                <button class="modal-close" onclick="closeModal('book-requests-modal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div id="admin-book-requests-list" class="space-y-3 max-h-96 overflow-y-auto"></div>
                <div id="admin-book-requests-empty" class="hidden text-center py-8">
                    <i class="fas fa-inbox text-4xl text-zinc-600 mb-4"></i>
                    <h3>No Requests</h3>
                </div>
            </div>
        </div>
    </div>

    <div id="language-modal" class="modal-overlay hidden">
        <div class="modal" style="max-width: 300px;">
            <div class="modal-header">
                <h3 class="modal-title">Select Language</h3>
                <button class="modal-close" onclick="closeModal('language-modal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body p-0">
                <button class="w-full p-4 text-left hover:bg-surface-light" onclick="setLanguage('en')">
                    üá∫üá∏ English <i id="lang-en-check" class="fas fa-check text-primary float-right"></i>
                </button>
                <button class="w-full p-4 text-left hover:bg-surface-light" onclick="setLanguage('ps')">
                    üá¶üá´ Ÿæ⁄öÿ™Ÿà <i id="lang-ps-check" class="fas fa-check text-primary float-right hidden"></i>
                </button>
                <button class="w-full p-4 text-left hover:bg-surface-light" onclick="setLanguage('fa')">
                    üáÆüá∑ ŸÅÿßÿ±ÿ≥€å <i id="lang-fa-check" class="fas fa-check text-primary float-right hidden"></i>
                </button>
            </div>
        </div>
    </div>

    <div id="welcome-modal" class="modal-overlay">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-body text-center">
                <div class="w-20 h-20 gradient-bg rounded-2xl flex items-center justify-center mx-auto mb-6">
                    <span style="color: white; font-size: 2rem;">GK</span>
                </div>
                <h2 class="text-2xl font-bold mb-4">Welcome to GK Store!</h2>
                <p class="text-zinc-400 mb-6">Your exclusive gateway to premium video content</p>
                <button class="btn btn-primary w-full" onclick="closeWelcomeModal()">
                    Get Started <i class="fas fa-arrow-right ml-2"></i>
                </button>
            </div>
        </div>
    </div>

    <div id="sql-setup-modal" class="modal-overlay hidden">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title">Database Setup</h3>
                <button class="modal-close" onclick="closeModal('sql-setup-modal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <p class="mb-4">Run this SQL in Supabase SQL Editor:</p>
                <pre class="bg-black text-green-400 p-3 rounded-lg text-xs overflow-x-auto">
CREATE TABLE videos (
    id SERIAL PRIMARY KEY,
    video_id TEXT UNIQUE NOT NULL,
    video_title TEXT NOT NULL,
    description TEXT,
    views INTEGER DEFAULT 0,
    likes INTEGER DEFAULT 0,
    video_url TEXT NOT NULL,
    account_tier TEXT CHECK (account_tier IN ('small','medium','big')) NOT NULL,
    price DECIMAL(10,2) NOT NULL,
    sold BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE book_requests (
    id SERIAL PRIMARY KEY,
    video_id TEXT REFERENCES videos(video_id),
    user_name TEXT NOT NULL,
    whatsapp_number TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT NOW()
);</pre>
                <button class="btn btn-primary w-full mt-4" onclick="closeModal('sql-setup-modal')">Close</button>
            </div>
        </div>
    </div>

    <!-- Play/Pause Indicator -->
    <div id="play-pause-indicator" class="play-pause-indicator">
        <i class="fas fa-play"></i>
    </div>

    <!-- Toast -->
    <div id="toast" class="hidden">
        <div class="bg-surface border border-border rounded-lg shadow-xl p-4">
            <div class="flex items-start gap-3">
                <i id="toast-icon" class="fas fa-check-circle text-success"></i>
                <div class="flex-1">
                    <h4 id="toast-title" class="font-semibold"></h4>
                    <p id="toast-message" class="text-sm text-zinc-400"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Supabase configuration
        const SUPABASE_URL = 'https://ieinqlpnubtwwkldqhab.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImllaW5xbHBudWJ0d3drbGRxaGFiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1MzA3ODcsImV4cCI6MjA4NjEwNjc4N30.sJsoTu1bHBgconNOPfXZk33Ttuy1ZKC2oW2SonBnQ4o';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // App state
        const appState = {
            currentPage: 'auth', 
            currentVideoIndex: 0, 
            videos: [], 
            accounts: [], 
            notifications: [],
            bookRequests: [], 
            language: 'en', 
            theme: 'dark', 
            isLoggedIn: false, 
            currentUser: null,
            isAdminLoggedIn: false, 
            userStats: { registeredUsers: 0, onlineUsers: 0 },
            currentUpload: { file: null, progress: 0 }, 
            shareVideo: null,
            currentVideoPlayer: null, 
            isFullscreen: false, 
            currentAccount: null,
            isPlaying: true,
            scrollTimeout: null,
            deferredPrompt: null,
            orientationTimeout: null,
            wasPlayingBeforeRotate: false
        };

        // Initialize app
        async function initApp() {
            loadPreferences();
            setupEventListeners();
            setupOrientationHandling();
            setupPWAInstall();
            await checkDatabaseSetup();
            
            const savedUser = localStorage.getItem('gkStoreUser');
            if (savedUser) {
                appState.currentUser = JSON.parse(savedUser);
                appState.isLoggedIn = true;
                const adminSession = localStorage.getItem('gkStoreAdmin');
                if (adminSession === 'true') {
                    appState.isAdminLoggedIn = true;
                }
                showPage('home');
                await loadInitialData();
            } else showPage('auth');
        }

        // Setup orientation handling for fullscreen video - FIXED for mobile
        function setupOrientationHandling() {
            // Use both orientationchange and resize events for better mobile support
            window.addEventListener('orientationchange', () => {
                // Clear previous timeout
                if (appState.orientationTimeout) {
                    clearTimeout(appState.orientationTimeout);
                }
                
                // Handle orientation change after a short delay to allow device to settle
                appState.orientationTimeout = setTimeout(() => {
                    handleOrientationChange();
                }, 200);
            });

            // Also listen for resize events (for browsers that don't support orientationchange well)
            window.addEventListener('resize', () => {
                if (appState.orientationTimeout) {
                    clearTimeout(appState.orientationTimeout);
                }
                appState.orientationTimeout = setTimeout(() => {
                    handleOrientationChange();
                }, 200);
            });

            // Handle fullscreen change events
            document.addEventListener('fullscreenchange', handleFullscreenChange);
            document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
            document.addEventListener('mozfullscreenchange', handleFullscreenChange);
            document.addEventListener('MSFullscreenChange', handleFullscreenChange);
        }

        // Handle orientation change - FIXED for mobile
        function handleOrientationChange() {
            if (appState.currentPage !== 'home') return;
            
            const isLandscape = window.innerWidth > window.innerHeight;
            const currentVideo = document.querySelector(`.reel-video[data-index="${appState.currentVideoIndex}"]`);
            
            if (!currentVideo) return;
            
            if (isLandscape) {
                // Enter landscape mode - show fullscreen video
                enterFullscreenMode(currentVideo);
                
                // Show rotate indicator briefly
                const indicator = document.getElementById('rotate-indicator');
                indicator.classList.remove('hidden');
                setTimeout(() => {
                    indicator.classList.add('hidden');
                }, 3000);
            } else {
                // Exit landscape mode - return to normal
                exitFullscreenMode(currentVideo);
            }
        }

        // Enter fullscreen mode - FIXED for mobile
        function enterFullscreenMode(videoElement) {
            if (!videoElement) return;
            
            // Save current play state
            appState.wasPlayingBeforeRotate = !videoElement.paused;
            
            // Add fullscreen class
            videoElement.classList.add('fullscreen-mode', 'auto-rotate');
            
            // Hide navigation
            document.body.classList.add('video-playing');
            
            // Try native fullscreen API for better mobile support
            try {
                if (videoElement.requestFullscreen) {
                    videoElement.requestFullscreen();
                } else if (videoElement.webkitRequestFullscreen) {
                    videoElement.webkitRequestFullscreen();
                } else if (videoElement.webkitEnterFullscreen) {
                    // iOS Safari
                    videoElement.webkitEnterFullscreen();
                } else if (videoElement.mozRequestFullScreen) {
                    videoElement.mozRequestFullScreen();
                } else if (videoElement.msRequestFullscreen) {
                    videoElement.msRequestFullscreen();
                }
            } catch (e) {
                console.log('Fullscreen request failed:', e);
                // Fallback: just use CSS fullscreen
                videoElement.style.position = 'fixed';
                videoElement.style.top = '0';
                videoElement.style.left = '0';
                videoElement.style.width = '100vw';
                videoElement.style.height = '100vh';
                videoElement.style.zIndex = '10000';
            }
            
            // Ensure video continues playing
            if (appState.wasPlayingBeforeRotate) {
                videoElement.play().catch(e => console.log('Play after rotate failed:', e));
            }
        }

        // Exit fullscreen mode - FIXED for mobile
        function exitFullscreenMode(videoElement) {
            if (!videoElement) return;
            
            // Remove fullscreen class
            videoElement.classList.remove('fullscreen-mode', 'auto-rotate');
            
            // Reset CSS fallback
            videoElement.style.position = '';
            videoElement.style.top = '';
            videoElement.style.left = '';
            videoElement.style.width = '';
            videoElement.style.height = '';
            videoElement.style.zIndex = '';
            
            // Show navigation again
            document.body.classList.remove('video-playing');
            
            // Exit native fullscreen
            try {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.webkitCancelFullScreen) {
                    document.webkitCancelFullScreen();
                } else if (document.mozCancelFullScreen) {
                    document.mozCancelFullScreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
            } catch (e) {
                console.log('Exit fullscreen failed:', e);
            }
            
            // Ensure video continues playing
            if (appState.wasPlayingBeforeRotate) {
                videoElement.play().catch(e => console.log('Play after rotate exit failed:', e));
            }
        }

        // Handle fullscreen change - FIXED for mobile
        function handleFullscreenChange() {
            const isFullscreen = !!(
                document.fullscreenElement ||
                document.webkitFullscreenElement ||
                document.mozFullScreenElement ||
                document.msFullscreenElement
            );
            
            if (!isFullscreen && appState.currentPage === 'home') {
                // Exited fullscreen, ensure navigation is visible
                document.body.classList.remove('video-playing');
                
                // Remove fullscreen class from video
                const video = document.querySelector(`.reel-video[data-index="${appState.currentVideoIndex}"]`);
                if (video) {
                    video.classList.remove('fullscreen-mode', 'auto-rotate');
                    
                    // Reset CSS fallback
                    video.style.position = '';
                    video.style.top = '';
                    video.style.left = '';
                    video.style.width = '';
                    video.style.height = '';
                    video.style.zIndex = '';
                }
            }
        }

        // Check database setup
        async function checkDatabaseSetup() {
            try {
                const { error } = await supabase.from('videos').select('count').limit(1);
                if (error?.code === '42P01') showModal('sql-setup-modal');
            } catch { showModal('sql-setup-modal'); }
        }

        // Enhanced PWA install setup
        function setupPWAInstall() {
            const isInstalled = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
            if (isInstalled) {
                // Already installed, hide button permanently
                document.getElementById('pwa-install-btn')?.classList.add('hidden');
                return;
            }
            
            // Listen for beforeinstallprompt
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                appState.deferredPrompt = e;
                showInstallButton();
            });

            // Also check if the app is already installable but event didn't fire (fallback)
            setTimeout(() => {
                if (!isInstalled && !appState.deferredPrompt && 'onbeforeinstallprompt' in window) {
                    // Browser supports installation but event didn't fire? Show a fallback button
                    showInstallButton(true);
                }
            }, 3000);
        }

        function showInstallButton(fallback = false) {
            const btn = document.getElementById('pwa-install-btn');
            if (btn) {
                btn.classList.remove('hidden');
                if (fallback) {
                    btn.innerHTML = '<i class="fas fa-mobile-alt"></i> Install App';
                    btn.title = 'Install App (use browser menu)';
                } else {
                    btn.innerHTML = '<i class="fas fa-download"></i> Install App';
                }
                // Remove any previous click listener and attach new one
                btn.onclick = async () => {
                    if (appState.deferredPrompt) {
                        // Standard flow
                        appState.deferredPrompt.prompt();
                        const { outcome } = await appState.deferredPrompt.userChoice;
                        console.log(`User response to install: ${outcome}`);
                        appState.deferredPrompt = null;
                        btn.classList.add('hidden'); // Hide after prompt
                    } else if (fallback) {
                        // Fallback: show instructions
                        if (/iphone|ipad|ipod/i.test(navigator.userAgent)) {
                            alert('To install this app, tap Share button ‚Üí Add to Home Screen');
                        } else if (/android/i.test(navigator.userAgent)) {
                            alert('To install this app, tap menu ‚Üí Install App');
                        } else {
                            alert('To install this app, use your browser\'s "Install" or "Add to Home Screen" option.');
                        }
                    }
                };
            }
        }

        // Load preferences
        function loadPreferences() {
            appState.language = localStorage.getItem('appLanguage') || 'en';
            appState.theme = localStorage.getItem('appTheme') || 'dark';
            document.documentElement.setAttribute('data-theme', appState.theme);
        }

        // Setup event listeners
        function setupEventListeners() {
            // Scroll listener for reels
            const reelsContainer = document.getElementById('reels-container');
            if (reelsContainer) {
                reelsContainer.addEventListener('scroll', () => {
                    clearTimeout(appState.scrollTimeout);
                    appState.scrollTimeout = setTimeout(() => {
                        handleReelScroll();
                    }, 100);
                });
            }

            // Keyboard navigation
            document.addEventListener('keydown', (e) => {
                if (appState.currentPage === 'home') {
                    if (e.key === 'ArrowUp') { 
                        e.preventDefault(); 
                        scrollToPrevReel();
                    }
                    if (e.key === 'ArrowDown') { 
                        e.preventDefault(); 
                        scrollToNextReel();
                    }
                    if (e.key === ' ') {
                        e.preventDefault();
                        togglePlayPause();
                    }
                }
            });

            // Touch events for double tap to like (optional)
            let lastTap = 0;
            document.getElementById('reels-container')?.addEventListener('touchend', (e) => {
                const currentTime = new Date().getTime();
                const tapLength = currentTime - lastTap;
                if (tapLength < 300 && tapLength > 0) {
                    e.preventDefault();
                    likeCurrentVideo();
                }
                lastTap = currentTime;
            });

            window.addEventListener('online', () => {
                document.getElementById('offline-indicator').classList.remove('show');
                showToast('success', 'Back Online', 'Connection restored');
            });
            window.addEventListener('offline', () => {
                document.getElementById('offline-indicator').classList.add('show');
                showToast('error', 'Offline', 'Connection lost');
            });
        }

        // Handle reel scroll
        function handleReelScroll() {
            const container = document.getElementById('reels-container');
            const reels = document.querySelectorAll('.reel-item');
            const containerHeight = container.clientHeight;
            const scrollTop = container.scrollTop;
            
            let activeIndex = Math.round(scrollTop / containerHeight);
            activeIndex = Math.max(0, Math.min(activeIndex, reels.length - 1));
            
            if (activeIndex !== appState.currentVideoIndex) {
                pauseAllVideos();
                appState.currentVideoIndex = activeIndex;
                playVideoAtIndex(activeIndex);
            }
        }

        // Scroll to previous reel
        function scrollToPrevReel() {
            const container = document.getElementById('reels-container');
            const newIndex = Math.max(0, appState.currentVideoIndex - 1);
            if (newIndex !== appState.currentVideoIndex) {
                container.scrollTo({
                    top: newIndex * container.clientHeight,
                    behavior: 'smooth'
                });
            }
        }

        // Scroll to next reel
        function scrollToNextReel() {
            const container = document.getElementById('reels-container');
            const newIndex = Math.min(appState.videos.length - 1, appState.currentVideoIndex + 1);
            if (newIndex !== appState.currentVideoIndex) {
                container.scrollTo({
                    top: newIndex * container.clientHeight,
                    behavior: 'smooth'
                });
            }
        }

        // Toggle play/pause
        function togglePlayPause() {
            const video = document.querySelector(`.reel-video[data-index="${appState.currentVideoIndex}"]`);
            if (video) {
                if (video.paused) {
                    video.play();
                    appState.isPlaying = true;
                    showPlayPauseIndicator('play');
                } else {
                    video.pause();
                    appState.isPlaying = false;
                    showPlayPauseIndicator('pause');
                }
            }
        }

        // Show play/pause indicator
        function showPlayPauseIndicator(action) {
            const indicator = document.getElementById('play-pause-indicator');
            indicator.innerHTML = `<i class="fas fa-${action === 'play' ? 'play' : 'pause'}"></i>`;
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 500);
        }

        // Like current video
        function likeCurrentVideo() {
            const video = appState.videos[appState.currentVideoIndex];
            if (video) {
                video.likes = (video.likes || 0) + 1;
                updateReelLikes(appState.currentVideoIndex, video.likes);
                showToast('success', 'Liked!', 'Thanks for the like');
            }
        }

        // Update reel likes
        function updateReelLikes(index, likes) {
            const likeCount = document.querySelector(`.reel-item[data-index="${index}"] .like-count`);
            if (likeCount) {
                likeCount.textContent = likes;
            }
        }

        // Pause all videos
        function pauseAllVideos() {
            document.querySelectorAll('.reel-video').forEach(video => {
                video.pause();
            });
        }

        // Play video at index
        function playVideoAtIndex(index) {
            const video = document.querySelector(`.reel-video[data-index="${index}"]`);
            if (video) {
                video.play().catch(e => console.log('Play failed:', e));
                appState.currentVideoPlayer = video;
                appState.currentAccount = appState.videos[index]?.account;
            }
        }

        // Load initial data
        async function loadInitialData() {
            try {
                await Promise.all([loadVideos(), loadAccounts(), loadBookRequests()]);
                updateNotificationCount();
                updateAdminStats();
                renderReels();
            } catch (error) {
                console.error('Error loading initial data:', error);
                initializeWithDemoData();
                renderReels();
            }
        }

        // Render reels
        function renderReels() {
            const container = document.getElementById('reels-container');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (!appState.videos.length) {
                container.innerHTML = `
                    <div class="reel-item">
                        <div class="flex items-center justify-center h-full">
                            <div class="text-center">
                                <i class="fas fa-video text-4xl text-zinc-600 mb-4"></i>
                                <p class="text-zinc-400">No videos available</p>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }
            
            appState.videos.forEach((video, index) => {
                const reelItem = document.createElement('div');
                reelItem.className = 'reel-item';
                reelItem.setAttribute('data-index', index);
                
                reelItem.innerHTML = `
                    <div class="reel-video-container">
                        <video class="reel-video" data-index="${index}" src="${video.url}" loop playsinline preload="metadata"></video>
                        
                        <!-- Top Gradient -->
                        <div class="reel-top-gradient"></div>
                        
                        <!-- Video Info -->
                        <div class="reel-info">
                            <div class="reel-title">
                                <i class="fas fa-music"></i>
                                <span>${video.title}</span>
                            </div>
                            <div class="reel-description">
                                ${video.description || 'Premium video content'}
                            </div>
                            <div class="reel-stats">
                                <span><i class="fas fa-eye"></i> ${video.views || 0}</span>
                                <span class="like-count"><i class="fas fa-heart"></i> ${video.likes || 0}</span>
                                <span><i class="fas fa-tag"></i> $${video.price}</span>
                            </div>
                        </div>
                        
                        <!-- Right Action Buttons -->
                        <div class="reel-actions">
                            <div class="reel-action-btn" onclick="bookFromReel(${index})">
                                <div class="icon-circle"><i class="fas fa-bookmark"></i></div>
                                <span>Book</span>
                            </div>
                            <div class="reel-action-btn" onclick="buyFromReel(${index})">
                                <div class="icon-circle"><i class="fas fa-shopping-bag"></i></div>
                                <span>Buy</span>
                            </div>
                            <div class="reel-action-btn" onclick="likeFromReel(${index})">
                                <div class="icon-circle"><i class="fas fa-heart"></i></div>
                                <span class="like-count">${video.likes || 0}</span>
                            </div>
                            <div class="reel-action-btn" onclick="shareFromReel(${index})">
                                <div class="icon-circle"><i class="fas fa-share"></i></div>
                                <span>Share</span>
                            </div>
                        </div>
                        
                        <!-- Overlay -->
                        <div class="reel-overlay"></div>
                    </div>
                `;
                
                container.appendChild(reelItem);
                
                // Add click to play/pause
                const videoEl = reelItem.querySelector('.reel-video');
                videoEl.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (videoEl.paused) {
                        videoEl.play();
                    } else {
                        videoEl.pause();
                    }
                });
                
                // Track views
                videoEl.addEventListener('play', () => {
                    if (!video.viewTracked) {
                        video.views = (video.views || 0) + 1;
                        video.viewTracked = true;
                        updateReelStats(index, 'views', video.views);
                    }
                });
            });
            
            // Play first video after a short delay
            setTimeout(() => {
                playVideoAtIndex(0);
            }, 500);
        }

        // Update reel stats
        function updateReelStats(index, stat, value) {
            const reel = document.querySelector(`.reel-item[data-index="${index}"]`);
            if (reel) {
                if (stat === 'views') {
                    const viewsEl = reel.querySelector('.fa-eye').parentElement;
                    viewsEl.innerHTML = `<i class="fas fa-eye"></i> ${value}`;
                } else if (stat === 'likes') {
                    const likesEl = reel.querySelector('.fa-heart').parentElement;
                    likesEl.innerHTML = `<i class="fas fa-heart"></i> ${value}`;
                    const likeCount = reel.querySelector('.like-count');
                    if (likeCount) likeCount.textContent = value;
                }
            }
        }

        // Book from reel
        function bookFromReel(index) {
            const video = appState.videos[index];
            if (video) {
                appState.currentAccount = video.account || video;
                document.getElementById('book-account-name').textContent = video.title;
                document.getElementById('book-account-tier').textContent = video.tier;
                document.getElementById('book-account-price').textContent = `$${video.price}`;
                showModal('book-modal');
            }
        }

        // Buy from reel
        function buyFromReel(index) {
            const video = appState.videos[index];
            if (video) {
                appState.currentAccount = video.account || video;
                document.getElementById('buy-account-name').textContent = video.title;
                document.getElementById('buy-account-tier').textContent = video.tier;
                document.getElementById('buy-account-price').textContent = `$${video.price}`;
                showModal('buy-modal');
            }
        }

        // Like from reel
        function likeFromReel(index) {
            const video = appState.videos[index];
            if (video) {
                video.likes = (video.likes || 0) + 1;
                updateReelStats(index, 'likes', video.likes);
                showToast('success', 'Liked!', 'Thanks for the like');
            }
        }

        // Share from reel
        function shareFromReel(index) {
            const video = appState.videos[index];
            if (video) {
                appState.shareVideo = { id: video.id, title: video.title };
                document.getElementById('share-video-title').textContent = video.title;
                showModal('share-modal');
            }
        }

        // Load videos
        async function loadVideos() {
            const { data, error } = await supabase.from('videos').select('*').order('created_at', { ascending: false });
            if (error) {
                console.error('Error loading videos:', error);
                return;
            }
            if (data?.length) {
                appState.videos = data.map(v => ({
                    id: v.video_id, 
                    title: v.video_title, 
                    description: v.description, 
                    views: v.views || 0,
                    likes: v.likes || 0, 
                    url: v.video_url, 
                    tier: v.account_tier, 
                    price: v.price,
                    storage_path: v.storage_path,
                    bucket_name: v.bucket_name,
                    createdAt: v.created_at, 
                    viewTracked: false,
                    account: { 
                        id: v.video_id, 
                        title: v.video_title, 
                        tier: v.account_tier, 
                        price: v.price,
                        url: v.video_url
                    }
                }));
            }
        }

        // Load accounts
        async function loadAccounts() {
            const { data, error } = await supabase.from('videos').select('video_id, video_title, description, account_tier, price, sold, video_url, storage_path, bucket_name');
            if (error) {
                console.error('Error loading accounts:', error);
                return;
            }
            if (data?.length) {
                appState.accounts = data.map(v => ({
                    id: v.video_id, 
                    title: v.video_title, 
                    description: v.description, 
                    tier: v.account_tier,
                    price: v.price, 
                    sold: v.sold || false, 
                    url: v.video_url,
                    storage_path: v.storage_path,
                    bucket_name: v.bucket_name
                }));
            }
        }

        // Load book requests
        async function loadBookRequests() {
            const { data, error } = await supabase.from('book_requests').select('*').order('created_at', { ascending: false });
            if (error) {
                console.error('Error loading book requests:', error);
                return;
            }
            if (data) appState.bookRequests = data;
        }

        // Initialize with demo data
        function initializeWithDemoData() {
            appState.videos = [{
                id: 'demo_001', 
                title: 'Welcome to GK Store', 
                description: 'Premium accounts marketplace',
                views: 150, 
                likes: 45, 
                url: 'https://assets.mixkit.co/videos/preview/mixkit-close-up-of-a-blue-tit-1257-large.mp4',
                tier: 'small', 
                price: 199, 
                viewTracked: false,
                account: { 
                    id: 'demo_001', 
                    title: 'Welcome to GK Store', 
                    tier: 'small', 
                    price: 199,
                    url: 'https://assets.mixkit.co/videos/preview/mixkit-close-up-of-a-blue-tit-1257-large.mp4'
                }
            },
            {
                id: 'demo_002', 
                title: 'Premium Content', 
                description: 'Exclusive videos',
                views: 89, 
                likes: 23, 
                url: 'https://assets.mixkit.co/videos/preview/mixkit-tree-with-yellow-flowers-1173-large.mp4',
                tier: 'medium', 
                price: 299,
                viewTracked: false,
                account: { 
                    id: 'demo_002', 
                    title: 'Premium Content', 
                    tier: 'medium', 
                    price: 299,
                    url: 'https://assets.mixkit.co/videos/preview/mixkit-tree-with-yellow-flowers-1173-large.mp4'
                }
            }];
            appState.accounts = appState.videos.map(v => ({
                id: v.id, 
                title: v.title, 
                description: v.description, 
                tier: v.tier, 
                price: v.price, 
                sold: false, 
                url: v.url
            }));
        }

        // Show page
        function showPage(page) {
            if (['home','accounts','profile','contact','admin','notifications'].includes(page) && !appState.isLoggedIn) page = 'auth';
            if (page === 'auth' && appState.isLoggedIn) page = 'home';
            
            document.querySelectorAll('[id$="-page"]').forEach(p => p.classList.add('hidden'));
            document.getElementById(`${page}-page`).classList.remove('hidden');
            appState.currentPage = page;
            
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            document.querySelector(`.nav-item[href="#${page}"]`)?.classList.add('active');
            
            if (page === 'home') {
                setTimeout(() => {
                    pauseAllVideos();
                    playVideoAtIndex(appState.currentVideoIndex);
                }, 100);
            }
            if (page === 'accounts') loadAccountsContent();
            if (page === 'admin') document.getElementById('admin-dashboard').classList.toggle('hidden', !appState.isAdminLoggedIn);
        }

        // Load accounts content
        function loadAccountsContent() {
            const grid = document.getElementById('accounts-grid');
            grid.innerHTML = '';
            if (!appState.accounts.length) {
                grid.innerHTML = '<div class="col-span-2 text-center py-12">No accounts available</div>';
                return;
            }
            appState.accounts.forEach(a => {
                grid.innerHTML += `
                    <div class="account-card">
                        <div class="account-icon ${a.tier}" onclick="playVideoFromAccount('${a.id}')">
                            <i class="fas ${a.tier === 'small' ? 'fa-user' : a.tier === 'medium' ? 'fa-user-tie' : 'fa-crown'}"></i>
                        </div>
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-semibold">${a.title}</h3>
                            <span class="badge ${a.tier === 'big' ? 'badge-primary' : a.tier === 'medium' ? 'badge-secondary' : 'badge-warning'}">${a.tier}</span>
                        </div>
                        <p class="text-zinc-400 text-sm mb-4">${a.description || 'Premium account'}</p>
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-2xl font-bold gradient-text">$${a.price}</span>
                        </div>
                        <div class="account-actions">
                            <button class="account-action-btn book" onclick="bookFromAccount('${a.id}')">
                                <i class="fas fa-bookmark"></i> Book
                            </button>
                            <button class="account-action-btn buy" onclick="buyFromAccount('${a.id}')">
                                <i class="fas fa-shopping-bag"></i> Buy
                            </button>
                            <button class="account-action-btn share" onclick="shareFromAccount('${a.id}')">
                                <i class="fas fa-share"></i> Share
                            </button>
                        </div>
                    </div>
                `;
            });
        }

        // Filter accounts
        function filterAccounts(tier) {
            document.querySelectorAll('#accounts-page .tab-item').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            const grid = document.getElementById('accounts-grid');
            const filtered = tier === 'all' ? appState.accounts : appState.accounts.filter(a => a.tier === tier);
            grid.innerHTML = '';
            filtered.forEach(a => {
                grid.innerHTML += `
                    <div class="account-card">
                        <div class="account-icon ${a.tier}" onclick="playVideoFromAccount('${a.id}')">
                            <i class="fas ${a.tier === 'small' ? 'fa-user' : a.tier === 'medium' ? 'fa-user-tie' : 'fa-crown'}"></i>
                        </div>
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-semibold">${a.title}</h3>
                            <span class="badge ${a.tier === 'big' ? 'badge-primary' : a.tier === 'medium' ? 'badge-secondary' : 'badge-warning'}">${a.tier}</span>
                        </div>
                        <p class="text-zinc-400 text-sm mb-4">${a.description || 'Premium account'}</p>
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-2xl font-bold gradient-text">$${a.price}</span>
                        </div>
                        <div class="account-actions">
                            <button class="account-action-btn book" onclick="bookFromAccount('${a.id}')">
                                <i class="fas fa-bookmark"></i> Book
                            </button>
                            <button class="account-action-btn buy" onclick="buyFromAccount('${a.id}')">
                                <i class="fas fa-shopping-bag"></i> Buy
                            </button>
                            <button class="account-action-btn share" onclick="shareFromAccount('${a.id}')">
                                <i class="fas fa-share"></i> Share
                            </button>
                        </div>
                    </div>
                `;
            });
        }

        // Play video from account
        function playVideoFromAccount(id) {
            const video = appState.videos.find(v => v.id === id);
            if (video) {
                const index = appState.videos.findIndex(v => v.id === id);
                if (index !== -1) {
                    appState.currentVideoIndex = index;
                    showPage('home');
                    setTimeout(() => {
                        const container = document.getElementById('reels-container');
                        container.scrollTo({
                            top: index * container.clientHeight,
                            behavior: 'smooth'
                        });
                    }, 100);
                }
            }
        }

        // Book from account
        function bookFromAccount(id) {
            const account = appState.accounts.find(a => a.id === id);
            if (account) {
                appState.currentAccount = account;
                document.getElementById('book-account-name').textContent = account.title;
                document.getElementById('book-account-tier').textContent = account.tier;
                document.getElementById('book-account-price').textContent = `$${account.price}`;
                showModal('book-modal');
            }
        }

        // Buy from account
        function buyFromAccount(id) {
            const account = appState.accounts.find(a => a.id === id);
            if (account) {
                appState.currentAccount = account;
                document.getElementById('buy-account-name').textContent = account.title;
                document.getElementById('buy-account-tier').textContent = account.tier;
                document.getElementById('buy-account-price').textContent = `$${account.price}`;
                showModal('buy-modal');
            }
        }

        // Share from account
        function shareFromAccount(id) {
            const account = appState.accounts.find(a => a.id === id);
            if (account) {
                appState.shareVideo = { id: account.id, title: account.title };
                document.getElementById('share-video-title').textContent = account.title;
                showModal('share-modal');
            }
        }

        // Admin login
        async function adminLogin(e) {
            e.preventDefault();
            const email = document.getElementById('admin-email').value;
            const pass = document.getElementById('admin-password').value;
            
            try {
                const { data, error } = await supabase.auth.signInWithPassword({ 
                    email, 
                    password: pass 
                });
                
                if (error) {
                    console.error('Login error:', error);
                    return showToast('error', 'Admin Login', 'Invalid credentials');
                }
                
                if (data.user) {
                    const userRole = data.user.user_metadata?.role || 
                                    data.user.raw_user_meta_data?.role;
                    
                    if (userRole === 'admin') {
                        appState.isAdminLoggedIn = true;
                        appState.isLoggedIn = true;
                        appState.currentUser = { 
                            email: data.user.email, 
                            name: 'Admin User', 
                            role: 'admin',
                            id: data.user.id
                        };
                        
                        localStorage.setItem('gkStoreUser', JSON.stringify(appState.currentUser));
                        localStorage.setItem('gkStoreAdmin', 'true');
                        
                        document.getElementById('admin-dashboard').classList.remove('hidden');
                        showToast('success', 'Admin Login', 'Logged in as admin');
                        showPage('admin');
                        updateAdminStats();
                    } else {
                        showToast('error', 'Admin Login', 'Not authorized as admin');
                        await supabase.auth.signOut();
                    }
                }
            } catch (error) {
                console.error('Login error:', error);
                showToast('error', 'Admin Login', 'Login failed');
            }
        }

        // Update admin stats
        function updateAdminStats() {
            document.getElementById('admin-video-count').textContent = appState.videos.length;
            document.getElementById('admin-registered-users').textContent = appState.userStats.registeredUsers;
            document.getElementById('admin-online-users').textContent = appState.userStats.onlineUsers || 1;
            document.getElementById('admin-sold-count').textContent = appState.accounts.filter(a => a.sold).length;
            
            const activity = document.getElementById('admin-recent-activity');
            activity.innerHTML = '';
            appState.videos.slice(0, 3).forEach(v => {
                activity.innerHTML += `
                    <div class="flex items-center justify-between p-3 bg-surface-light rounded-lg">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-full bg-primary flex items-center justify-center">
                                <i class="fas fa-video text-white text-xs"></i>
                            </div>
                            <div>
                                <p class="text-sm font-medium">${v.title}</p>
                                <p class="text-xs text-zinc-400">${v.tier} ‚Ä¢ $${v.price}</p>
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        // Show upload video
        function showUploadVideo() {
            if (!appState.isAdminLoggedIn) {
                showToast('error', 'Access Denied', 'Login as admin first');
                return;
            }
            resetUploadForm();
            showModal('upload-video-modal');
        }

        // Reset upload form
        function resetUploadForm() {
            document.getElementById('video-title-input').value = '';
            document.getElementById('video-description-input').value = '';
            document.getElementById('video-price').value = '';
            document.getElementById('video-tier').value = '';
            document.getElementById('video-file').value = '';
            document.getElementById('file-info').classList.add('hidden');
            document.getElementById('upload-status').classList.add('hidden');
            document.getElementById('upload-progress').style.width = '0%';
            document.getElementById('file-upload-area').classList.remove('has-file');
            document.getElementById('file-upload-text').textContent = 'Click to select video file';
            appState.currentUpload.file = null;
        }

        // Update bucket info
        function updateBucketInfo() {
            const tier = document.getElementById('video-tier').value;
            const fileUploadArea = document.getElementById('file-upload-area');
            let maxSize = '500MB';
            
            if (tier === 'small') maxSize = '100MB';
            else if (tier === 'medium') maxSize = '200MB';
            
            fileUploadArea.querySelector('.text-xs').textContent = `MP4, WebM, OGG (max ${maxSize})`;
        }

        // Handle file select
        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const tier = document.getElementById('video-tier').value;
            if (!tier) {
                showToast('error', 'Select Tier', 'Please select a tier first');
                document.getElementById('video-file').value = '';
                return;
            }
            
            let maxSize = 500 * 1024 * 1024;
            if (tier === 'small') maxSize = 100 * 1024 * 1024;
            else if (tier === 'medium') maxSize = 200 * 1024 * 1024;
            
            if (file.size > maxSize) {
                const maxSizeMB = maxSize / (1024 * 1024);
                showToast('error', 'File Too Large', `Maximum size for ${tier} tier is ${maxSizeMB}MB`);
                document.getElementById('video-file').value = '';
                return;
            }
            
            const validTypes = ['video/mp4', 'video/webm', 'video/ogg'];
            if (!validTypes.includes(file.type)) {
                showToast('error', 'Invalid Format', 'Please upload MP4, WebM, or OGG video');
                document.getElementById('video-file').value = '';
                return;
            }
            
            appState.currentUpload.file = file;
            
            document.getElementById('file-info').classList.remove('hidden');
            document.getElementById('file-name').textContent = file.name;
            document.getElementById('file-size').textContent = formatFileSize(file.size);
            document.getElementById('file-upload-area').classList.add('has-file');
            document.getElementById('file-upload-text').textContent = 'File selected';
            
            showToast('info', 'File Selected', file.name);
        }

        // Format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Upload video
        async function uploadVideo() {
            if (!appState.isAdminLoggedIn) {
                showToast('error', 'Access Denied', 'Please login as admin first');
                return;
            }
            
            const title = document.getElementById('video-title-input').value;
            const description = document.getElementById('video-description-input').value || 'No description';
            const price = parseFloat(document.getElementById('video-price').value);
            const tier = document.getElementById('video-tier').value;
            const file = appState.currentUpload.file;
            
            if (!title || !price || !tier || !file) {
                showToast('error', 'Validation Error', 'Please fill all fields and select a video');
                return;
            }
            
            const videoId = `vid_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
            
            const bucketName = `videos-${tier}`;
            const fileExt = file.name.split('.').pop();
            const fileName = `${videoId}.${fileExt}`;
            const filePath = `${fileName}`;
            
            const statusDiv = document.getElementById('upload-status');
            const progressBar = document.getElementById('upload-progress');
            const progressText = document.getElementById('upload-percentage');
            const statusText = document.getElementById('upload-status-text');
            
            statusDiv.classList.remove('hidden');
            progressBar.style.width = '0%';
            progressText.textContent = '0%';
            statusText.textContent = 'Preparing upload...';
            
            const btn = document.getElementById('upload-btn');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner animate-spin"></i> Uploading...';
            
            try {
                const { data: { session } } = await supabase.auth.getSession();
                if (!session) {
                    throw new Error('No active session. Please login again.');
                }
                
                statusText.textContent = 'Uploading to storage...';
                
                const { data: uploadData, error: uploadError } = await supabase.storage
                    .from(bucketName)
                    .upload(filePath, file, {
                        cacheControl: '3600',
                        upsert: false
                    });
                
                if (uploadError) {
                    console.error('Storage upload error:', uploadError);
                    throw new Error(`Storage upload failed: ${uploadError.message}`);
                }
                
                statusText.textContent = 'Upload complete! Getting public URL...';
                
                const { data: urlData } = supabase.storage
                    .from(bucketName)
                    .getPublicUrl(filePath);
                
                const publicUrl = urlData.publicUrl;
                
                statusText.textContent = 'Saving to database...';
                
                const { data: insertData, error: insertError } = await supabase
                    .from('videos')
                    .insert([{
                        video_id: videoId,
                        video_title: title,
                        description: description,
                        video_url: publicUrl,
                        storage_path: filePath,
                        bucket_name: bucketName,
                        account_tier: tier,
                        price: price,
                        sold: false,
                        views: 0,
                        likes: 0
                    }])
                    .select();
                
                if (insertError) {
                    console.error('Database insert error:', insertError);
                    
                    await supabase.storage.from(bucketName).remove([filePath]);
                    
                    throw new Error(`Database insert failed: ${insertError.message}`);
                }
                
                statusText.textContent = 'Complete!';
                progressBar.style.width = '100%';
                progressText.textContent = '100%';
                
                const newVideo = insertData[0];
                const videoObj = {
                    id: newVideo.video_id,
                    title: newVideo.video_title,
                    description: newVideo.description,
                    views: 0,
                    likes: 0,
                    url: newVideo.video_url,
                    tier: newVideo.account_tier,
                    price: newVideo.price,
                    storage_path: newVideo.storage_path,
                    bucket_name: newVideo.bucket_name,
                    viewTracked: false,
                    account: {
                        id: newVideo.video_id,
                        title: newVideo.video_title,
                        tier: newVideo.account_tier,
                        price: newVideo.price,
                        url: newVideo.video_url
                    }
                };
                
                appState.videos.unshift(videoObj);
                
                appState.accounts.unshift({
                    id: newVideo.video_id,
                    title: newVideo.video_title,
                    description: newVideo.description,
                    tier: newVideo.account_tier,
                    price: newVideo.price,
                    sold: false,
                    url: newVideo.video_url,
                    storage_path: newVideo.storage_path,
                    bucket_name: newVideo.bucket_name
                });
                
                renderReels();
                updateAdminStats();
                
                showToast('success', 'Success!', `Video "${title}" uploaded successfully`);
                
                setTimeout(() => {
                    closeModal('upload-video-modal');
                    resetUploadForm();
                }, 1500);
                
            } catch (error) {
                console.error('Upload error:', error);
                showToast('error', 'Upload Failed', error.message);
                
                statusDiv.classList.add('hidden');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-upload"></i> Upload Video';
            }
        }

        // Show manage videos
        async function showManageVideos() {
            if (!appState.isAdminLoggedIn) return showToast('error', 'Access Denied', 'Login as admin first');
            await loadAdminVideos();
            showModal('manage-videos-modal');
        }

        // Load admin videos
        async function loadAdminVideos(filter = 'all') {
            const list = document.getElementById('admin-videos-list');
            const filtered = filter === 'all' ? appState.videos : appState.videos.filter(v => v.tier === filter);
            
            if (!filtered.length) {
                list.innerHTML = '<div class="text-center py-8 text-zinc-400">No videos found</div>';
                return;
            }
            
            list.innerHTML = '';
            filtered.forEach(v => {
                list.innerHTML += `
                    <div class="flex items-center justify-between p-3 bg-surface-light rounded-lg">
                        <div class="flex-1">
                            <div class="flex items-center gap-2">
                                <span class="font-medium">${v.title}</span>
                                <span class="badge ${v.tier === 'big' ? 'badge-primary' : v.tier === 'medium' ? 'badge-secondary' : 'badge-warning'}">${v.tier}</span>
                            </div>
                            <p class="text-xs text-zinc-400">ID: ${v.id} ‚Ä¢ $${v.price}</p>
                        </div>
                        <div class="flex gap-2">
                            <button class="btn btn-sm" style="background: var(--danger); color: white;" onclick="deleteVideo('${v.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
        }

        // Admin filter videos
        function adminFilterVideos(tier) {
            document.querySelectorAll('#manage-videos-modal .tab-item').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            loadAdminVideos(tier);
        }

        // Delete video
        async function deleteVideo(id) {
            if (!appState.isAdminLoggedIn || !confirm('Delete this video?')) return;
            
            const video = appState.videos.find(v => v.id === id);
            
            try {
                if (video?.storage_path && video?.bucket_name) {
                    await supabase.storage
                        .from(video.bucket_name)
                        .remove([video.storage_path]);
                }
                
                const { error } = await supabase
                    .from('videos')
                    .delete()
                    .eq('video_id', id);
                
                if (error) throw error;
                
                appState.videos = appState.videos.filter(v => v.id !== id);
                appState.accounts = appState.accounts.filter(a => a.id !== id);
                
                loadAdminVideos('all');
                renderReels();
                updateAdminStats();
                showToast('success', 'Video Deleted', 'Removed successfully');
                
            } catch (error) {
                console.error('Delete error:', error);
                showToast('error', 'Delete Failed', error.message);
            }
        }

        // Show book requests
        async function showBookRequests() {
            if (!appState.isAdminLoggedIn) return showToast('error', 'Access Denied', 'Login as admin first');
            await loadAdminBookRequests();
            showModal('book-requests-modal');
        }

        // Load admin book requests
        async function loadAdminBookRequests() {
            const list = document.getElementById('admin-book-requests-list');
            const empty = document.getElementById('admin-book-requests-empty');
            await loadBookRequests();
            
            if (appState.bookRequests.length) {
                list.classList.remove('hidden');
                empty.classList.add('hidden');
                list.innerHTML = '';
                appState.bookRequests.forEach(r => {
                    list.innerHTML += `
                        <div class="card bg-surface-light">
                            <div class="card-body">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-semibold">${r.user_name}</h4>
                                    <span class="text-xs text-zinc-400">${new Date(r.created_at).toLocaleDateString()}</span>
                                </div>
                                <p class="text-sm mb-2">${r.whatsapp_number}</p>
                                <div class="flex gap-2 mt-3">
                                    <button class="btn btn-sm btn-primary flex-1" onclick="contactRequester('${r.whatsapp_number}')">
                                        <i class="fab fa-whatsapp"></i> Contact
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });
            } else {
                list.classList.add('hidden');
                empty.classList.remove('hidden');
            }
        }

        // Contact requester
        function contactRequester(number) {
            window.open(`https://wa.me/${number.replace(/\D/g,'')}?text=${encodeURIComponent('Hello from GK Store')}`, '_blank');
        }

        // Book account
        function bookAccount() {
            if (!appState.currentAccount) return;
            document.getElementById('book-account-name').textContent = appState.currentAccount.title;
            document.getElementById('book-account-tier').textContent = appState.currentAccount.tier;
            document.getElementById('book-account-price').textContent = `$${appState.currentAccount.price}`;
            showModal('book-modal');
        }

        // Buy now
        function buyNow() {
            if (!appState.currentAccount) return;
            document.getElementById('buy-account-name').textContent = appState.currentAccount.title;
            document.getElementById('buy-account-tier').textContent = appState.currentAccount.tier;
            document.getElementById('buy-account-price').textContent = `$${appState.currentAccount.price}`;
            showModal('buy-modal');
        }

        // Submit book request
        async function submitBookRequest() {
            const name = document.getElementById('book-name').value;
            const whatsapp = document.getElementById('book-whatsapp').value;
            if (!name || !whatsapp || !appState.currentAccount) return showToast('error', 'Validation Error', 'Fill all fields');
            
            const { error } = await supabase.from('book_requests').insert([{
                video_id: appState.currentAccount.id, 
                user_name: name, 
                whatsapp_number: whatsapp
            }]);
            
            if (error) {
                console.error('Book request error:', error);
                showToast('error', 'Submission Failed', error.message);
            } else {
                showToast('success', 'Request Submitted', 'We will contact you');
                closeModal('book-modal');
                document.getElementById('book-name').value = '';
                document.getElementById('book-whatsapp').value = '';
            }
        }

        // Show share modal
        function showShareModal(id) {
            appState.shareVideo = appState.videos.find(v => v.id === id) || 
                                 { id, title: 'Share Video' };
            document.getElementById('share-video-title').textContent = appState.shareVideo?.title || 'Video';
            showModal('share-modal');
        }

        // Share via WhatsApp
        function shareViaWhatsApp() {
            if (!appState.shareVideo) return;
            window.open(`https://wa.me/?text=${encodeURIComponent(`Check out this video: ${appState.shareVideo.title} - ${window.location.href}`)}`, '_blank');
        }

        // Share via Telegram
        function shareViaTelegram() {
            if (!appState.shareVideo) return;
            window.open(`https://t.me/share/url?url=${encodeURIComponent(window.location.href)}&text=${encodeURIComponent(appState.shareVideo.title)}`, '_blank');
        }

        // Copy share link
        function copyShareLink() {
            navigator.clipboard.writeText(window.location.href);
            showToast('success', 'Copied', 'Link copied');
        }

        // Share via system
        function shareViaSystem() {
            if (navigator.share && appState.shareVideo) {
                navigator.share({ 
                    title: appState.shareVideo.title, 
                    url: window.location.href 
                });
            } else {
                copyShareLink();
            }
        }

        // Copy USDT address
        function copyUSDTAddress() {
            navigator.clipboard.writeText(document.getElementById('usdt-address').textContent);
            showToast('success', 'Copied', 'Address copied');
        }

        // Copy address
        function copyAddress() {
            navigator.clipboard.writeText(document.getElementById('payment-address').textContent);
            showToast('success', 'Copied', 'Address copied');
        }

        // Open WhatsApp
        function openWhatsApp() {
            window.open('https://wa.me/93793066322?text=Hello%20GK%20Store', '_blank');
        }

        // Open payment chat
        function openPaymentChat() {
            if (!appState.currentAccount) return;
            window.open(`https://wa.me/93793066322?text=${encodeURIComponent(`I want to buy: ${appState.currentAccount.title} for $${appState.currentAccount.price}`)}`, '_blank');
        }

        // Show login form
        function showLoginForm() {
            document.getElementById('login-form-container').classList.remove('hidden');
            document.getElementById('signup-form-container').classList.add('hidden');
            document.getElementById('forgot-password-container').classList.add('hidden');
        }

        // Show signup form
        function showSignupForm() {
            document.getElementById('login-form-container').classList.add('hidden');
            document.getElementById('signup-form-container').classList.remove('hidden');
            document.getElementById('forgot-password-container').classList.add('hidden');
        }

        // Show forgot password
        function showForgotPassword() {
            document.getElementById('login-form-container').classList.add('hidden');
            document.getElementById('signup-form-container').classList.add('hidden');
            document.getElementById('forgot-password-container').classList.remove('hidden');
        }

        // Login
        function login(e) {
            e.preventDefault();
            appState.currentUser = { 
                email: document.getElementById('login-email').value, 
                name: 'User' 
            };
            appState.isLoggedIn = true;
            if (document.getElementById('remember-me').checked) {
                localStorage.setItem('gkStoreUser', JSON.stringify(appState.currentUser));
            }
            showToast('success', 'Welcome', 'Login successful');
            showPage('home');
        }

        // Signup
        function signup(e) {
            e.preventDefault();
            const pass = document.getElementById('signup-password').value;
            const confirm = document.getElementById('signup-confirm-password').value;
            if (pass !== confirm) return showToast('error', 'Signup Failed', 'Passwords do not match');
            if (pass.length < 6) return showToast('error', 'Signup Failed', 'Password too short');
            
            appState.currentUser = { 
                name: document.getElementById('signup-name').value, 
                email: document.getElementById('signup-email').value 
            };
            appState.isLoggedIn = true;
            localStorage.setItem('gkStoreUser', JSON.stringify(appState.currentUser));
            showToast('success', 'Welcome', 'Account created');
            showPage('home');
        }

        // Reset password
        function resetPassword(e) {
            e.preventDefault();
            showToast('success', 'Reset Link Sent', 'Check your email');
            showLoginForm();
        }

        // Logout
        async function logout() {
            await supabase.auth.signOut();
            appState.isLoggedIn = false;
            appState.currentUser = null;
            appState.isAdminLoggedIn = false;
            localStorage.removeItem('gkStoreUser');
            localStorage.removeItem('gkStoreAdmin');
            showPage('auth');
        }

        // Toggle language
        function toggleLanguage() { showModal('language-modal'); }

        // Set language
        function setLanguage(lang) {
            appState.language = lang;
            localStorage.setItem('appLanguage', lang);
            document.querySelectorAll('[id^="lang-"]').forEach(c => c.classList.add('hidden'));
            document.getElementById(`lang-${lang}-check`).classList.remove('hidden');
            document.body.dir = ['ar','fa','ur','ps'].includes(lang) ? 'rtl' : 'ltr';
            closeModal('language-modal');
        }

        // Toggle theme
        function toggleTheme() {
            appState.theme = appState.theme === 'dark' ? 'light' : 'dark';
            localStorage.setItem('appTheme', appState.theme);
            document.documentElement.setAttribute('data-theme', appState.theme);
        }

        // Show modal
        function showModal(id) {
            document.getElementById(id).classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        // Close modal
        function closeModal(id) {
            document.getElementById(id).classList.add('hidden');
            document.body.style.overflow = '';
        }

        // Close welcome modal
        function closeWelcomeModal() {
            closeModal('welcome-modal');
            showPage('auth');
        }

        // Show toast
        function showToast(type, title, msg) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-icon').className = `fas ${
                type === 'success' ? 'fa-check-circle text-success' : 
                type === 'error' ? 'fa-exclamation-circle text-danger' : 
                'fa-info-circle text-primary'
            }`;
            document.getElementById('toast-title').textContent = title;
            document.getElementById('toast-message').textContent = msg;
            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('hidden'), 3000);
        }

        // Update notification count
        function updateNotificationCount() {
            const unread = appState.notifications.filter(n => !n.read).length;
            const badge = document.getElementById('notification-count');
            badge.classList.toggle('hidden', !unread);
            badge.textContent = unread;
        }

        // Service Worker - ALL IN ONE - embedded directly
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // Create service worker as a blob URL
                const swCode = `
                    const CACHE_NAME = 'gk-store-v1';
                    const urlsToCache = [
                        '/',
                        '/index.html',
                        'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css',
                        'https://shamsahmadzai06-source.github.io/GKStore/android-launchericon-72-72.png',
                        'https://shamsahmadzai06-source.github.io/GKStore/android-launchericon-96-96.png',
                        'https://shamsahmadzai06-source.github.io/GKStore/android-launchericon-144-144.png',
                        'https://shamsahmadzai06-source.github.io/GKStore/android-launchericon-192-192.png',
                        'https://shamsahmadzai06-source.github.io/GKStore/android-launchericon-512-512.png'
                    ];

                    self.addEventListener('install', event => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(cache => cache.addAll(urlsToCache))
                                .then(() => self.skipWaiting())
                        );
                    });

                    self.addEventListener('activate', event => {
                        event.waitUntil(
                            caches.keys().then(cacheNames => {
                                return Promise.all(
                                    cacheNames.map(cacheName => {
                                        if (cacheName !== CACHE_NAME) {
                                            return caches.delete(cacheName);
                                        }
                                    })
                                );
                            }).then(() => self.clients.claim())
                        );
                    });

                    self.addEventListener('fetch', event => {
                        event.respondWith(
                            caches.match(event.request)
                                .then(response => {
                                    if (response) {
                                        return response;
                                    }
                                    return fetch(event.request)
                                        .then(response => {
                                            if (!response || response.status !== 200 || response.type !== 'basic') {
                                                return response;
                                            }
                                            const responseToCache = response.clone();
                                            caches.open(CACHE_NAME)
                                                .then(cache => {
                                                    cache.put(event.request, responseToCache);
                                                });
                                            return response;
                                        })
                                        .catch(() => {
                                            // Return offline fallback
                                            return new Response('You are offline', { status: 200 });
                                        });
                                })
                        );
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swUrl, { scope: '/' })
                    .then(registration => {
                        console.log('ServiceWorker registered successfully');
                    })
                    .catch(error => {
                        console.log('ServiceWorker registration failed:', error);
                    });
            });
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
