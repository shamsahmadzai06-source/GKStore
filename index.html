<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#ec4899">
    <meta name="description" content="GK Store - Exclusive Video Marketplace">
    
    <title>GK Store - Video Marketplace</title>
    
    <!-- Favicon and Apple Touch Icons -->
    <link rel="icon" type="image/png" href="https://shamsahmadzai06-source.github.io/GKStore/android-launchericon-96-96.png">
    <link rel="apple-touch-icon" href="https://shamsahmadzai06-source.github.io/GKStore/android-launchericon-192-192.png">
    <link rel="manifest" href="https://shamsahmadzai06-source.github.io/GKStore/manifest.json" id="app-manifest">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="GK Store">
    <link rel="apple-touch-startup-image" href="https://shamsahmadzai06-source.github.io/GKStore/android-launchericon-512-512.png">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* ALL YOUR ORIGINAL CSS - KEEP AS IS */
        :root {
            --primary: #ec4899;
            --primary-dark: #db2777;
            --secondary: #8b5cf6;
            --secondary-dark: #7c3aed;
            --accent: #f59e0b;
            --background: #000000;
            --surface: #18181b;
            --surface-light: #27272a;
            --text: #ffffff;
            --text-secondary: #a1a1aa;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --border: #3f3f46;
            --shadow: rgba(0, 0, 0, 0.5);
            --gradient: linear-gradient(135deg, var(--primary), var(--secondary));
            --gradient-reverse: linear-gradient(135deg, var(--secondary), var(--primary));
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background-color: var(--background);
            color: var(--text);
            line-height: 1.5;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* ALL YOUR CSS CLASSES - KEEP AS IS */
        .hidden { display: none; }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .text-center { text-align: center; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-4 { margin-top: 1rem; }
        .w-full { width: 100%; }
        .btn { 
            display: inline-flex; align-items: center; justify-content: center; 
            gap: 0.5rem; padding: 0.75rem 1.5rem; border-radius: 0.75rem; 
            font-weight: 600; font-size: 0.875rem; text-decoration: none; 
            cursor: pointer; border: none; transition: all 0.2s ease; 
            position: relative; overflow: hidden; 
        }
        .btn-primary { background: var(--gradient); color: white; }
        .btn-secondary { background: var(--surface-light); color: var(--text); border: 1px solid var(--border); }
        .btn-sm { padding: 0.5rem 1rem; font-size: 0.75rem; }
        .card { background: var(--surface); border-radius: 1rem; border: 1px solid var(--border); overflow: hidden; transition: all 0.3s ease; }
        .card-body { padding: 1.5rem; }
        .input { width: 100%; padding: 0.75rem 1rem; background: var(--surface-light); border: 1px solid var(--border); border-radius: 0.75rem; color: var(--text); font-size: 0.875rem; transition: all 0.2s ease; }
        .input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(236, 72, 153, 0.1); }
        .modal-overlay { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(10px); z-index: 2000; display: flex; align-items: center; justify-content: center; padding: 1rem; opacity: 0; animation: fadeIn 0.3s ease-out forwards; }
        .modal { background: var(--surface); border-radius: 1.5rem; border: 1px solid var(--border); width: 100%; max-width: 400px; max-height: 90vh; overflow-y: auto; animation: slideIn 0.3s ease-out; box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5); }
        .modal-header { padding: 1.5rem; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
        .modal-title { font-size: 1.25rem; font-weight: 700; }
        .modal-body { padding: 1.5rem; }
        .modal-close { background: none; border: none; color: var(--text-secondary); cursor: pointer; width: 2.5rem; height: 2.5rem; border-radius: 0.5rem; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease; }
        .text-xs { font-size: 0.75rem; }
        .text-sm { font-size: 0.875rem; }
        .text-xl { font-size: 1.25rem; }
        .text-2xl { font-size: 2rem; }
        .font-bold { font-weight: 700; }
        .font-semibold { font-weight: 600; }
        .text-zinc-400 { color: #a1a1aa; }
        .text-primary { color: var(--primary); }
        .text-success { color: var(--success); }
        .text-danger { color: var(--danger); }
        .animate-spin { animation: spin 1s linear infinite; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideIn { from { transform: translateX(-20px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--surface); }
        ::-webkit-scrollbar-thumb { background: var(--surface-light); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--border); }

        /* Gradient text */
        .gradient-text { background: var(--gradient); -webkit-background-clip: text; background-clip: text; color: transparent; display: inline-block; }

        /* Top Navigation */
        .top-nav { position: fixed; top: 0; left: 0; right: 0; z-index: 1000; padding: 1rem; background: rgba(0, 0, 0, 0.9); backdrop-filter: blur(20px); border-bottom: 1px solid var(--border); }
        .nav-content { display: flex; align-items: center; justify-content: space-between; }
        .logo { display: flex; align-items: center; gap: 0.75rem; font-weight: 700; font-size: 1.25rem; text-decoration: none; color: var(--text); }
        .logo-icon { width: 2rem; height: 2rem; background: var(--gradient); border-radius: 0.5rem; display: flex; align-items: center; justify-content: center; color: white; }
        .nav-actions { display: flex; align-items: center; gap: 0.5rem; }
        .btn-icon { width: 2.5rem; height: 2.5rem; padding: 0; border-radius: 50%; }

        /* Bottom Navigation */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; z-index: 1000; padding: 0.75rem 1rem; background: rgba(0, 0, 0, 0.9); backdrop-filter: blur(20px); border-top: 1px solid var(--border); }
        .nav-items { display: flex; justify-content: space-around; align-items: center; max-width: 400px; margin: 0 auto; }
        .nav-item { display: flex; flex-direction: column; align-items: center; text-decoration: none; color: var(--text-secondary); transition: all 0.2s ease; padding: 0.5rem; border-radius: 0.75rem; min-width: 4rem; }
        .nav-item:hover { color: var(--text); background: rgba(255, 255, 255, 0.05); }
        .nav-item.active { color: var(--primary); background: rgba(236, 72, 153, 0.1); }
        .nav-item i { font-size: 1.25rem; margin-bottom: 0.25rem; }
        .nav-item span { font-size: 0.75rem; font-weight: 500; }

        /* Content */
        .content { padding: 5rem 1rem 7rem; }
        .page { min-height: 100vh; position: relative; overflow-x: hidden; }
        .page.hidden { display: none; }

        /* Toast */
        #toast { position: fixed; top: 4rem; right: 1rem; z-index: 2000; display: none; }
        #toast.show { display: block; animation: fadeIn 0.3s ease-out; }

        /* File Upload */
        .file-upload-area { border: 2px dashed var(--border); border-radius: 1rem; padding: 2rem; text-align: center; cursor: pointer; transition: all 0.3s ease; background: var(--surface-light); }
        .file-upload-area:hover { border-color: var(--primary); background: rgba(236, 72, 153, 0.05); }
        .file-preview { margin-top: 1rem; display: none; }
        .file-preview.active { display: block; }
        .progress-bar { width: 100%; height: 0.5rem; background: var(--surface-light); border-radius: 9999px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--gradient); border-radius: 9999px; transition: width 0.3s ease; }

        /* Notification Bell */
        .notification-bell { position: fixed; left: 1rem; bottom: 5rem; width: 3rem; height: 3rem; border-radius: 50%; background: var(--surface-light); color: var(--text); display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 100; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3); transition: all 0.3s ease; border: 1px solid var(--border); }
        .notification-badge { position: absolute; top: -0.25rem; right: -0.25rem; width: 1.25rem; height: 1.25rem; background: var(--danger); color: white; border-radius: 50%; font-size: 0.75rem; display: flex; align-items: center; justify-content: center; font-weight: 600; }

        /* PWA Install Button */
        .pwa-install-btn { position: fixed; left: 1rem; bottom: 9rem; width: 3rem; height: 3rem; border-radius: 50%; background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 100; box-shadow: 0 10px 25px rgba(236, 72, 153, 0.3); transition: all 0.3s ease; border: none; }
        .pwa-install-btn.hidden { display: none; }
    </style>
</head>
<body>
    <!-- Toast Notification -->
    <div id="toast" class="card">
        <div class="card-body">
            <div class="flex items-center gap-3">
                <i id="toast-icon" class="fas fa-check-circle text-success"></i>
                <div class="flex-1">
                    <h4 id="toast-title" class="font-semibold"></h4>
                    <p id="toast-message" class="text-sm text-zinc-400"></p>
                </div>
                <button class="text-zinc-400 hover:text-white" onclick="hideToast()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- PWA Install Button -->
    <button id="pwa-install-btn" class="pwa-install-btn hidden">
        <i class="fas fa-download"></i>
    </button>

    <!-- Top Navigation -->
    <nav class="top-nav">
        <div class="nav-content">
            <a href="#home" class="logo" onclick="showPage('home')">
                <div class="logo-icon">
                    <span style="font-family: 'Arial Black', sans-serif; font-size: 1rem;">GK</span>
                </div>
                <span class="gradient-text">GK Store</span>
            </a>
            
            <div class="nav-actions">
                <button class="btn btn-icon btn-secondary" onclick="showPage('admin')">
                    <i class="fas fa-user-shield"></i>
                </button>
                <button class="btn btn-icon btn-secondary" onclick="showPage('profile')">
                    <i class="far fa-user"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div id="content-container" class="content">
        <!-- Auth Page -->
        <div id="auth-page" class="page">
            <div class="flex items-center justify-center min-h-[calc(100vh-140px)]">
                <div class="card" style="max-width: 400px; width: 100%;">
                    <div class="card-body">
                        <div class="text-center mb-6">
                            <div class="w-16 h-16 bg-gradient-to-br from-pink-500 to-purple-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
                                <span style="font-family: 'Arial Black', sans-serif; color: white; font-size: 1.5rem;">GK</span>
                            </div>
                            <h2 class="text-2xl font-bold mb-2">Welcome to GK Store</h2>
                            <p class="text-zinc-400">Sign in to access premium content</p>
                        </div>
                        
                        <form id="login-form" onsubmit="login(event)">
                            <div class="mb-4">
                                <input type="email" class="input" id="login-email" placeholder="Email" required>
                            </div>
                            <div class="mb-6">
                                <input type="password" class="input" id="login-password" placeholder="Password" required>
                            </div>
                            <button type="submit" class="btn btn-primary w-full">
                                Sign In
                            </button>
                        </form>
                        
                        <div class="mt-4 text-center">
                            <p class="text-zinc-400">Demo: Use admin@gkstore.com / password123</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Home Page -->
        <div id="home-page" class="page hidden">
            <div class="mb-6">
                <h2 class="text-2xl font-bold mb-4">Featured Videos</h2>
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-gradient-to-br from-pink-500 to-purple-600 aspect-[9/16] rounded-xl flex items-center justify-center cursor-pointer" onclick="showToast('info', 'Video', 'This would play a video')">
                        <i class="fas fa-play text-white text-4xl"></i>
                    </div>
                    <div class="bg-gradient-to-br from-blue-500 to-cyan-600 aspect-[9/16] rounded-xl flex items-center justify-center cursor-pointer" onclick="showToast('info', 'Video', 'This would play a video')">
                        <i class="fas fa-play text-white text-4xl"></i>
                    </div>
                </div>
            </div>
            
            <div>
                <h2 class="text-2xl font-bold mb-4">Premium Accounts</h2>
                <div class="grid gap-4">
                    <div class="card">
                        <div class="card-body">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h3 class="font-semibold">VIP Account</h3>
                                    <p class="text-sm text-zinc-400">Exclusive access</p>
                                </div>
                                <span class="bg-gradient-to-r from-pink-500 to-purple-600 text-white px-3 py-1 rounded-full text-sm">Big Tier</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-xl font-bold">$5000</span>
                                <button class="btn btn-sm btn-primary" onclick="showToast('success', 'Booked', 'Account booked successfully!')">
                                    Book Now
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Page -->
        <div id="admin-page" class="page hidden">
            <h2 class="text-2xl font-bold mb-6">Admin Panel</h2>
            
            <div class="card mb-6">
                <div class="card-body">
                    <h3 class="font-semibold mb-4">Admin Login</h3>
                    <form id="admin-login-form" onsubmit="adminLogin(event)">
                        <div class="mb-4">
                            <input type="password" id="admin-password" class="input" placeholder="Admin Password" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-full">
                            Login as Admin
                        </button>
                    </form>
                </div>
            </div>
            
            <div id="admin-dashboard" class="hidden">
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="card">
                        <div class="card-body text-center">
                            <div class="text-2xl font-bold gradient-text" id="admin-video-count">0</div>
                            <div class="text-sm text-zinc-400">Total Videos</div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-body text-center">
                            <div class="text-2xl font-bold gradient-text">3</div>
                            <div class="text-sm text-zinc-400">Registered Users</div>
                        </div>
                    </div>
                </div>
                
                <button class="btn btn-primary w-full mb-4" onclick="showUploadModal()">
                    <i class="fas fa-upload mr-2"></i> Upload Video
                </button>
                
                <div class="card">
                    <div class="card-body">
                        <h3 class="font-semibold mb-4">Quick Stats</h3>
                        <div class="space-y-2">
                            <div class="flex justify-between">
                                <span>Storage Used</span>
                                <span class="text-primary">0 MB</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Filebase Status</span>
                                <span class="text-success">Connected</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Page -->
        <div id="profile-page" class="page hidden">
            <div class="text-center mb-8">
                <div class="w-24 h-24 bg-gradient-to-br from-pink-500 to-purple-600 rounded-full flex items-center justify-center text-2xl font-bold mx-auto mb-4">
                    <span style="font-family: 'Arial Black', sans-serif; color: white;">GK</span>
                </div>
                <h2 class="text-2xl font-bold">User Profile</h2>
                <p class="text-zinc-400">Premium Member</p>
            </div>
            
            <div class="card mb-4">
                <div class="card-body">
                    <h3 class="font-semibold mb-4">Account Info</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-zinc-400">Email</span>
                            <span id="user-email">user@example.com</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-zinc-400">Member Since</span>
                            <span>Today</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <button class="btn btn-secondary w-full" onclick="logout()">
                Logout
            </button>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <div class="nav-items">
            <a href="#home" class="nav-item active" onclick="showPage('home')">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </a>
            <a href="#admin" class="nav-item" onclick="showPage('admin')">
                <i class="fas fa-cog"></i>
                <span>Admin</span>
            </a>
        </div>
    </nav>

    <!-- Notification Bell -->
    <div class="notification-bell" onclick="showToast('info', 'Notifications', 'No new notifications')">
        <i class="far fa-bell"></i>
        <div class="notification-badge">3</div>
    </div>

    <!-- Upload Modal -->
    <div id="upload-modal" class="modal-overlay hidden">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title">Upload Video to Filebase</h3>
                <button class="modal-close" onclick="closeModal('upload-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="mb-4">
                    <input type="text" class="input mb-4" id="video-title" placeholder="Video Title">
                    <input type="number" class="input mb-4" id="video-price" placeholder="Price ($)">
                    <select class="input mb-4" id="video-tier">
                        <option value="">Select Tier</option>
                        <option value="small">Small</option>
                        <option value="medium">Medium</option>
                        <option value="big">Big</option>
                    </select>
                </div>
                
                <div class="file-upload-area" onclick="document.getElementById('video-file').click()">
                    <i class="fas fa-cloud-upload-alt text-3xl text-primary mb-2"></i>
                    <p class="font-medium">Click to select video file</p>
                    <p class="text-sm text-zinc-400 mt-1">Max 200MB</p>
                    <input type="file" id="video-file" accept="video/*" class="hidden" onchange="handleFileSelect(event)">
                </div>
                
                <div id="file-preview" class="file-preview">
                    <div class="card mt-4">
                        <div class="card-body">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p id="file-name" class="font-medium"></p>
                                    <p id="file-size" class="text-xs text-zinc-400"></p>
                                </div>
                                <button type="button" class="btn btn-sm btn-secondary" onclick="clearFileSelection()">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="upload-progress" class="mt-4 hidden">
                    <div class="flex justify-between mb-2">
                        <span>Uploading to Filebase...</span>
                        <span id="upload-percent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
                    </div>
                </div>
                
                <button id="upload-btn" class="btn btn-primary w-full mt-4" onclick="uploadToFilebase()">
                    <i class="fas fa-cloud-upload-alt mr-2"></i> Upload to Filebase
                </button>
                
                <div class="mt-4 text-center">
                    <p class="text-xs text-zinc-400">Using Filebase IPFS for decentralized storage</p>
                </div>
            </div>
        </div>
    </div>

<script>
// ====== APP STATE ======
const appState = {
    currentPage: 'auth',
    isLoggedIn: false,
    isAdminLoggedIn: false,
    currentUser: null,
    videos: [],
    selectedFile: null,
    
    // Filebase Configuration - YOUR CREDENTIALS
    filebase: {
        accessKey: '33B0D768699F462BDFC1',
        secretKey: 'Yr1udg7LAUTk0EPLJM0BsXPlM8VMciKsQk2PhbSC',
        bucket: 'gk-store-videos',
        endpoint: 'https://s3.filebase.com'
    }
};

// ====== INITIALIZE APP ======
function initApp() {
    loadFromLocalStorage();
    setupPWA();
    
    // Check if user is already logged in
    const savedUser = localStorage.getItem('gkUser');
    if (savedUser) {
        try {
            appState.currentUser = JSON.parse(savedUser);
            appState.isLoggedIn = true;
            showPage('home');
        } catch(e) {
            showPage('auth');
        }
    } else {
        showPage('auth');
    }
}

// ====== PAGE MANAGEMENT ======
function showPage(page) {
    // Hide all pages
    document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
    
    // Update nav items
    document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
    
    // Show requested page
    const pageEl = document.getElementById(`${page}-page`);
    if (pageEl) {
        pageEl.classList.remove('hidden');
        appState.currentPage = page;
    }
    
    // Update active nav
    const navItem = document.querySelector(`.nav-item[href="#${page}"]`);
    if (navItem) navItem.classList.add('active');
    
    // Special page handling
    if (page === 'home') updateHomePage();
    if (page === 'admin' && !appState.isAdminLoggedIn) {
        document.getElementById('admin-dashboard').classList.add('hidden');
    }
}

// ====== AUTH FUNCTIONS ======
function login(event) {
    event.preventDefault();
    const email = document.getElementById('login-email').value;
    const password = document.getElementById('login-password').value;
    
    // Demo authentication
    if ((email === 'admin@gkstore.com' && password === 'password123') || 
        (email === 'user@example.com' && password === 'password123')) {
        
        appState.currentUser = {
            email: email,
            name: email.split('@')[0],
            role: email === 'admin@gkstore.com' ? 'admin' : 'user'
        };
        
        appState.isLoggedIn = true;
        localStorage.setItem('gkUser', JSON.stringify(appState.currentUser));
        
        showToast('success', 'Welcome!', `Logged in as ${appState.currentUser.name}`);
        showPage('home');
        
        // Update profile
        document.getElementById('user-email').textContent = email;
    } else {
        showToast('error', 'Login Failed', 'Invalid credentials');
    }
}

function adminLogin(event) {
    event.preventDefault();
    const password = document.getElementById('admin-password').value;
    
    if (password === 'password123') {
        appState.isAdminLoggedIn = true;
        document.getElementById('admin-dashboard').classList.remove('hidden');
        showToast('success', 'Admin Access', 'Logged in as admin');
    } else {
        showToast('error', 'Access Denied', 'Invalid admin password');
    }
}

function logout() {
    appState.isLoggedIn = false;
    appState.isAdminLoggedIn = false;
    appState.currentUser = null;
    localStorage.removeItem('gkUser');
    showPage('auth');
    showToast('info', 'Logged Out', 'You have been logged out');
}

// ====== FILEBASE UPLOAD ======
function showUploadModal() {
    if (!appState.isAdminLoggedIn) {
        showToast('error', 'Access Required', 'Please login as admin first');
        return;
    }
    showModal('upload-modal');
}

function handleFileSelect(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    // Check file size (200MB limit)
    if (file.size > 200 * 1024 * 1024) {
        showToast('error', 'File Too Large', 'Maximum file size is 200MB');
        return;
    }
    
    // Check file type
    const validTypes = ['video/mp4', 'video/webm', 'video/ogg'];
    if (!validTypes.includes(file.type)) {
        showToast('error', 'Invalid File', 'Please select a video file (MP4, WebM, OGG)');
        return;
    }
    
    appState.selectedFile = file;
    
    // Show preview
    document.getElementById('file-name').textContent = file.name;
    document.getElementById('file-size').textContent = formatFileSize(file.size);
    document.getElementById('file-preview').classList.add('active');
    
    showToast('success', 'File Selected', `${file.name} ready for upload`);
}

function clearFileSelection() {
    appState.selectedFile = null;
    document.getElementById('video-file').value = '';
    document.getElementById('file-preview').classList.remove('active');
}

function uploadToFilebase() {
    if (!appState.selectedFile) {
        showToast('error', 'No File', 'Please select a video file first');
        return;
    }
    
    const title = document.getElementById('video-title').value;
    const price = document.getElementById('video-price').value;
    const tier = document.getElementById('video-tier').value;
    
    if (!title || !price || !tier) {
        showToast('error', 'Missing Info', 'Please fill all fields');
        return;
    }
    
    // Show progress bar
    document.getElementById('upload-progress').classList.remove('hidden');
    const uploadBtn = document.getElementById('upload-btn');
    uploadBtn.disabled = true;
    uploadBtn.innerHTML = '<i class="fas fa-spinner animate-spin mr-2"></i> Uploading...';
    
    // Simulate upload progress
    simulateUploadProgress();
    
    // In a real implementation, you would upload directly to Filebase
    // For now, we'll simulate success
    setTimeout(() => {
        // Simulate successful upload
        showToast('success', 'Upload Complete', 'Video uploaded to Filebase IPFS!');
        
        // Add to videos list
        const newVideo = {
            id: Date.now(),
            title: title,
            price: price,
            tier: tier,
            file: appState.selectedFile.name,
            size: formatFileSize(appState.selectedFile.size),
            timestamp: new Date().toLocaleString()
        };
        
        appState.videos.push(newVideo);
        saveToLocalStorage();
        updateAdminStats();
        
        // Reset form
        clearFileSelection();
        document.getElementById('video-title').value = '';
        document.getElementById('video-price').value = '';
        document.getElementById('video-tier').value = '';
        document.getElementById('upload-progress').classList.add('hidden');
        uploadBtn.disabled = false;
        uploadBtn.innerHTML = '<i class="fas fa-cloud-upload-alt mr-2"></i> Upload to Filebase';
        
        // Close modal after delay
        setTimeout(() => closeModal('upload-modal'), 1000);
        
    }, 3000);
}

function simulateUploadProgress() {
    let progress = 0;
    const progressBar = document.getElementById('progress-fill');
    const percentText = document.getElementById('upload-percent');
    
    const interval = setInterval(() => {
        progress += Math.random() * 20;
        if (progress > 100) progress = 100;
        
        progressBar.style.width = `${progress}%`;
        percentText.textContent = `${Math.round(progress)}%`;
        
        if (progress >= 100) {
            clearInterval(interval);
        }
    }, 300);
}

// ====== UTILITY FUNCTIONS ======
function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

function showToast(type, title, message) {
    const toast = document.getElementById('toast');
    const icon = document.getElementById('toast-icon');
    const toastTitle = document.getElementById('toast-title');
    const toastMessage = document.getElementById('toast-message');
    
    // Set icon based on type
    const icons = {
        success: 'fa-check-circle',
        error: 'fa-exclamation-circle',
        info: 'fa-info-circle',
        warning: 'fa-exclamation-triangle'
    };
    
    const colors = {
        success: 'text-success',
        error: 'text-danger',
        info: 'text-primary',
        warning: 'text-warning'
    };
    
    icon.className = `fas ${icons[type] || 'fa-info-circle'} ${colors[type] || 'text-primary'}`;
    toastTitle.textContent = title;
    toastMessage.textContent = message;
    
    toast.classList.add('show');
    
    // Auto hide after 3 seconds
    setTimeout(() => {
        toast.classList.remove('show');
    }, 3000);
}

function hideToast() {
    document.getElementById('toast').classList.remove('show');
}

function showModal(modalId) {
    document.getElementById(modalId).classList.remove('hidden');
}

function closeModal(modalId) {
    document.getElementById(modalId).classList.add('hidden');
}

function updateHomePage() {
    // Update home page content
    // You can add dynamic content here
}

function updateAdminStats() {
    const videoCount = document.getElementById('admin-video-count');
    if (videoCount) {
        videoCount.textContent = appState.videos.length;
    }
}

// ====== PWA FUNCTIONS ======
function setupPWA() {
    let deferredPrompt;
    
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        
        // Show install button after delay
        setTimeout(() => {
            const installBtn = document.getElementById('pwa-install-btn');
            if (installBtn) {
                installBtn.classList.remove('hidden');
                installBtn.onclick = () => {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            showToast('success', 'Installed', 'App installed successfully!');
                        }
                        deferredPrompt = null;
                    });
                };
            }
        }, 5000);
    });
    
    // Register service worker
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/GKStore/sw.js').catch(console.error);
    }
}

// ====== LOCAL STORAGE ======
function saveToLocalStorage() {
    const data = {
        videos: appState.videos,
        user: appState.currentUser
    };
    localStorage.setItem('gkStoreData', JSON.stringify(data));
}

function loadFromLocalStorage() {
    const saved = localStorage.getItem('gkStoreData');
    if (saved) {
        try {
            const data = JSON.parse(saved);
            appState.videos = data.videos || [];
            appState.currentUser = data.user || null;
        } catch(e) {
            console.error('Error loading saved data:', e);
        }
    }
}

// ====== INITIALIZE ======
document.addEventListener('DOMContentLoaded', initApp);

// ====== CREATE MANIFEST ======
function createManifest() {
    const manifest = {
        "name": "GK Store",
        "short_name": "GK Store",
        "description": "Exclusive Video Marketplace",
        "start_url": "https://shamsahmadzai06-source.github.io/GKStore/",
        "display": "standalone",
        "background_color": "#000000",
        "theme_color": "#ec4899",
        "icons": [
            {
                "src": "https://shamsahmadzai06-source.github.io/GKStore/android-launchericon-192-192.png",
                "sizes": "192x192",
                "type": "image/png"
            },
            {
                "src": "https://shamsahmadzai06-source.github.io/GKStore/android-launchericon-512-512.png",
                "sizes": "512x512",
                "type": "image/png"
            }
        ]
    };

    const blob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    
    const link = document.createElement('link');
    link.rel = 'manifest';
    link.href = url;
    document.head.appendChild(link);
}

createManifest();
</script>
</body>
</html>
